<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CMake é¡¹ç›®é“¾æ¥æ—¶æ‰¾ä¸åˆ°é™æ€åº“</title>
    <url>/posts/1c6f4546/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>è§£å†³ CLion é¡¹ç›®é“¾æ¥æ—¶æ‰¾ä¸åˆ°é“¾æ¥åº“çš„é—®é¢˜</li>
</ul>
</blockquote>
<a id="more"></a>
<p>æœ€è¿‘åœ¨ç”¨ cmake ç®¡ç†é¡¹ç›®çš„æ—¶å€™ï¼Œå†™å®Œ test åå‘ç°æ— è®ºå¦‚ä½•éƒ½æ²¡æœ‰åŠæ³•é“¾æ¥æˆåŠŸï¼ŒæŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">/usr/bin/ld: can<span class="number">'</span>t <span class="built_in">find</span> -lTripod_Lib</span><br><span class="line">error: ld returned <span class="number">1</span> <span class="built_in">exit</span> status</span><br></pre></td></tr></table></figure>
<p><code>Tripod_Lib</code> æ˜¯ä¹‹å‰ç”Ÿæˆçš„é™æ€åº“ï¼Œæ”¾åœ¨ lib ç›®å½•ä¸‹ã€‚</p>
<p>æ‰‹åŠ¨ç”¨ g++ å‘½ä»¤æµ‹è¯•èƒ½å¤ŸæˆåŠŸç¼–è¯‘é“¾æ¥ï¼Œçœ‹æ¥çœŸçš„æ˜¯å› ä¸ºæ‰¾ä¸åˆ°åº“ğŸ˜“</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">g++ test/test.cc -o tb -I ./src ./lib/Tripod_Lib.a</span><br></pre></td></tr></table></figure>
<p>æŠ˜ç£¨äº†ä¸¤å¤©ï¼Œæœ€ç»ˆè¿˜æ˜¯åœ¨ <a href="https://cmake.org/cmake/help/v3.15/command/link_directories.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a> ä¸Šæ‰¾åˆ°äº†åŸå› ï¼š<br>
<em>Specify the paths in which the linker should search for libraries. <strong>The command will apply only to targets created after it is called.</strong></em></p>
<p>ä¹Ÿæ˜¯å°±è¯´ï¼Œ<code>link_directories()</code> éœ€è¦æ”¾åœ¨ <code>add_library()</code> å’Œ <code>add_executable()</code> çš„å‰é¢ã€‚<br>
æ­¤å¤–è¿˜è¦æ³¨æ„ï¼Œæœ€åé“¾æ¥çš„é™æ€åº“åå­—é‡Œè¦å¸¦ä¸Š .a çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">3.15</span>)</span><br><span class="line">project(Tripod)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(EXECUTABLE_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/bin)</span><br><span class="line"><span class="built_in">set</span>(LIBRARY_OUTPUT_PATH $&#123;PROJECT_SOURCE_DIR&#125;/lib)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_DEBUG_POSTFIX <span class="string">"_Base"</span>)</span><br><span class="line"></span><br><span class="line">aux_source_directory($&#123;PROJECT_SOURCE_DIR&#125;/src SRC_DIR)</span><br><span class="line"></span><br><span class="line">link_directories($&#123;PROJECT_SOURCE_DIR&#125;/lib)</span><br><span class="line"></span><br><span class="line">add_library(_Tripod STATIC $&#123;SRC_DIR&#125;)</span><br><span class="line"></span><br><span class="line">add_executable(Tripod test/test.cc)</span><br><span class="line"></span><br><span class="line">target_link_libraries(Tripod lib_Tripod$&#123;CMAKE_DEBUG_POSTFIX&#125;.a)</span><br></pre></td></tr></table></figure>
<p>å¿…é¡»è¦åæ§½ Cmake çš„æ–‡æ¡£é‡ŒçœŸæ˜¯ä¸€ä¸ªä¾‹å­éƒ½æ²¡æœ‰å•Šï¼Œçœ‹å®Œä¹‹åæ¨¡æ£±ä¸¤å¯çš„ä¸œè¥¿å¤§æŠŠï¼Œå¥½åƒè¢«äººåœ¨å˜´é‡Œç¡¬å¡äº†ä¸€æŠŠå±ä¸€æ ·ï¼Œæ•°å­¦è¯¾æœ¬éƒ½è¿˜æœ‰ä¾‹é¢˜å‘¢ï¼Œå‘è´§ğŸ˜¡ğŸ˜¡ğŸ˜¡</p>
]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>CMake</tag>
        <tag>Debug</tag>
        <tag>Tools</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows ä¸‹é…ç½® CLion + Cygwin å¼€å‘ç¯å¢ƒ</title>
    <url>/posts/1f8822d7/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>Windows ä¸‹é…ç½® CLion Toolchain ä¸º Cygwin</li>
</ul>
</blockquote>
<a id="more"></a>
<p>ä¹‹å‰å·²ç»åœ¨ CLion ä¸­é…ç½®å¥½äº† MinGWï¼Œä½†æ˜¯ MinGW ä¸‹æ— æ³•è°ƒç”¨ POSIX APIï¼Œå› æ­¤åœ¨ CLion ä¸‹é‡æ–°é…ç½® Toolchain ä¸º Cygwinï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ï¼š<br>
é¦–å…ˆè¦è¯´ï¼ŒMinGW ä¸ Cygwin è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p>
<ul>
<li>Cygwin æ˜¯ä½¿ç”¨ä¸€ä¸ª dll æ¥æ¨¡æ‹Ÿ Linux ç¯å¢ƒï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåœ¨ windows ä¸Šçš„å¯è¿è¡Œ POSIX åº”ç”¨ç¨‹åºçš„å·¥å…·ç¯å¢ƒ</li>
<li>MinGW æ˜¯åœ¨ç¼–è¯‘æ—¶æä¾› Linux åˆ° Win ä»£ç çš„è½¬æ¢ï¼Œç”¨åˆ°çš„å…¶å®æ˜¯ Windows è¿è¡Œåº“</li>
</ul>
<ol>
<li>
<p>åœ¨ <a href="https://www.cygwin.com/" target="_blank" rel="noopener">Cygwin</a> ä¸‹è½½å®‰è£…æ–‡ä»¶ setup-x86_64.exeï¼›</p>
</li>
<li>
<p>è¿è¡Œå®‰è£…æ–‡ä»¶ï¼Œä¸€è·¯ nextï¼Œé€‰æ‹©ç«™ç‚¹ç•Œé¢æ–°å¢ <code>http://mirrors.163.com/cygwin/</code>ï¼›</p>
</li>
<li>
<p>Select Packages ç•Œé¢ï¼Œåœ¨ View ä¸­é€‰æ‹© Fullï¼Œç„¶ååˆ†åˆ«è¾“å…¥ <code>cmake</code> <code>gcc-core</code> <code>gcc-g++</code> <code>gdb</code> <code>make</code>ï¼Œé€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œç„¶å next æ‰¹é‡å®‰è£…ï¼›</p>
</li>
<li>
<p>å®‰è£…è¿‡ç¨‹ä¸­å‘ç°å¡åœ¨äº† <code>/etc/postinstall/0p_000_autorebash.dash</code>ï¼ŒæŸ¥çœ‹äº† <a href="http://cygwin.1069669.n5.nabble.com/Autorebase-hangs-on-install-td128035.html#a128036" target="_blank" rel="noopener">è§£å†³æ–¹æ³•</a>ï¼Œå°† dash è¿›ç¨‹ç»“æŸæ‰ï¼Œæœ€åæˆåŠŸå®‰è£…ï¼›</p>
</li>
<li>
<p>åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­æ·»åŠ  <code>C:\cygwin64\bin</code>ï¼›</p>
</li>
<li>
<p>CLion-&gt;Setting-&gt;Build Execution Deployment-&gt;Toolchain ä¸­å°† Environment é€‰ä¸º Cygwinï¼Œç›®å½•ä¸º Cygwin å®‰è£…æ–‡ä»¶å¤¹ï¼ŒCmake Debugger å‡åœ¨ <code>C:\cygwin64\bin</code> ç›®å½•ä¸‹é€‰æ‹©ï¼ŒMakeã€C Complierã€C++ Complier è¿™ä¸‰é¡¹ç•™ç»™ CLion è‡ªåŠ¨æ£€æµ‹ã€‚</p>
</li>
<li>
<p>ç‚¹å‡»å‘ä¸Šçš„ç®­å¤´ï¼ŒæŠŠ Cygwin è®¾ç½®ä¸º Defaultï¼ŒCmake ä¼šé‡æ–° Config é¡¹ç›®ä»£ç ï¼š</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">C:\SOFTWARE\cygwin64\bin\cmake.exe -DCMAKE_BUILD_TYPE=Debug -G <span class="string">"CodeBlocks - Unix Makefiles"</span> /cygdrive/d/LinuxShare/Tripod-cxx</span><br><span class="line">-- The C compiler identification is GNU <span class="number">9.2</span><span class="number">.0</span></span><br><span class="line">-- The CXX compiler identification is GNU <span class="number">9.2</span><span class="number">.0</span></span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/cc</span><br><span class="line">-- Check <span class="keyword">for</span> working C compiler: /usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check <span class="keyword">for</span> working CXX compiler: /usr/bin/c++.exe</span><br><span class="line">-- Check <span class="keyword">for</span> working CXX compiler: /usr/bin/c++.exe -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>CLion</tag>
        <tag>Cygwin</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Quiz é¢˜è§£ 201~300</title>
    <url>/posts/7651320d/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>C++ Quiz é¢˜è§£ 101~200 æ•´ç†</li>
<li>æœ‰è¶£çš„é¢˜ç›®ï¼š</li>
<li>217 225 226 227 233 249 264 273 284</li>
</ul>
</blockquote>
<a id="more"></a>
<h4 id="Q-205">Q 205</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> id = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">array</span>[] = &#123; id % <span class="number">3</span>, id % <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="built_in">array</span>[<span class="number">0</span>]) &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="built_in">array</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š10<br>
array æ˜¯ä¸€ä¸ª <code>char</code> ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯å´ä½¿ç”¨ unsigned int åˆå§‹åŒ–ï¼Œunsigned int è½¬æ¢ä¸º <code>char</code> å±äº narrow è½¬æ¢ï¼Œå³æ–°ç±»å‹å¹¶ä¸èƒ½å®Œæ•´åœ°è¡¨ç¤ºåŸç±»å‹ã€‚<br>
ä½†æ˜¯ä»£ç ä¸­çš„æºæ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå®ƒç±»å‹æå‡åçš„å€¼æ˜¯èƒ½å¤Ÿé€‚åˆç›®æ ‡ç±»å‹çš„ã€‚</p>
<h4 id="Q-217">Q 217</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">const</span>&amp; a = i &gt; <span class="number">0</span> ? i : <span class="number">1</span>;</span><br><span class="line">    i = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š21<br>
æœ¬é¢˜çš„å…³é”®åœ¨äº a æ˜¯å¦æ˜¯ i çš„å¼•ç”¨ã€‚<br>
æ¡ä»¶è¡¨è¾¾å¼çš„ç±»å‹å’Œå€¼ç±»åˆ«éƒ½å–å†³äºç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªè¡¨è¾¾å¼çš„ç±»å‹å’Œå€¼ç±»åˆ«ï¼Œå¦‚æœä¸¤è€…éƒ½æ˜¯å·¦å€¼ï¼Œç»“æœä¼šæ˜¯å·¦å€¼ï¼Œä½†æ˜¯æ­¤æ—¶ i å’Œ 1 åˆ†åˆ«æ˜¯å·¦å€¼ä¸å³å€¼ã€‚<br>
æŒ‰ç…§ <a href="https://timsong-cpp.github.io/cppwp/n4659/expr.cond" target="_blank" rel="noopener">expr.cond 8.16.6</a> èƒ½å¤Ÿå¾—å‡ºè¡¨è¾¾å¼ i &gt; 0 ? i : 1 çš„ç»“æœæ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸´æ—¶é‡ï¼Œå› æ­¤ a ç»‘å®šçš„æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œå¯¹ i çš„ä¿®æ”¹ä¸ä¼šå½±å“åˆ° a çš„å€¼ã€‚</p>
<h4 id="Q-219">Q 219</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">sum</span><span class="params">(T arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ...Args&gt;</span><br><span class="line"><span class="function">T <span class="title">sum</span><span class="params">(T arg, Args... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg + sum&lt;T&gt;(args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> n1 = sum(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0.5</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> n2 = sum(<span class="number">1</span>, <span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0.5</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; n1 &lt;&lt; n2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š32<br>
<code>T sum(T arg, Args... args)</code> æ˜¯ä¸€ä¸ªè¿­ä»£ç±»å‹çš„å‡½æ•°æ¨¡æ¿ï¼Œå®ƒä¼šä¸€ç›´è°ƒç”¨è‡ªèº«ä¸€ç›´åˆ° base case <code>T sum(T arg)</code>ï¼Œå½“ T çš„ç±»å‹æ²¡æœ‰è¢«æŒ‡å®šæ—¶ï¼Œå®ƒä¼šè¢«æ¨å¯¼ä¸º <code>sum</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå½“ <code>sum</code> è¿­ä»£çš„æ—¶å€™ï¼ŒT å·²ç»æŒ‡å®šäº†ç›¸å…³ç±»å‹ï¼Œå¯¹äº n1 æ¥è¯´æ˜¯ <code>double</code>ï¼Œå¯¹äº n2 æ¥è¯´æ˜¯ <code>int</code>ã€‚</p>
<h4 id="Q-220">Q 220</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'f'</span>; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">g</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'g'</span>; <span class="keyword">return</span> <span class="string">'g'</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">h</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'h'</span>; <span class="keyword">return</span> <span class="string">'h'</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> result = f() ? g() : h();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šffh<br>
ä¸‰å…ƒè¿ç®—ç¬¦çš„åŸºæœ¬æ“ä½œ</p>
<h4 id="Q-222">Q 222</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    variant&lt;<span class="keyword">int</span>, <span class="keyword">double</span>, <span class="keyword">char</span>&gt; v;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; v.index();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š0<br>
<code>variant</code> æ˜¯ç±»å‹å®‰å…¨çš„ <code>union</code>ï¼Œå®ƒå¯ä»¥åœ¨ä»»æ„æ—¶é—´ä¿å­˜æ¨¡æ¿å‚æ•°åˆ—è¡¨ä¸­æŸä¸€ç±»å‹çš„å€¼æˆ–è€…ç©ºå€¼ï¼Œ<code>variant</code> ä¸èƒ½å­˜æ”¾å¼•ç”¨ã€æ•°ç»„æˆ– <code>void</code>ï¼Œç©º <code>variant</code> åº”è¯¥å†™ä¸º <code>std::variant&lt;std::monostate&gt;</code>ã€‚<br>
ä¸ <code>union</code> ä¸€æ ·ï¼Œ<code>variant</code> é»˜è®¤åˆå§‹åŒ–ä¸ºå®ƒæ¨¡æ¿ç±»å‹åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œé™¤éè¯¥é¡¹æ— æ³•é»˜è®¤æ„é€ ã€‚<br>
<code>variant.index()</code> è¿”å›å½“å‰ä¿æœ‰é¡¹çš„ä¸‹æ ‡ï¼Œå¦‚æœ <code>variant</code> æ— å€¼åˆ™è¿”å› <code>variant_npos</code>ã€‚</p>
<h4 id="Q-224">Q 224</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">f</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Base::f</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Derived</span> :</span> Base &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Derived::f</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived object;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; object.f();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ((Base&amp;)object).f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š22<br>
é¦–å…ˆï¼Œä¸ºçº¯è™šå‡½æ•°æä¾›å®šä¹‰æ˜¯æœ‰æ•ˆçš„ï¼Œåªè¦å®ƒä¸æ˜¯åœ¨ç±»çš„å£°æ˜ä¸­å®ç°å³å¯ã€‚<br>
<code>((Base&amp;)object).f()</code> åœ¨è°ƒç”¨ f ä¹‹å‰å°†å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸º <code>Base&amp;</code>ï¼Œä½†æ˜¯ç”±äº f ä¸ºè™šå‡½æ•°ï¼Œå› æ­¤ä»ç„¶è¾“å‡º 2ã€‚</p>
<h4 id="Q-225">Q 225</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    X(<span class="keyword">const</span> X &amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; &#125;</span><br><span class="line">    ~X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"4"</span>; &#125;</span><br><span class="line"></span><br><span class="line">&#125; object;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    X(object);</span><br><span class="line">    object.f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š11422<br>
é¦–å…ˆï¼Œ<code>struct X {...} object;</code> å®šä¹‰äº†ä¸€ä¸ª X ç±»å‹çš„ objectï¼Œè°ƒç”¨ 1 æ¬¡æ„é€ å‡½æ•°ï¼›<br>
<code>X(object)</code> æ˜¯ä¸€ä¸ªæ–°å˜é‡ object çš„å£°æ˜ï¼Œè€Œä¸æ˜¯å¤åˆ¶æ„é€ ä¸€ä¸ª X å¯¹è±¡ï¼Œå¦‚æœå†™æˆ <code>X object</code> å°±å¾ˆæ¸…æ¥šäº†ï¼Œå±€éƒ¨å˜é‡è¦†ç›–æ‰äº†å…¨å±€å˜é‡ï¼Œè°ƒç”¨ 1 æ¬¡æ„é€ å‡½æ•°ï¼›<br>
æœ€ååˆ«å¿˜äº†è°ƒç”¨ä¸¤æ¬¡ææ„å‡½æ•°ã€‚</p>
<h4 id="Q-226">Q 226</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    X(X &amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">    X(<span class="keyword">const</span> X &amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; &#125;</span><br><span class="line">    X(X &amp;&amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"4"</span>; &#125;</span><br><span class="line">    ~X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"5"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Y</span> &#123;</span></span><br><span class="line">    <span class="keyword">mutable</span> X x;</span><br><span class="line">    Y() = <span class="keyword">default</span>;</span><br><span class="line">    Y(<span class="keyword">const</span> Y &amp;) = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Y y1;</span><br><span class="line">    Y y2 = <span class="built_in">std</span>::<span class="built_in">move</span>(y1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1255<br>
é¦–å…ˆæ„é€ ä¸€ä¸ª Y å¯¹è±¡ï¼ŒY ä¸­æœ‰ä¸€ä¸ª X ç±»å‹çš„æˆå‘˜ç±»ï¼Œä½¿ç”¨é»˜è®¤æ„é€ ï¼Œè¾“å‡º 1ã€‚<br>
<code>std::move</code> ä¼šå°† y1 è½¬å˜ä¸ºå³å€¼ï¼Œä½†æ˜¯ Y å¹¶æ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå› æ­¤è°ƒç”¨çš„æ˜¯å®ƒçš„æ‹·è´æ„é€ å‡½æ•°ï¼Œè¿™ä¸ªéšå¼å®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å°†ä¼šæ‰§è¡Œ X ç±»æˆå‘˜å¯¹è±¡çš„æ‹·è´ï¼Œç°åœ¨çš„é—®é¢˜æ˜¯åˆ°åº•ä¼šæ‰§è¡Œå“ªä¸ªæ‹·è´æ„é€ å‡½æ•°ã€‚<br>
å› ä¸º X æœ‰ <code>mutable</code> ä¿®é¥°ï¼Œå› æ­¤ X è¢«è®¤ä¸ºæ˜¯é <code>const</code> æˆå‘˜ï¼Œé‡è½½è§£æè®¤ä¸º <code>X(X &amp;)</code> æ›´åŠ åˆé€‚ï¼Œå› ä¸º <code>X(const X &amp;)</code> è¿˜éœ€è¦è¿›è¡Œå¸¸æ•°è½¬æ¢ï¼Œæ‰€ä»¥æ­¤æ—¶è¾“å‡º 2ã€‚<br>
æœ€åï¼Œå› ä¸ºè°ƒç”¨çš„æ˜¯æ‹·è´æ„é€ å‡½æ•°ï¼Œä¼šè¾“å‡ºä¸¤ä¸ª 5ï¼Œå³ææ„ä¸¤æ¬¡ã€‚</p>
<h4 id="Q-227">Q 227</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Func = <span class="keyword">int</span>();</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    Func f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">S::f</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    S s;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; s.f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
<code>using Func = int()</code> æ˜¯ä¸€ç§<strong>åˆ«åå£°æ˜</strong>ï¼Œè¿™ç§å£°æ˜æ–¹å¼æ—¢å¯ä»¥ç”¨äºæ™®é€šå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨äºæˆå‘˜å‡½æ•°ã€‚</p>
<h4 id="Q-229">Q 229</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> f = [](<span class="keyword">int</span> b) &#123; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; f(<span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š5<br>
lambda è¡¨è¾¾å¼çš„éšå¼æ•è·è§„åˆ™æ˜¯å®ƒä¸ä¼šæ˜¾ç¤ºæ•è· *this å’Œå…·æœ‰è‡ªåŠ¨å­˜å‚¨å‘¨æœŸçš„å˜é‡ï¼Œè€Œæ­¤å¤„çš„ a å…·æœ‰é™æ€å­˜å‚¨å‘¨æœŸï¼Œå› æ­¤ lambda ä¸ä¼šéšå¼æ•è· aã€‚è¿™é‡Œçš„ a ä»…ä»…ä»£è¡¨å…¨å±€å˜é‡çš„å¼•ç”¨ã€‚</p>
<h4 id="Q-230">Q 230</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> var1 : <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> var2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    X x;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (&amp;x.var1 &lt; &amp;x.var2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
å–åœ°å€è¿ç®—ç¬¦ <code>&amp;</code> ä¸èƒ½ç”¨äºä½åŸŸ</p>
<h4 id="Q-231">Q 231</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">override</span> &#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">override</span> <span class="title">f</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Derived</span> :</span> Base &#123;</span><br><span class="line">    virtual auto f() -&gt; override override&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">override</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived().f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
è¿™é“é¢˜çš„è€ƒç‚¹åœ¨äº <code>override</code> èƒ½å¦ç”¨ä½œç±»å‹åç§°ã€‚<br>
C++ æ ‡å‡†ä¸­çš„ä¿ç•™å…³é”®å­—ä¸åŒ…å« <code>override</code>ï¼Œåªæœ‰å‡ºç°åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¸­æ—¶ï¼Œ<code>override</code> å’Œ <code>final</code> æ‰å…·æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œè€Œ <code>override</code> åªæœ‰å‡ºç°åœ¨å£°æ˜ç¬¦ä¹‹åæ‰å…·æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ type æ›¿æ¢ç±»å‹åï¼Œ<code>Drived::f</code> å¯ä»¥å†™ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">virtual auto f() -&gt; type override&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">return</span> type();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Q-233">Q 233</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">const</span>&amp;&amp;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> ptr = &amp;X::f;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; is_same_v&lt;<span class="keyword">decltype</span>(ptr), <span class="keyword">int</span>()&gt;</span><br><span class="line">         &lt;&lt; is_same_v&lt;<span class="keyword">decltype</span>(ptr), <span class="keyword">int</span>(X::*)()&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š00<br>
è¿”å›ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼Œå¼•ç”¨æ ‡è¯†ç¬¦ï¼Œconst &amp; volatile æ ‡è¯†ç¬¦ä»¥åŠå¼‚å¸¸è§„èŒƒï¼ˆä¸åŒ…æ‹¬ç¼ºçœå‚æ•°ï¼‰æ˜¯å‡½æ•°ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚<br>
è¿™è¯´æ˜ä»£ç ä¸­çš„ <code>ptr</code> ç±»å‹åº”è¯¥æ˜¯ <code>int(X::f)() const&amp;&amp;</code>ã€‚</p>
<h4 id="Q-236">Q 236</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">auto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = Foo();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šA1<br>
è½¬æ¢å‡½æ•°èƒ½å¤Ÿæœ‰æ¨æ–­è¿”å›ç±»å‹ï¼ˆåªæœ‰è½¬æ¢å‡½æ•°æ¨¡æ¿ä¸èƒ½è¿™ä¹ˆåšï¼‰ã€‚</p>
<h4 id="Q-248">Q 248</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;<span class="built_in">max</span> = <span class="built_in">std</span>::<span class="built_in">max</span>(x, y);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;<span class="built_in">min</span> = <span class="built_in">std</span>::<span class="built_in">min</span>(x, y);</span><br><span class="line"></span><br><span class="line">    x = <span class="number">11</span>;</span><br><span class="line">    y = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">max</span> &lt;&lt; <span class="built_in">min</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1111<br>
<code>std::max</code> ä¸ <code>std::min</code> å½“ä¸¤æ•°ç›¸ç­‰æ—¶è¿”å›ç¬¬ä¸€ä¸ªæ•°ã€‚</p>
<h4 id="Q-249">Q 249</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">char</span> <span class="keyword">const</span> &amp;b = a;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; b;</span><br><span class="line">    a++;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š00<br>
å¯¹äº <code>T1&amp; cv1 = (T2)cv2</code> æ¥è¯´ï¼Œ<strong>åªæœ‰å½“ T1 ä¸ T2 ä¸¤ä¸ªç±»å‹ç›¸åŒæˆ–è€…æœ‰ç»§æ‰¿å…³ç³»ï¼Œå®ƒä»¬æ‰æ˜¯å¼•ç”¨ç›¸å…³çš„ï¼Œå¦åˆ™å°±æ˜¯å¼•ç”¨æ— å…³çš„</strong>ã€‚<br>
å½“ Â·T1 ä¸ T2 å¼•ç”¨æ— å…³æ—¶ï¼Œåˆå§‹åŒ–çš„å¼•ç”¨è¡¨è¾¾å¼ä¼šå°† cv2 éšå¼è½¬æ¢å‡ºä¸€ä¸ªä¸´æ—¶çš„ T1 ç±»å‹çš„å¯¹è±¡ç”¨äºå¼•ç”¨ç»‘å®šï¼Œè¯¥å¯¹è±¡ä¸åŸå¯¹è±¡æ²¡æœ‰å…³ç³»ã€‚<br>
<code>'0'</code> æ˜¯ <code>char</code> ç±»å‹çš„å­—é¢é‡ï¼ŒASCII ç ä¸º 48ï¼Œa ä¸­ä¿å­˜çš„ä¸º <code>int</code> ç±»å‹çš„ 48ï¼Œä½†æ˜¯ b æ˜¯ <code>char const</code> ç±»å‹çš„å¼•ç”¨ï¼Œå› æ­¤ <code>char const</code> ä¸ <code>int</code> ä¸å­˜åœ¨å¼•ç”¨ç›¸å…³çš„å…³ç³»ï¼Œb ç»‘å®šçš„æ˜¯ä¸€ä¸ª a è½¬æ¢å‡ºæ¥çš„ä¸´æ—¶ <code>char const</code> ç±»å‹å¯¹è±¡ï¼Œå› æ­¤ä¸¤æ¬¡æ‰“å°éƒ½ä¸º 0ã€‚</p>
<h4 id="Q-250">Q 250</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(T...)</span> </span>&#123;<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'A'</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(T...)</span> </span>&#123;<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'B'</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    foo(<span class="number">1</span>);</span><br><span class="line">    foo(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šAB<br>
ç¬¬ä¸€ä¸ª <code>foo</code> å‡½æ•°æ˜¯è€å¼çš„å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿ï¼Œæ¥æ”¶ç±»å‹ä¸º T çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥ç€æ˜¯å¯å˜æ•°ç›®çš„å‚æ•°ã€‚<br>
ç¬¬äºŒä¸ª <code>foo</code> æ˜¯å¯å˜å‚å‡½æ•°æ¨¡æ¿ï¼Œå®ƒéœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°åŒ…ã€‚<br>
é‡è½½å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ‰¾åˆ°å¯¹äºç»™å®šçš„å‡½æ•°è°ƒç”¨ï¼Œå“ªäº›å‡½æ•°æ˜¯å¯ç”¨çš„ï¼Œç„¶åå†è¿™äº›å¯ç”¨çš„å‡½æ•°ä¸­æ‰¾åˆ°æœ€åˆé€‚çš„ï¼Œå¯¹äºå‡½æ•°æ¨¡æ¿æ¥è¯´ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹æ¨¡æ¿å‚æ•°è¿›è¡Œæ¨å¯¼æ¥ç”Ÿæˆè¿™äº›å€™é€‰çš„ç‰¹åŒ–å‡½æ•°ã€‚<br>
å…ˆçœ‹è°ƒç”¨ <code>foo(1)</code>ï¼š<br>
å¯¹äºç¬¬ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ <code>foo</code> æ¥è¯´ï¼ŒT è¢«æ¨å¯¼ä¸º <code>int</code>ï¼Œé‡è½½è§£æä¸­å‚æ•°åˆ—è¡¨ â€¦ ä¼šè¢«å¿½ç•¥ï¼Œå› ä¸ºå®ƒæ²¡æœ‰åŒ¹é…å‚æ•°ï¼Œæœ€åå¾—åˆ° <code>foo(int)</code>ã€‚å¯¹äºç¬¬äºŒä¸ªå‡½æ•°æ¨¡æ¿ <code>foo</code> æ¥è¯´ï¼Œä¹Ÿä¼šæ¨æ–­å‡º <code>foo(int)</code>ï¼Œæ‰€ä»¥è¿™ä¸¤ç§éƒ½æ˜¯å¯è¡Œçš„ï¼Œæˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªæ›´åˆé€‚çš„ã€‚<br>
C++ è§„èŒƒ<strong>é¦–å…ˆä¼šæ¯”è¾ƒå“ªä¸€ä¸ªæ¨¡æ¿çš„è½¬æ¢åºåˆ—æ›´ä½³</strong>ï¼Œä½†æ˜¯åœ¨è¿™é‡Œä¸¤ä¸ªæ¨¡æ¿çš„è½¬æ¢åºåˆ—æ˜¯ä¸€æ ·çš„ï¼›<br>
<strong>æ¥ç€æ¯”è¾ƒå“ªä¸€ä¸ªæ¨¡æ¿æ›´åŠ ç‰¹åŒ–</strong> - <em>more specialized</em> - æˆ‘ä»¬èƒ½å¤Ÿä» <code>foo2</code> ä¸­æ¨å¯¼å‡º <code>foo1</code> å´æ— æ³•ä» <code>foo1</code> ä¸­æ¨å¯¼å‡º <code>foo2</code>ï¼Œå› æ­¤å¯¹äº <code>foo(1)</code> æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªæ¨¡æ¿æ›´åˆé€‚ã€‚<br>
å†çœ‹ <code>foo(1,2)</code>ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ <code>foo</code> éœ€è¦çœç•¥ <code>...</code> æ¥åŒ¹é…è½¬æ¢åºåˆ—ï¼Œè€Œç¬¬äºŒä¸ªå‡½æ•°æ¨¡æ¿ <code>foo</code> åˆ™ä¸éœ€è¦çœç•¥ï¼Œä»æ¯”è¾ƒæ¨¡æ¿è½¬æ¢åºåˆ—çš„è§’åº¦æ¥è¯´ï¼Œç¬¬äºŒä¸ª <code>foo</code> æ›´åˆé€‚ã€‚</p>
<h4 id="Q-252">Q 252</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="string">'3'</span> - <span class="string">'2'</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
C++ æ ‡å‡†ä¸­ï¼Œåªèƒ½ä¿è¯åè¿›åˆ¶æ•°å­—ä¹‹é—´çš„é—´éš”ç›¸å·® 1ï¼Œä¸èƒ½ä¿è¯ <code>'b' - 'a' = 1</code>ã€‚</p>
<h4 id="Q-259">Q 259</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"u"</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span>)</span>          </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"i"</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">char</span>)</span>         </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"c"</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> y = <span class="number">2</span>;</span><br><span class="line">    f(x + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¾“å‡ºæœªå®š<br>
ä¸¤ä¸ª <code>char</code> ç±»å‹çš„å’Œå¹¶ä¸æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œè™½ç„¶èƒ½è‚¯å®šç»“æœä¸æ˜¯ <code>char</code>ã€‚<br>
åœ¨è¿ç®—ä¹‹å‰æ“ä½œæ•°ä¼šè¿›è¡Œé€šç”¨ç±»å‹è½¬æ¢ï¼Œè€Œ <code>char</code> åœ¨ä¸åŒçš„åœºåˆå¯èƒ½ä¼šè¢«æå‡ä¸º <code>int</code> æˆ– <code>unsigned int</code>ã€‚</p>
<h4 id="Q-264">Q 264</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">C</span> &#123;</span></span><br><span class="line">    C() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> C c;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; c.i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
ç”±äº c æ˜¯ const å¹¶ä¸”æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œæ˜¯ä¸èƒ½é»˜è®¤åˆå§‹åŒ– c çš„ã€‚<br>
C++ æ ‡å‡†è§„å®šï¼Œå¦‚æœç¨‹åºè°ƒç”¨ <code>const</code> é™å®šç±»å‹ T å¯¹è±¡çš„é»˜è®¤åˆå§‹åŒ–ï¼Œé‚£ä¹ˆ T åº”è¯¥æ˜¯ - <em>const-default-constructible</em> - å¸¸é‡é»˜è®¤å¯æ„é€ çš„ï¼Œå¸¸é‡é»˜è®¤å¯æ„é€ æŒ‡çš„æ˜¯<strong>ç±»ç±»å‹ T çš„é»˜è®¤åˆå§‹åŒ–è°ƒç”¨äº†ç”¨æˆ·æä¾›çš„ T çš„æ„é€ å‡½æ•°</strong>æˆ–è€…<strong>æ¯ä¸ªç›´æ¥çš„éå˜é‡éé™æ€æ•°æ®æˆå‘˜æœ‰é»˜è®¤æˆå‘˜åˆå§‹åŒ–</strong>ï¼Œå¦‚æœè¦å°†æœ¬é¢˜ä¿®æ”¹æ­£ç¡®æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>
ç»™ <code>int i</code> ä¸€ä¸ªåˆå§‹å€¼ <code>int i{0}</code>ï¼›<br>
ä¸º C æä¾›æ„é€ å‡½æ•°ï¼Œç§»é™¤ <code>= default</code>ï¼Œæ‰§è¡Œ <code>C::C() = default</code>ã€‚</p>
<h4 id="Q-265">Q 265</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">char</span>*&amp;&amp;)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">char</span>*&amp;)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="string">'a'</span>;</span><br><span class="line">    f(&amp;c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
<code>&amp;c</code> è¿”å›çš„æ˜¯å·¦å€¼ c çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯å³å€¼ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª <code>operator&amp;</code> è¿”å›çš„åŒ¿åä¸´æ—¶å¯¹è±¡ã€‚</p>
<h4 id="Q-273">Q 273</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"main"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">sizeof</span> <span class="keyword">new</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šmain<br>
<code>sizeof</code> è¿ç®—ç¬¦çš„æ“ä½œæ•°å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¸¦åœ†æ‹¬å·çš„ type-idã€‚<br>
æœ¬é¢˜ä¸­ <code>sizeof</code> çš„æ“ä½œæ•°æ˜¯è¡¨è¾¾å¼ <code>new A</code>ï¼Œå®ƒçš„ç±»å‹æ˜¯æŒ‡å‘ A å¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆçš„å¤§å°åœ¨æ¯ä¸ªå¹³å°æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¹¶ä¸å…³ç³»ï¼Œå› ä¸ºæ— éœ€æ‰“å°å®ƒï¼Œé—®é¢˜æ˜¯ <code>new A</code> æ˜¯å¦æ„é€ äº†ä¸€ä¸ªæ–°çš„ A å¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ææ„å®ƒã€‚<br>
C++ æ ‡å‡†è§„å®šï¼Œ<code>sizeof</code> çš„æ“ä½œæ•°å¦‚æœæ˜¯è¡¨è¾¾å¼ï¼Œå®ƒä¼šæ˜¯ä¸€ä¸ªæœªæ±‚å€¼çš„æ“ä½œæ•° - an unevaluated operandï¼Œå› æ­¤è¡¨è¾¾å¼ <code>new A</code> ä¸ä¼šè¢«æ±‚å€¼ï¼ŒA å¹¶ä¸ä¼šè¢«æ„é€ ï¼Œè¡¨è¾¾å¼ä»…ä»…ç”¨äºè®¡ç®— <code>sizeof</code>ã€‚</p>
<h4 id="Q-283">Q 283</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show_id</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~show_id() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; id; &#125;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span>[] <span class="keyword">new</span> show_id[<span class="number">3</span>]&#123; &#123;<span class="number">0</span>&#125;, &#123;<span class="number">1</span>&#125;, &#123;<span class="number">2</span>&#125; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š210<br>
è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºå¯¹è±¡ææ„çš„é¡ºåºæ˜¯æ€æ ·çš„ï¼ŒC++ ä¸­ï¼Œå¯¹è±¡é€šå¸¸æŒ‰ç…§å®ƒä»¬æ„é€ çš„ç›¸åé¡ºåºææ„ï¼ŒåŒ…æ‹¬ <code>delete[]</code> è¿ç®—ã€‚</p>
<h4 id="Q-284">Q 284</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> out&#123;<span class="string">"Hello world"</span>&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (out[out.<span class="built_in">size</span>()] == <span class="string">'\0'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
å½“ pos ä¸å­—ç¬¦ä¸²é•¿åº¦ç›¸ç­‰æ—¶ï¼Œstd::string çš„ operator[size_type pos] æ“ä½œç¬¦å¿…é¡»è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ã€‚</p>
<h4 id="Q-286">Q 286</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> short x=<span class="number">0xFFFF</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> short y=<span class="number">0xFFFF</span>;</span><br><span class="line">    <span class="keyword">auto</span> z=x*y;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (z &gt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªå®šä¹‰<br>
x å’Œ y åœ¨è¿ç®—ä¹‹å‰éƒ½ä¼šè¢«è½¬æ¢æˆå¦å¤–ä¸€ç§ç±»å‹ï¼Œåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šè¿™ä¸ªç±»å‹ä¸º <code>int</code>ï¼Œå³ 32 ä½æœ‰ç¬¦å·ã€‚<br>
ä½† 0xFFFF * 0xFFFF çš„ä¹˜ç§¯ä¸º 4294836225 å·²ç»è¶…è¿‡äº† int èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ 2147483647ï¼Œæœ‰ç¬¦å·æ•´æ•°æº¢å‡ºï¼Œå±äºæœªå®šä¹‰è¡Œä¸ºã€‚</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Programming-Language</tag>
        <tag>C++ Quiz</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Quiz é¢˜è§£ 101~200</title>
    <url>/posts/467b42a7/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>C++ Quiz é¢˜è§£ 101~200 æ•´ç†</li>
<li>æœ‰è¶£çš„é¢˜ç›®ï¼š</li>
<li>105 111 116 122 129 130 133 135 148 163</li>
<li>190 193 198</li>
</ul>
</blockquote>
<a id="more"></a>
<h4 id="Q-105">Q 105</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">label:</span><br><span class="line">    A a;</span><br><span class="line">    <span class="keyword">if</span> (i--)</span><br><span class="line">        <span class="keyword">goto</span> label;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šaAaA<br>
C++ æ ‡å‡†å¯¹äº <code>goto</code> è¯­å¥æœ‰å¦‚ä¸‹è¦æ±‚ï¼š<br>
å…·æœ‰è‡ªåŠ¨å­˜å‚¨æœŸçš„å˜é‡ä¼šåœ¨è·³è½¬ä¹‹å‰è¢«é”€æ¯è€Œä¸æ˜¯åœ¨è·³è½¬ä¹‹åè¢«é”€æ¯ã€‚</p>
<h4 id="Q-106">Q 106</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">int</span> x;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123; <span class="keyword">int</span> y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x &lt;&lt; y;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºé“¾æ¥é”™è¯¯ï¼Œè¡Œä¸ºæœªå®šä¹‰<br>
C++ ä¸ºäº†æ”¯æŒå‡½æ•°é‡è½½ï¼Œå…¶ä¸­çš„å‡½æ•°åœ¨è¢« C++ ç¼–è¯‘ååœ¨ç¬¦å·åº“ä¸­çš„åå­—ä¸ C è¯­è¨€çš„ä¸åŒã€‚ä¸ºäº†å®ç° C++ ä¸ C çš„æ··åˆç¼–ç¨‹ï¼ŒC++ å¼•å…¥äº† <code>extern &quot;C&quot;</code>ï¼Œè¢« <code>extern &quot;C&quot;</code> ä¿®é¥°çš„å‡½æ•°æˆ–è€…å˜é‡æ˜¯æŒ‰ç…§Cè¯­è¨€æ–¹å¼ç¼–è¯‘å’Œé“¾æ¥çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a;       <span class="comment">//å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a = <span class="number">0</span>;   <span class="comment">//å®šä¹‰å…¨å±€å˜é‡å¹¶ç»™åˆå€¼</span></span><br></pre></td></tr></table></figure>
<p>åŸä»£ç ä¸­çš„<code>extern &quot;C&quot; int x;</code> è¡¨ç¤ºè¢«å®ƒä¿®é¥°çš„ç›®æ ‡æ˜¯ extern çš„ï¼›å…¶æ¬¡ï¼Œè¢«å®ƒä¿®é¥°çš„ç›®æ ‡ä»£ç æ˜¯ â€œCâ€ çš„ã€‚æ‰€ä»¥è¯´è¿™æ¡è¯­å¥è¡¨ç¤ºçš„æ˜¯<strong>å£°æ˜ä¸€ä¸ª C ç±»å‹çš„å˜é‡</strong>ã€‚<br>
è€Œ<code>extern &quot;C&quot; { int y; }</code> è¡¨ç¤ºåˆ™çš„æ˜¯å®šä¹‰ä¸€ä¸ª C ç±»å‹çš„å˜é‡ã€‚</p>
<h4 id="Q-107">Q 107</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"f"</span>; <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">g</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"g"</span>; <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    h(&#123;f(), g()&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šfg<br>
è¿™é“é¢˜çš„è€ƒç‚¹æ˜¯åˆå§‹åŒ–åˆ—è¡¨ä¸­å‚æ•°çš„è®¡ç®—é¡ºåºï¼ŒC++ æ ‡å‡†è§„å®šï¼Œåˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å­å¥æŒ‰ç…§å®ƒä»¬å‡ºç°çš„é¡ºåºè¿›è¡Œè®¡ç®—ã€‚</p>
<h4 id="Q-109">Q 109</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call_with</span><span class="params">(<span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(T)&gt; f, T val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f(val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> <span class="built_in">print</span> = [] (<span class="keyword">int</span> x) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x; &#125;;</span><br><span class="line">    call_with(<span class="built_in">print</span>, <span class="number">42</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
ç¼–è¯‘å™¨ä¼šæ¨å¯¼æ¯ä¸ªå‚æ•°çš„ <code>T</code> å¹¶æ£€æŸ¥æ¨å¯¼ç±»å‹æ˜¯å¦åŒ¹é…ã€‚<br>
<code>lambda</code> æ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹ï¼Œä¸èƒ½ä¸ <code>std::function&lt;void(T)</code>&gt; åŒ¹é…ï¼Œè¿™ç§æƒ…å†µéœ€è¦å°†ç¬¬ä¸€ä¸ªå‚æ•°è½¬æ¢ä¸ºéæ¨å¯¼ä¸Šä¸‹æ–‡ - <em>nondeduced context</em> - æ¥è§£å†³ã€‚<br>
éæ¨å¯¼ä¸Šä¸‹æ–‡æ˜¯ä¸€ç§ç±»å‹çš„åµŒå¥—åç§°è¯´æ˜ç¬¦ã€‚<br>
ä¸¾å‡ ä¸ªä¾‹å­ï¼š<br>
ç±»å‹ <code>A&lt;T&gt;::B&lt;T2&gt;</code> ä¸­ <code>T</code> ä¸ <code>T2</code> éƒ½æ˜¯éæ¨å¯¼çš„ï¼›<br>
<code>void f(typename A&lt;T&gt;::B, A&lt;T&gt;)</code> ä¸­çš„ç¬¬ä¸€ä¸ª <code>T</code> æ˜¯éæ¨å¯¼çš„ï¼Œç¬¬äºŒä¸ª <code>T</code> æ˜¯æ¨å¯¼çš„ã€‚<br>
ä½¿ç”¨ä¸€ä¸ª helper struct è¾…åŠ©ç»“æ„æ¨¡æ¿å¯ä»¥å°† <code>std::function&lt;void(T)&gt;</code> è½¬æ¢ä¸ºéæ¨å¯¼ä¸Šä¸‹æ–‡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">type_identity</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> T type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call_with</span><span class="params">(<span class="keyword">typename</span> type_identity&lt;<span class="built_in">std</span>::function&lt;<span class="keyword">void</span>(T)&gt;&gt;::type f, T val)</span> </span>&#123;</span><br><span class="line">    f(val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åƒä¸‹é¢è¿™æ ·æ˜ç¡®æŒ‡å®šæ¨¡æ¿å‚æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">call_with&lt;<span class="keyword">int</span>&gt;(<span class="built_in">print</span>, <span class="number">42</span>);</span><br></pre></td></tr></table></figure>
<h4 id="Q-111">Q 111</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">if</span>(i &lt; <span class="number">3</span>) <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
<code>continue</code> è¯­å¥ä¼šå°†æ§åˆ¶ä¼ é€’ç»™æœ€å°å°é—­è¿­ä»£è¯­å¥çš„å¾ªç¯å»¶ç»­éƒ¨åˆ†ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯<strong>å¾ªç¯çš„æœ«å°¾è€Œä¸æ˜¯èµ·å§‹</strong>ã€‚</p>
<h4 id="Q-112">Q 112</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    A(<span class="keyword">const</span> A&amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">    A(A&amp;&amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span></span><br><span class="line">    A a;</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"4"</span>; &#125;</span><br><span class="line">    B(<span class="keyword">const</span> B&amp; b) : a(b.a) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"5"</span>; &#125;</span><br><span class="line">    B(B&amp;&amp; b) : a(b.a) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"6"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b1;</span><br><span class="line">    B b2 = <span class="built_in">std</span>::<span class="built_in">move</span>(b1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1426<br>
b1 é»˜è®¤æ„é€ æˆåŠŸä¹‹å‰ a å…ˆé»˜è®¤æ„é€ ï¼Œå› æ­¤è¾“å‡º 14.<br>
æ¥ç€ç”¨ç§»åŠ¨æ„é€ å‡½æ•°åˆå§‹åŒ– b2ï¼Œ<code>std::move(b1)</code> å°† b1 çš„å¼•ç”¨è½¬åŒ–ä¸ºä¸€ä¸ªå°†äº¡å€¼ï¼Œåœ¨ B çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸­ï¼Œa åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è¢«æ„é€ ï¼Œå°½ç®¡æ­¤å¤„çš„ b æ˜¯ä¸€ä¸ªç»‘å®šäº†å³å€¼çš„å³å€¼å¼•ç”¨ï¼Œb æœ¬èº«ä»ç„¶æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå› æ­¤è°ƒç”¨çš„æ˜¯ A çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œæœ€åè¾“å‡º 26ã€‚</p>
<h4 id="Q-114">Q 114</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span>       </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;C&gt; v;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;C&gt; u;</span><br><span class="line">    C *<span class="keyword">const</span> p;</span><br><span class="line">    S() : v(<span class="number">1</span>), u(<span class="keyword">new</span> C()), p(u.<span class="built_in">get</span>()) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    S s;</span><br><span class="line">    <span class="keyword">const</span> S &amp;r = s;</span><br><span class="line"></span><br><span class="line">    s.v[<span class="number">0</span>].foo();</span><br><span class="line">    s.u-&gt;foo();</span><br><span class="line">    s.p-&gt;foo();</span><br><span class="line"></span><br><span class="line">    r.v[<span class="number">0</span>].foo();</span><br><span class="line">    r.u-&gt;foo();</span><br><span class="line">    r.p-&gt;foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šAAABAA<br>
C++ æ ‡å‡†è§„å®šï¼Œcv é™å®šç¬¦åº”ç”¨äºæŒ‡é’ˆè€Œä¸æ˜¯æŒ‡å‘çš„å¯¹è±¡ã€‚<br>
å› æ­¤å¯¹äºåŸå§‹æŒ‡é’ˆå’Œå¼•ç”¨ï¼ŒåŒ…æ‹¬è¯•å›¾æ¨¡æ‹Ÿå®ƒä»¬çš„æ ‡å‡†ç±»å‹ <code>std::unique_ptr</code> æ¥è¯´ï¼Œ<code>const</code> é™å®šç¬¦å±äºæµ…é™å®šï¼Œè€Œå¯¹äºæ ‡å‡†å®¹å™¨æ¥è¯´ï¼Œ<code>const</code> åˆ™ä¸æ˜¯æµ…é™å®šã€‚<br>
ä¸Šé¢çš„ä»£ç ä¸­å¯¹è±¡ s æ˜¯ non-const çš„ï¼Œå› æ­¤è¯¥å¯¹è±¡çš„æˆå‘˜éƒ½ä¿ç•™äº†å®ƒçš„é»˜è®¤å¸¸é‡å±æ€§ï¼Œå³ non-constï¼Œå¹¶ä¸”æ‰€æœ‰å¯¹è¯¥å¯¹è±¡æˆå‘˜çš„è°ƒç”¨éƒ½ä½¿ç”¨ <code>C::foo()</code> çš„ non-const ç‰ˆæœ¬ã€‚<br>
ç„¶è€Œï¼Œr æ˜¯å¯¹è±¡ s çš„å¸¸é‡å¼•ç”¨ï¼Œconst é™å®šç¬¦æ”¹å˜äº†å®ƒçš„æˆå‘˜ v çš„è¡Œä¸ºï¼Œæ­¤æ—¶ <code>std::vector</code> çš„ <code>operator[]</code> è¿”å›çš„æ˜¯ <code>const C&amp;</code>ï¼Œå› æ­¤è°ƒç”¨çš„æ˜¯ <code>C::foo()</code> çš„ const ç‰ˆæœ¬ï¼ŒåŒæ—¶ r çš„ const å±æ€§ä¹Ÿä¼ é€’ç»™å®ƒçš„æˆå‘˜ u å’Œ pï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡é’ˆæœ¬èº«å˜æˆäº†å¸¸é‡ï¼Œä½†æŒ‡å‘çš„å¯¹è±¡å¹¶ä¸æ˜¯å¸¸é‡ï¼Œå› æ­¤å®ƒä»¬ä»ç„¶è°ƒç”¨ <code>C::foo()</code> çš„ non-const ç‰ˆæœ¬ã€‚<br>
æœ€åï¼Œè¿˜è¦æ³¨æ„ <code>C* const p</code> æ˜¯ä¸€ä¸ªæŒ‡å‘éå¸¸é‡å¯¹è±¡çš„å¸¸é‡æŒ‡é’ˆã€‚</p>
<h4 id="Q-115">Q 115</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"i"</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"d"</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">float</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"f"</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f(<span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šd<br>
æµ®ç‚¹æ•°å­—é¢é‡çš„ç±»å‹ä¸º <code>double</code>ï¼Œé™¤éæ˜ç¡®åœ°ç”¨åç¼€æŒ‡å®šã€‚</p>
<h4 id="Q-116">Q 116</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">y</span><span class="params">(<span class="keyword">int</span> &amp;)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">y</span><span class="params">(<span class="keyword">int</span> &amp;&amp;)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">int</span> <span class="title">f</span>(<span class="title">T</span> &amp;&amp;<span class="title">x</span>) &#123;</span> <span class="keyword">return</span> y(x); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">int</span> <span class="title">g</span>(<span class="title">T</span> &amp;&amp;<span class="title">x</span>) &#123;</span> <span class="keyword">return</span> y(<span class="built_in">std</span>::<span class="built_in">move</span>(x)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">int</span> <span class="title">h</span>(<span class="title">T</span> &amp;&amp;<span class="title">x</span>) &#123;</span> <span class="keyword">return</span> y(<span class="built_in">std</span>::forward&lt;T&gt;(x)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; f(i) &lt;&lt; f(<span class="number">20</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; g(i) &lt;&lt; g(<span class="number">20</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; h(i) &lt;&lt; h(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š112212<br>
<strong>æ¨¡æ¿åŒ–å‡½æ•°ä¸­çš„ T&amp;&amp; ä¸ä¸€å®šè¡¨ç¤ºå³å€¼å¼•ç”¨ï¼Œå¦‚æœç”¨å·¦å€¼å®ä¾‹åŒ–ï¼Œå®ƒä¼šåç¼©æˆå·¦å€¼å¼•ç”¨ï¼Œå¦‚æœç”¨å³å€¼å®ä¾‹åŒ–ï¼Œåˆ™ä¼šåç¼©æˆå³å€¼å¼•ç”¨</strong>ã€‚<br>
è¿™ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«ä½¿ç”¨å·¦å€¼å’Œå³å€¼è°ƒç”¨äº†ä¸€æ¬¡ï¼Œä¸‰ç§æƒ…å†µä¸‹éƒ½ä¼šåˆ†åˆ«åç¼©æˆå·¦å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä½†æ˜¯<strong>åœ¨å‡½æ•°å†…éƒ¨ï¼Œx æœ¬èº«å°±æ˜¯å·¦å€¼ï¼Œä¸ç®¡å®ƒçš„ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨è¿˜æ˜¯å³å€¼å¼•ç”¨</strong>ã€‚</p>
<h4 id="Q-118">Q 118</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">char</span> <span class="keyword">const</span> *str)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(short num)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; num; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"abc"</span>);</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'A'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯ï¼Œ<code>print(0)</code> é‡è½½å‡½æ•°è°ƒç”¨ä¸æ˜ç¡®<br>
ç©ºæŒ‡é’ˆå¸¸é‡æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ä¸º 0 çš„æ•´å‹å­—é¢é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ std::nullptr_t ç±»å‹çš„å³å€¼ã€‚<br>
å› æ­¤ 0 æ—¢å¯ä»¥éšå¼è½¬åŒ–ä¸ºä»»ä½•æŒ‡é’ˆç±»å‹ï¼Œä¹Ÿå¯ä»¥éšå¼è½¬åŒ–ä¸º short ç±»å‹ã€‚</p>
<h4 id="Q-119">Q 119</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span> * p = &amp;p;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">bool</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
p ä¸­ä¿å­˜çš„æ˜¯å®ƒè‡ªå·±çš„åœ°å€ã€‚</p>
<h4 id="Q-120">Q 120</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    x = a, b;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š10<br>
é€—å·è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§åœ¨ C++ ä¸­æ˜¯æœ€ä½çš„ã€‚</p>
<h4 id="Q-122">Q 122</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">unsigned</span> ll)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    foo(<span class="number">2u</span>ll);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š2<br>
é»˜è®¤æƒ…å†µä¸‹ <code>signed</code> <code>unsigned</code> <code>long</code> <code>short</code> éƒ½æš—æŒ‡ <code>int</code>ï¼Œå› æ­¤åœ¨è¿™äº›ç¬¦å·ç±»å‹ä¹‹åå‡ºç°çš„ç±»å‹åç§°å‡è¢«è§†ä¸ºå£°æ˜çš„åç§°ã€‚<br>
å› æ­¤ <code>void foo(unsigned ll)</code> è¢«ç¼–è¯‘å™¨è®¤ä¸ºæ˜¯éœ€è¦ä¸€ä¸ª <code>unsigned(int)</code> ç±»å‹çš„å˜é‡ï¼Œåç§°ä¸º <code>ll</code>ã€‚</p>
<h4 id="Q-125">Q 125</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">void</span> <span class="title">f</span>(<span class="title">T</span>) &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ++i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f(<span class="number">1</span>);</span><br><span class="line">    f(<span class="number">1.0</span>);</span><br><span class="line">    f(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š112<br>
æ¯ä¸ªå®ä¾‹åŒ–åçš„å‡½æ•°æ¨¡æ¿éƒ½æœ‰å®ƒè‡ªå·±çš„ä¸€ä»½é™æ€å˜é‡çš„æ‹·è´ã€‚<br>
æœ¬é¢˜ä¸­æˆ‘ä»¬æœ‰ä¸¤ä¸ª f çš„å®ä¾‹åŒ–ï¼Œä¸€ä¸ª T = intï¼Œå¦ä¸€ä¸ª T = doubleï¼Œf(double) ä¸­çš„é™æ€å˜é‡ i ä¸ f(int) ä¸­çš„é™æ€å˜é‡ i ä¸æ˜¯åŒä¸€ä¸ª iã€‚</p>
<h4 id="Q-126">Q 126</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foobar</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">11</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> foobar::x = foo();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; foobar::x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š11<br>
åœ¨ç±»çš„é™æ€æˆå‘˜å®šä¹‰ä¸­ä½¿ç”¨çš„åç§°å’Œç±»ä¸­æˆå‘˜å‡½æ•°çš„åç§°æ˜¯ä¸€è‡´çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå°½ç®¡ <code>foo()</code> è°ƒç”¨å‘ç”Ÿåœ¨ç±»å¤–ï¼Œä½†æ˜¯å®ƒä½äºé™æ€æ•°æ®æˆå‘˜çš„å®šä¹‰ä¸­ï¼Œå¯ä»¥çœ‹ä½œ <code>foo()</code> æ˜¯ <code>footbar</code> çš„æˆå‘˜å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸æ˜¯å…¨å±€ <code>foo()</code> çš„è°ƒç”¨ã€‚</p>
<h4 id="Q-129">Q 129</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; delimiters = &#123; <span class="string">","</span>, <span class="string">";"</span> &#125;;  </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; delimiters[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªå®šä¹‰<br>
è¿™é“é¢˜ç”¨ä¸¤ä¸ªå­—ç¬¦ä¸²å­—é¢é‡æ¥åˆå§‹åŒ– <code>vector&lt;char&gt;</code>ï¼Œæ¨¡æ¿ç±» <code>template &lt;class T&gt; vector</code> çš„åˆå§‹åŒ–åˆ—è¡¨çš„æ„é€ å‡½æ•°ä¸º <code>vector(initializer_list&lt;T&gt;)</code> ï¼Œæœ¬é¢˜ä¸­ä¸º <code>vector(initializer_list&lt;char&gt;)</code>ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢é‡çš„ç±»å‹ä¸º - <em>array of n const char</em> - å¸¸é‡å­—ç¬¦æ•°ç»„ï¼Œå¹¶ä¸åŒ¹é…ã€‚<br>
ä½†æ˜¯è¿™é¢˜ä¸ºä»€ä¹ˆæ²¡æœ‰å‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œæ˜¯å› ä¸ºç¼–è¯‘å™¨æ‰¾åˆ°äº†å¦ä¸€ä¸ªåŒ¹é…çš„æ„é€ å‡½æ•°ã€‚<br>
C++ æ ‡å‡†è§„å®šï¼Œå½“ç±»å‹ä¸º T çš„ç±»å¯¹è±¡é‡‡ç”¨åˆ—è¡¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé‡è½½è§£æä¼šæœ‰ä¸¤ä¸ªé€‰æ‹©æ„é€ å‡½æ•°çš„é˜¶æ®µï¼š<br>
é¦–å…ˆï¼Œå€™é€‰å‡½æ•°æ˜¯ç±» T çš„åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°ï¼Œå‚æ•°åˆ—è¡¨åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³åˆå§‹åŒ–åˆ—è¡¨ï¼›<br>
å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ„é€ å‡½æ•°ï¼Œé‡è½½è§£æä¼šä»ç±» T çš„æ‰€æœ‰æ„é€ å‡½æ•°ä¸­å¯»æ‰¾å€™é€‰å‡½æ•°ï¼Œå‚æ•°åˆ—è¡¨ç”±åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å…ƒç´ ç»„æˆï¼›<br>
å¯¹äºæœ¬é¢˜æ¥è¯´ï¼Œ<code>template &lt;class InputIterator&gt; vector(InputIterator first, InputIterator last)</code> æ°å¥½æ»¡è¶³ç¬¬äºŒç§æƒ…å†µï¼Œæ„é€ å‡½æ•°è®¤ä¸ºå®ƒä¼ å…¥äº†ä¸¤ä¸ªæ­£ç¡®çš„è¿­ä»£å™¨ç±»å‹ï¼Œä½†æ˜¯å…¶å®è¿™ä¸¤ä¸ªè¿­ä»£å™¨åˆ†åˆ«å±äºä¸¤ä¸ªä¸åŒçš„åºåˆ—ï¼Œå› æ­¤è¿™ä¸ªç¨‹åºè¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p>
<h4 id="Q-130">Q 130</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">adl</span><span class="params">(T)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"T"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call_adl</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    adl(S());</span><br><span class="line">    adl(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">adl</span><span class="params">(S)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"S"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    call_adl(S());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šTS<br>
å½“æŸ¥æ‰¾æ¨¡æ¿å®šä¹‰ä¸­ä½¿ç”¨çš„åç§°çš„å£°æ˜æ—¶ï¼Œå¯¹äºéä¾èµ–æ¨¡æ¿å‚æ•°çš„åç§°æŸ¥æ‰¾ä½¿ç”¨çš„æ˜¯é€šå¸¸çš„æŸ¥æ‰¾è§„åˆ™ï¼Œè€Œä¾èµ–æ¨¡æ¿å‚æ•°çš„åç§°æŸ¥æ‰¾ä¼šå»¶è¿Ÿåˆ°å®é™…æ¨¡æ¿å‚æ•°å·²çŸ¥æ—¶ã€‚<br>
adl(s()) å±äºéä¾èµ–è°ƒç”¨ï¼Œå› æ­¤åœ¨å®šä¹‰å‡½æ•°æ¨¡æ¿çš„æ—¶å€™å°±è¿›è¡Œäº†åç§°æŸ¥æ‰¾ï¼›<br>
adl(t) å±äºä¾èµ–è°ƒç”¨ï¼Œè¯¥è°ƒç”¨çš„è§£ææ¨è¿Ÿåˆ°æ¨¡æ¿å®ä¾‹åŒ–ä¹‹åï¼›<br>
å½“åœ¨å®šä¹‰å‡½æ•°æ¨¡æ¿æ—¶æŸ¥æ‰¾ adl æ—¶ï¼Œå­˜åœ¨çš„ adl çš„å”¯ä¸€ç‰ˆæœ¬å°±æ˜¯ adl(t)ï¼Œæ­¤æ—¶ adl(S) è¿˜ä¸å­˜åœ¨ï¼Œå› æ­¤åªä¼šè°ƒç”¨ adl(T)ã€‚</p>
<h4 id="Q-131">Q 131</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span>)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"i"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    C(<span class="keyword">double</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"d"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">C <span class="title">c1</span><span class="params">(<span class="number">7</span>)</span></span>;</span><br><span class="line">    C c2 = <span class="number">7</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šid<br>
ç”±äº explicit å…³é”®å­—çš„å­˜åœ¨ï¼Œ<code>C c2 = 7</code> ä¸­æ˜¯ä¸ä¼šè°ƒç”¨éšå¼è½¬åŒ–æ„é€ å‡½æ•°çš„ï¼Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹æ•´å‹å­—é¢é‡ä¼šè¢«è½¬åŒ–ä¸º <code>double</code> ç±»å‹æ„é€ å‡½æ•°ã€‚</p>
<h4 id="Q-132">Q 132</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">int</span> i = foo())</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    bar();</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š11<br>
<code>foo()</code> è¢«è°ƒç”¨äº†ä¸¤æ¬¡</p>
<h4 id="Q-133">Q 133</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">    A(<span class="keyword">const</span> A &amp;) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">public</span> <span class="keyword">virtual</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">    B(<span class="keyword">const</span> B &amp;) &#123; <span class="built_in">cout</span>&lt;&lt; <span class="string">"b"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span> <span class="keyword">public</span> <span class="keyword">virtual</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    C() &#123; <span class="built_in">cout</span>&lt;&lt; <span class="string">"C"</span>; &#125;</span><br><span class="line">    C(<span class="keyword">const</span> C &amp;) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"c"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>:</span>B,C &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    D() &#123; <span class="built_in">cout</span>&lt;&lt; <span class="string">"D"</span>; &#125;</span><br><span class="line">    D(<span class="keyword">const</span> D &amp;) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"d"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    D d1;</span><br><span class="line">    <span class="function">D <span class="title">d2</span><span class="params">(d1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šABCDABCd<br>
æ„é€  d1 çš„æ—¶å€™ï¼Œæ´¾ç”Ÿç±»æ˜¯æŒ‰ç…§åŸºç±»è¯´æ˜åˆ—è¡¨ä¸­çš„é¡ºåºæ¥æ„é€ çš„ï¼Œå› æ­¤è¾“å‡º ABCDï¼›<br>
å¯¹äº d2 æ¥è¯´ï¼Œä¸€ä¸ªéšå¼å®šä¹‰çš„æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°æ˜¯ä¼šè°ƒç”¨å®ƒåŸºç±»çš„æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°çš„ï¼Œä½†æ˜¯å¦‚æœæä¾›äº†ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œå°±å¿…é¡»è¦æ‰‹åŠ¨è®¾ç½®è°ƒç”¨åŸºç±»çš„æ‹·è´/ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p>
<h4 id="Q-135">Q 135</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">bool</span>,<span class="keyword">int</span>&gt; mb = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">3</span>,<span class="number">4</span>&#125;,&#123;<span class="number">5</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; mb.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; mi = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">3</span>,<span class="number">4</span>&#125;,&#123;<span class="number">5</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; mi.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š13<br>
<code>map</code> ä¸­çš„ <code>key</code> æ˜¯å”¯ä¸€çš„ï¼Œè€Œ mb ä¸­çš„ä¸‰ä¸ª <code>key</code> éƒ½æ˜¯ <code>true</code>ï¼Œå› æ­¤ size ä¸º 1ã€‚</p>
<h4 id="Q-140">Q 140</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">get_size_1</span><span class="params">(<span class="keyword">int</span>* arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">sizeof</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">get_size_2</span><span class="params">(<span class="keyword">int</span> arr[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">sizeof</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">get_size_3</span><span class="params">(<span class="keyword">int</span> (&amp;arr)[<span class="number">10</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">sizeof</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="comment">//Assume sizeof(int*) != sizeof(int[10])</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (<span class="keyword">sizeof</span>(<span class="built_in">array</span>) == get_size_1(<span class="built_in">array</span>));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (<span class="keyword">sizeof</span>(<span class="built_in">array</span>) == get_size_2(<span class="built_in">array</span>));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (<span class="keyword">sizeof</span>(<span class="built_in">array</span>) == get_size_3(<span class="built_in">array</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š001<br>
é¦–å…ˆï¼Œ<code>sizeof(array)</code> è¿”å›çš„æ˜¯æ•°ç»„ array çš„å¤§å°ã€‚<br>
åœ¨ <code>get_size_3</code> å‡½æ•°ä¸­ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå¤§å°ä¸º 10 çš„ <code>int</code> ç±»å‹æ•°ç»„çš„å¼•ç”¨ï¼ŒC++ æ ‡å‡†è§„å®šï¼Œå¯¹ä¸€ä¸ªå¼•ç”¨ç±»å‹ä½¿ç”¨ <code>sizeof</code> è¿ç®—ç¬¦ï¼Œç»“æœæ˜¯è¢«å¼•ç”¨ç±»å‹çš„å¤§å°ï¼Œå› æ­¤ <code>get_size_3</code> è¿”å› 10ã€‚<br>
è€Œ <code>get_size_1</code> <code>get_size_2</code> çš„å‚æ•°å‡ä¸ºæŒ‡é’ˆï¼Œå…¶ä¸­ <code>get_size_2</code> çš„å‚æ•°ä¼šä»æ•°ç»„é€€åŒ–æˆæŒ‡é’ˆï¼Œ<code>sizeof</code> è¿ç®—ç¬¦è¿”å›æŒ‡é’ˆå˜é‡çš„å¤§å°ã€‚</p>
<h4 id="Q-144">Q 144</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N[] = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">long</span> <span class="keyword">int</span>&gt;::digits==<span class="number">63</span> &amp;&amp;</span><br><span class="line">    <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">int</span>&gt;::digits==<span class="number">31</span> &amp;&amp;</span><br><span class="line">    <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;::digits==<span class="number">32</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">long</span> <span class="keyword">int</span> i = <span class="number">-0xffffffff</span>; i ; --i) &#123;</span><br><span class="line">            N[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;  </span><br><span class="line">        N[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; N[<span class="number">0</span>] &lt;&lt; N[<span class="number">1</span>] &lt;&lt; N[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š010<br>
æ— ç¬¦å·é‡çš„è´Ÿå€¼æ˜¯ä» 2 ^ n å‡å»å®ƒçš„å€¼è®¡ç®—å‡ºæ¥çš„ï¼Œå…¶ä¸­ n æ˜¯æå‡æ“ä½œæ•°ä¸­çš„ä½æ•°ã€‚<br>
æœ¬é¢˜ä¸­ n ä¸º 32ï¼Œå› æ­¤ i = 1ã€‚</p>
<h4 id="Q-145">Q 145</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">E</span> &#123;</span></span><br><span class="line">    E() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    E(<span class="keyword">const</span> E&amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">    ~E() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">E <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> E();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š13<br>
è¿™é“é¢˜çš„å…³é”®åœ¨äº E() åˆ°åº•æ˜¯ä»€ä¹ˆã€‚<br>
C++ æ ‡å‡†è§„å®šï¼Œçº¯å³å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼çš„å€¼ç”¨äºåˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€ä½åŸŸæˆ–è€…è®¡ç®—è¿ç®—ç¬¦çš„æ“ä½œå€¼ã€‚<br>
return è¯­å¥é€šè¿‡æ‹·è´æ„é€ å‡½æ•°å°†å‡½æ•°è°ƒç”¨å¯¹è±¡åˆå§‹åŒ–ä¸ºå…¨å±€å·¦å€¼æˆ–çº¯å³å€¼ã€‚<br>
E() åªæ˜¯ä¸€ä¸ªçº¯å³å€¼ã€‚</p>
<h4 id="Q-147">Q 147</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>; <span class="comment">//What is wrong here??/</span></span><br><span class="line">    x = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
<code>??/</code> åœ¨ C++17 ä¸­å·²ç»è¢« <code>\</code> å–ä»£äº†ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ <a href="https://stackoverflow.com/questions/1234582/purpose-of-trigraph-sequences-in-c" target="_blank" rel="noopener">C++ Trigraph</a></p>
<h4 id="Q-148">Q 148</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (a + a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªå®šä¹‰<br>
è¿™é‡Œçš„é—®é¢˜ä¸æ˜¯ç¼ºå°‘å˜é‡ a çš„åˆå§‹åŒ– - è¿™é‡Œä¼šéšå¼åˆå§‹åŒ–ä¸º 0ï¼Œè€Œæ˜¯ä¸¤æ¬¡è®¿é—®å˜é‡ a çš„é¡ºåºæ²¡æœ‰æ’åºã€‚<br>
C++ æ ‡å‡†è§„å®šï¼Œè®¿é—® volatile ç±»å‹çš„ glvalueï¼ˆå·¦å€¼æˆ–å°†äº¡å€¼ï¼‰ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œé’ˆå¯¹åŒä¸€ç‰‡å†…å­˜åŒºåŸŸçš„æ— åºè®¿é—®å±äºæœªå®šä¹‰è¡Œä¸ºã€‚</p>
<h4 id="Q-151">Q 151</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;type_traits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::is_signed&lt;<span class="keyword">char</span>&gt;::value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¾“å‡ºæœªæŒ‡å®š<br>
char å¯¹è±¡èƒ½å¦ä¿å­˜è´Ÿå€¼å®Œå…¨æ˜¯ç”±å®ç°å†³å®šçš„ã€‚</p>
<h4 id="Q-153">Q 153</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* str = <span class="string">"X"</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
å­—ç¬¦ä¸²å­—é¢é‡çš„ç±»å‹ä¸º <code>const</code> å­—ç¬¦æ•°ç»„ï¼Œè™½ç„¶å¤§å¤šæ•°ç¼–è¯‘å™¨å…è®¸ <code>char const []</code> ç±»å‹è½¬æ¢ä¸º <code>char*</code>ï¼Œä½†æ˜¯ C++11 å¼€å§‹è¿™æ˜¯ä¸åˆæ³•çš„æ“ä½œã€‚</p>
<h4 id="Q-157">Q 157</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt; (&amp;<span class="keyword">typeid</span>(A) == &amp;<span class="keyword">typeid</span>(A));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šè¾“å‡ºä¸ç¡®å®š<br>
<code>typeid</code> è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªé™æ€ç±»å‹ <code>const std::type_info</code> çš„å·¦å€¼ï¼Œå› æ­¤æˆ‘ä»¬æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæŒ‡å‘ <code>const std::type_info</code> çš„æŒ‡é’ˆï¼ŒC++ æ ‡å‡†ä¸­å¹¶ä¸ä¿è¯æ‰€æœ‰é’ˆå¯¹ç›¸åŒç±»å‹çš„ <code>typeid</code> è¡¨è¾¾å¼çš„è®¡ç®—éƒ½ä¼šå¼•ç”¨åŒä¸€ä¸ª <code>std::type_info</code> ç±»å‹çš„å®ä¾‹ï¼Œå› æ­¤æ­¤å¤„ç­”æ¡ˆæ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<h4 id="Q-158">Q 158</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    Foo() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"a"</span>; &#125;</span><br><span class="line">    Foo(<span class="keyword">const</span> Foo&amp;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"b"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Foo&gt; <span class="title">bar</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šaaaaa<br>
ä» C++11 å¼€å§‹ï¼Œ<code>std::vector</code> å…·æœ‰åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°ï¼š<code>explicit vector(size_type n, const Allocator&amp; = Allocator())</code>ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª<strong>å…·æœ‰ n ä¸ªå·²ç»å€¼åˆå§‹åŒ–äº†çš„å…ƒç´ </strong>çš„ vectorï¼Œæ¯ä¸€ä¸ªå€¼åˆå§‹åŒ–çš„å…ƒç´ éƒ½éœ€è¦è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚</p>
<h4 id="Q-159">Q 159</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x &lt;&lt; i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i = <span class="number">3</span>;</span><br><span class="line">    f(i++);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š34<br>
C++ æ ‡å‡†è§„å®šï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¿›å…¥å‡½æ•°ä¹‹å‰ï¼Œå¯¹å‡½æ•°æ‰€æœ‰å‚æ•°çš„è®¡ç®—éƒ½å·²ç»ç»“æŸï¼Œå› æ­¤è¿›å…¥å‡½æ•° <code>f(i++)</code> ä¹‹å‰ i å·²ç»è‡ªå¢å®Œæˆï¼Œæ‰€ä»¥å‡½æ•°ä¸­çš„ i å€¼ä¸º 4ã€‚</p>
<h4 id="Q-161">Q 161</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (n % <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                ++i;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                ++i;</span><br><span class="line">            &#125; <span class="keyword">while</span> (--n &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š5<br>
C++ æ ‡å‡†è§„å®šï¼Œ<code>switch</code> è¯­å¥åå¯ä»¥è·Ÿéšä»»ä½•æœ‰æ•ˆè¯­å¥ï¼ŒåŒ…æ‹¬å¤åˆè¯­å¥ï¼Œ<code>do-while</code> çš„æ‰§è¡Œä¸ä¼šè¢« <code>case</code> æ ‡ç­¾æ‰€æ”¹å˜ã€‚</p>
<h4 id="Q-162">Q 162</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>&#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> :</span> B&lt;T&gt;&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>&#123;</span><br><span class="line">        f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    D&lt;<span class="keyword">int</span>&gt; d;</span><br><span class="line">    d.g();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
æ ¹æ® C++ æ ‡å‡†ï¼Œåœ¨ç±»æˆ–ç±»æ¨¡æ¿çš„å®šä¹‰ä¸­ï¼Œå¦‚æœåŸºç±»ä¾èµ–äºæ¨¡æ¿å‚æ•°ï¼Œåˆ™åœ¨ç±»æ¨¡æ¿çš„å®šä¹‰å¤„ä»¥åŠç±»æ¨¡æ¿çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ä¸ä¼šæ£€æŸ¥åŸºç±»çš„èŒƒå›´ã€‚å› æ­¤å½“ç¼–è¯‘å™¨çœ‹åˆ° <code>g()</code> è°ƒç”¨ <code>f()</code> çš„æ—¶å€™ï¼Œåº”è¯¥ä»å…¨å±€ä½œç”¨åŸŸä¸­é€‰æ‹©ä¸€ä¸ªã€‚</p>
<h4 id="Q-163">Q 163</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> foo = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span>&amp; <span class="title">getFoo</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> foo; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printFoo</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; foo; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> bar = a.getFoo();</span><br><span class="line">    ++bar;</span><br><span class="line"></span><br><span class="line">    a.printFoo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š0<br>
å¯¹äºå‡½æ•°æ¨¡æ¿æ¥è¯´ï¼Œæ¯ä¸ªå·²å£°æ˜å˜é‡çš„ç±»å‹éƒ½æ˜¯ç”±å ä½ç¬¦ç±»å‹æ¨å¯¼å†³å®šçš„ã€‚<br>
ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ä¸€è‡´ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Method 1</span></span><br><span class="line"><span class="keyword">auto</span> bar = a.getFoo();</span><br><span class="line"><span class="comment">// Method 2</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">void</span> <span class="title">f</span><span class="params">(T t)</span></span>;</span><br><span class="line">f(a.getFoo());</span><br></pre></td></tr></table></figure>
<p>è€Œå‡½æ•°æ¨¡æ¿å‚æ•°çš„æ¨æ–­è¿‡ç¨‹ä¼šå°è¯•ç€å»æ‰¾åˆ°ä¸€ä¸ªå‚æ•°<strong>ä½¿å¾—æ¨æ–­å‡ºçš„å‚æ•°ä¸è°ƒç”¨çš„å‚æ•°ä¿æŒä¸€è‡´</strong> - <em>the deduction process attempts to find template argument values that will make the deduced A identical to A where A is the type of the argument of the call</em><br>
<code>getFoo()</code> è¿”å› <code>int&amp;</code> ç±»å‹ï¼ŒC++ æ ‡å‡†è§„å®šï¼Œå¦‚æœè¡¨è¾¾å¼æœ€åˆå…·æœ‰ <code>T&amp;</code> ç±»å‹ï¼Œåœ¨è¿›è¡Œä»»ä½• further analysis ä¹‹å‰ç±»å‹éƒ½ä¼šè¢«è°ƒæ•´ä¸º <code>T</code>ã€‚<br>
å› æ­¤ <code>a.getFoo()</code> çš„ç±»å‹è¢«æ¨æ–­ä¸º <code>int</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>f(T t)</code> ä¸­ <code>T</code> ä¹Ÿä¸º <code>int</code>ï¼Œ<code>bar</code> çš„ç±»å‹ä¹Ÿä¸º <code>int</code>ã€‚</p>
<h4 id="Q-174">Q 174</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; b;</span><br><span class="line">    a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">    f(x,x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š01<br>
å˜é‡ a å’Œ b éƒ½ç»‘å®šåœ¨åŒä¸€ä¸ª x ä¸Šï¼Œconst int&amp; b è¡¨ç¤ºå‡½æ•°ä¸­ä¸èƒ½é€šè¿‡å¼•ç”¨ä¿®æ”¹ä¼ å…¥å‚æ•°çš„å€¼ã€‚</p>
<h4 id="Q-177">Q 177</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>&gt;::digits;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šè¾“å‡ºä¸ç¡®å®šï¼ˆå¯èƒ½ä¸º 8ï¼‰<br>
å¤§æ¦‚ç‡çš„æç¬‘é¢˜ï¼Œ<code>unsigned char</code> å’Œ <code>char</code> å¤§å°ç›¸åŒï¼Œ<code>char</code> çš„å¤§å°è¶³ä»¥å­˜å‚¨å®ç°çš„åŸºæœ¬å­—ç¬¦é›†çš„ä»»ä½•æˆå‘˜å³å¯ã€‚</p>
<h4 id="Q-184">Q 184</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"i"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Derived</span> :</span> Base &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"d"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    d.f(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šd<br>
é‡è½½è§£æä¹‹æ‰€ä»¥æ²¡æœ‰é€‰æ‹©æ˜æ˜¾æ›´ä¼˜çš„å‡½æ•° void f(int)ï¼Œå› ä¸º void f(int) æ ¹æœ¬ä¸åœ¨é‡è½½è§£æçš„èŒƒå›´å†…ã€‚<br>
æ´¾ç”Ÿç±»ä¸­å¼•å…¥å‡½æ•°åç§° f æ—¶å°†ä¼šéšè—åŸºç±»ä¸­çš„åŒåå‡½æ•°ã€‚</p>
<h4 id="Q-186">Q 186</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">takes_pointer</span><span class="params">(<span class="keyword">int</span>* pointer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeid</span>(pointer) == <span class="keyword">typeid</span>(<span class="keyword">int</span>[])) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'a'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeid</span>(pointer) == <span class="keyword">typeid</span>(<span class="keyword">int</span>*)) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'p'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">takes_array</span><span class="params">(<span class="keyword">int</span> <span class="built_in">array</span>[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeid</span>(<span class="built_in">array</span>) == <span class="keyword">typeid</span>(<span class="keyword">int</span>[])) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'a'</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeid</span>(<span class="built_in">array</span>) == <span class="keyword">typeid</span>(<span class="keyword">int</span>*)) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'p'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* pointer = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    takes_pointer(<span class="built_in">array</span>);</span><br><span class="line">    takes_array(pointer);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (<span class="keyword">typeid</span>(<span class="keyword">int</span>*) == <span class="keyword">typeid</span>(<span class="keyword">int</span>[]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼špp0<br>
æ¥æ”¶æŒ‡é’ˆä½œä¸ºå‚æ•°çš„å‡½æ•°ä¹Ÿèƒ½å¤Ÿä½¿ç”¨æ•°ç»„æ¥è°ƒç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚<br>
å…ˆçœ‹ <code>takes_pointer(array)</code>ï¼Œå½“å‡½æ•°éœ€è¦ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºå‚æ•°æ—¶ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„ä¼šé€€åŒ–æˆä¸€ä¸ªæŒ‡é’ˆã€‚<br>
æ›´å‡†ç¡®åœ°è¯´ï¼Œä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„æ•°ç»„ç±»å‹çš„å·¦å€¼æˆ–è€…å³å€¼å¯ä»¥è½¬åŒ–ä¸ºæŒ‡å‘ T ç±»å‹çš„æŒ‡é’ˆçš„çº¯å³å€¼ã€‚<br>
å› æ­¤æ•°ç»„ array ä¼šè½¬åŒ–æˆæŒ‡å‘ <code>int</code> ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªçº¯å³å€¼ã€‚<br>
å†çœ‹ <code>takes_array(pointer)</code>ï¼ŒC++ æ ‡å‡†è§„å®šï¼Œåœ¨ç¡®å®šäº†æ¯ä¸ªå‚æ•°çš„ç±»å‹åï¼Œä»»ä½• T ç±»å‹çš„æ•°ç»„éƒ½ä¼šè¢«è½¬æ¢æˆ T ç±»å‹çš„æŒ‡é’ˆã€‚<br>
å› æ­¤ <code>takes_array(int array[])</code> ä¸­çš„ array[] å…¶å®å·²ç»è¢«è½¬æ¢ä¸º <code>int*</code> äº†ã€‚</p>
<h4 id="Q-187">Q 187</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">C</span> &#123;</span></span><br><span class="line">    C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    C(<span class="keyword">const</span> C&amp; other) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">    C&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> C&amp; other) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; <span class="keyword">return</span> *<span class="keyword">this</span>;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    C c1;</span><br><span class="line">    C c2 = c1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š12<br>
æ‹·è´æ„é€ æŒ‡çš„æ˜¯é€šè¿‡ <em>brace-or-equal-initializer</em> æ–¹å¼åˆå§‹åŒ–çš„æ„é€ ï¼Œ<code>C c2 = c1</code> å°±æ˜¯é€šè¿‡ equal æ¥<strong>æ„é€ ä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ã€‚</p>
<h4 id="Q-188">Q 188</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* a = <span class="keyword">const_cast</span>&lt;<span class="keyword">char</span>*&gt;(<span class="string">"Hello"</span>);</span><br><span class="line">    a[<span class="number">4</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šæœªå®šä¹‰è¡Œä¸º<br>
ä¿®æ”¹å­—ç¬¦ä¸²å­—é¢é‡æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼Œå®é™…ä¸Šï¼Œå­—ç¬¦ä¸²å­—é¢é‡çš„å­˜å‚¨æ˜¯åœ¨åªè¯»å­˜å‚¨åŒºå†…ã€‚<br>
æ­¤å¤–ï¼Œå¯¹äºä½¿ç”¨ <code>const_cast</code> å»é™¤ <code>const</code> é™å®šçš„ç›®çš„ç»å¯¹ä¸æ˜¯ä¸ºäº†ä¿®æ”¹å®ƒçš„å†…å®¹ï¼Œåªæ˜¯å‡ºäºæ— å¥ˆã€‚</p>
<h4 id="Q-190">Q 190</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A(<span class="keyword">int</span> i) : m_i(i) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_i &gt; <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">int</span> m_i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a1(1), a2(2);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a1 + a2 &lt;&lt; (a1 == a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š21<br>
<code>a1 + a2</code> å’Œ <code>a1 == a2</code> ä½¿ç”¨çš„éƒ½æ˜¯ <code>int</code> ç±»å‹çš„å†…å»ºè¿ç®—ç¬¦ã€‚a1 å’Œ a2 å…ˆæ˜¯éšå¼è½¬æ¢ä¸º <code>bool</code> ç„¶åå†éšå¼è½¬æ¢ä¸º <code>int</code>ã€‚<br>
ç”±äºç»“æ„ä½“ A å¹¶æ²¡æœ‰é‡è½½ <code>operator+</code>ï¼Œä½¿ç”¨çš„æ˜¯ <code>int</code> çš„å†…å»ºè¿ç®—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å°† a1 å’Œ a2 è½¬æ¢æˆè¯­ <code>operator+</code> å…¼å®¹å‘¢ï¼Œé¦–å…ˆå°è¯•çš„æ˜¯ç”¨æˆ·è‡ªåŠ¨ä¸€çš„è½¬æ¢å‡½æ•° <code>bool()</code>ï¼Œå› ä¸ºä¸€ä¸ªçº¯å³å€¼çš„ <code>bool</code> é‡èƒ½å¤Ÿè½¬æ¢æˆ <code>int</code> ç±»å‹ï¼Œå› æ­¤éšå¼è½¬æ¢ç»§ç»­æ‰§è¡Œï¼Œtrue ä¼šè¢«è½¬æ¢ä¸º 1ï¼Œfalse ä¼šè¢«è½¬æ¢ä¸º 0ï¼Œ<code>operator==</code> ä¹Ÿæ˜¯åŒæ ·çš„è½¬æ¢æ–¹å¼ã€‚</p>
<h4 id="Q-191">Q 191</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> A&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">int</span> x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> B&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">int</span> x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A::x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; B::x;</span><br><span class="line">    A::x = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; B::x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š01<br>
å‡ºç°åœ¨ä¸åŒå‘½åç©ºé—´èŒƒå›´å†…çš„å…·æœ‰ç›¸åŒåç§°çš„å˜é‡çš„ä¸¤ä¸ªå£°æ˜æŒ‡çš„æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚</p>
<h4 id="Q-192">Q 192</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    v.push_back(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    v.push_back(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">h</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g(f1(), f2());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    h();</span><br><span class="line">    h();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (v[<span class="number">0</span>] == v[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªæŒ‡å®š<br>
å‡½æ•°å‚æ•°è¡¨è¾¾å¼çš„è®¡ç®—é¡ºåºæ˜¯æœªæŒ‡å®šçš„ï¼Œæˆ‘ä»¬å”¯ä¸€èƒ½ç¡®å®šçš„å°±æ˜¯å‡½æ•° f1 å’Œ f2 ä¼šåœ¨å‡½æ•° g æ‰§è¡Œä¹‹å‰æ‰§è¡Œå®Œæ¯•ã€‚</p>
<h4 id="Q-193">Q 193</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[] = &lt;%<span class="number">1</span>%&gt;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a&lt;:<span class="number">0</span>:&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
C++ æ ‡å‡†ä¸ºä¸€äº›æ ‡ç‚¹ç¬¦å·æä¾›äº†å¯é€‰æ ‡è®°ï¼ŒåŸä»£ç ç­‰ä»·äºä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a[] = &#123;<span class="number">1</span>&#125;;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<p>é™¤äº†æ‹¼å†™ä¸åŒï¼Œè¿™äº›ç¬¦å·çš„è¡Œä¸ºéƒ½æ˜¯ç›¸åŒçš„ï¼Œå³ï¼š<br>
<code>&lt;%%&gt;</code> ç­‰ä»·äº <code>{}</code><br>
<code>&lt;::&gt;</code> ç­‰ä»·äº <code>[]</code></p>
<h4 id="Q-196">Q 196</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> x &#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span>&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> C&amp; i)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> y &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> x::C&amp; i)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f(x::C());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
å‡½æ•° f(x::C()) è°ƒç”¨æ²¡æœ‰æŒ‡å®šå‘½åç©ºé—´ï¼Œä½†æ˜¯ C++ ä¸­ä½¿ç”¨äº†ä¾èµ–äºå®å‚åå­—çš„æŸ¥æ‰¾ï¼Œå‡½æ•°å‚æ•°çš„å‘½åç©ºé—´è¢«æ·»åŠ åˆ°å‡½æ•°å‘½åç©ºé—´çš„æŸ¥æ‰¾ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬å°† x::C() ä¼ é€’ç»™äº†å‡½æ•° fï¼Œå› æ­¤åœ¨ç¼–è¯‘å‡½æ•° f æ—¶ä¹Ÿä¼šæŸ¥æ‰¾å‘½åç©ºé—´ x å¹¶æ‰¾åˆ° x::fã€‚</p>
<h4 id="Q-198">Q 198</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">"C"</span> &#123; <span class="keyword">int</span> x; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> B &#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="string">"C"</span> &#123; <span class="keyword">int</span> x; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A::x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; B::x;</span><br><span class="line">    A::x = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; B::x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
C++ æ ‡å‡†è§„å®šï¼Œå‡ºç°åœ¨ä¸åŒå‘½åç©ºé—´èŒƒå›´ä¸­çš„å…·æœ‰ç›¸åŒåç§°çš„ C è¯­è¨€é“¾æ¥çš„å˜é‡çš„ä¸¤ä¸ªå£°æ˜æŒ‡çš„æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚å› æ­¤ A::x å’Œ B::x è¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ªå˜é‡ã€‚<br>
è¿™é“é¢˜ä¸ #191 çš„ä¸åŒä¹‹å¤„åœ¨äº int x æ˜¯ä¸€ä¸ªå®šä¹‰è€Œä¸æ˜¯å£°æ˜ï¼Œç›´æ¥åŒ…å«åœ¨é“¾æ¥è§„èŒƒä¸­çš„å£°æ˜è¢«çœ‹ä½œåŒ…å« extern è¯´æ˜ç¬¦ï¼Œè€Œå˜é‡ x å¹¶æ²¡æœ‰ç›´æ¥åŒ…å«åœ¨é“¾æ¥è§„èŒƒä¸­ï¼Œå› æ­¤å®ƒæ²¡æœ‰éšå¼çš„ extern è¯´æ˜ï¼Œè¿™ä¸¤ä¸ª x è¢«çœ‹ä½œé‡å¤å®šä¹‰ã€‚<br>
å…·ä½“çš„åŒºåˆ«è¿˜å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç æ¥ç†è§£ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// declaration</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="keyword">int</span> i;</span><br><span class="line"><span class="comment">// definition</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Programming-Language</tag>
        <tag>C++ Quiz</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Quiz é¢˜è§£ 001~100</title>
    <url>/posts/e24af74a/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>C++ Quiz é¢˜è§£ 001~100 æ•´ç†</li>
<li>æœ‰è¶£çš„é¢˜ç›®ï¼š</li>
<li>018 027 031 033 041 052</li>
</ul>
</blockquote>
<a id="more"></a>
<h4 id="Q-001">Q 001</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">void</span> <span class="title">f</span>(<span class="title">T</span> &amp;<span class="title">i</span>) &#123;</span> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;i)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">42</span>;</span><br><span class="line">    f(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1<br>
<code>template &lt;&gt; void f(const int &amp;i)</code> ä¸­ T çš„ç±»å‹ä¸º <code>const int</code>ï¼Œ<code>f(i)</code> ä¸­çš„ i ä¸º <code>int</code> å‹ï¼Œæ¨¡æ¿å‚æ•°æ¨å¯¼å‡º <code>T = int</code>ã€‚</p>
<h4 id="Q-002">Q 002</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f(<span class="string">"foo"</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *bar = <span class="string">"bar"</span>;</span><br><span class="line">    f(bar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š22<br>
å­—ç¬¦ä¸²å­—é¢é‡ä¸æ˜¯ <code>std::string</code> ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ª <code>const char*</code> ç±»å‹ï¼Œå¦‚æœè¦è®©ç¼–è¯‘å™¨é€‰æ‹© <code>f(const std::string &amp;)</code>ï¼Œç”¨æˆ·å¿…é¡»é€šè¿‡è½¬æ¢æ¥åˆ›é€ ä¸€ä¸ªä¸´æ—¶çš„ <code>std::string</code> å¯¹è±¡ï¼Œè€Œä½¿ç”¨ <code>f(const void *)</code> ä¸éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰çš„è½¬æ¢ã€‚</p>
<h4 id="Q-004">Q 004</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">float</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span>)</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f(<span class="number">2.5</span>);</span><br><span class="line">    f(<span class="number">2.5f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š21<br>
æµ®ç‚¹æ•°å­—é¢é‡ 2.5 æ˜¯ <code>double</code> ç±»å‹çš„ï¼Œ2.5f æ˜¯ <code>float</code> ç±»å‹çš„</p>
<h4 id="Q-008">Q 008</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(A a)</span> </span>&#123; a.f(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    g(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šA<br>
<code>g(A a)</code> æ˜¯é€šè¿‡å€¼ä¼ é€’æ¥æ”¶ä¸€ä¸ª A ç±»å‹çš„å¯¹è±¡è€Œä¸æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’ï¼Œå› æ­¤è¿™é‡Œä¼šè°ƒç”¨ A çš„æ‹·è´æ„é€ å‡½æ•°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¼ ç»™å‡½æ•°ï¼Œå› æ­¤å‡½æ•° <code>g(A a)</code> ä¸­çš„ a æ˜¯ä¸€ä¸ªå…¨æ–°çš„ Aï¼Œè¿™ä¹Ÿæ˜¯å¸¸è§çš„å¯¹è±¡åˆ‡ç‰‡é—®é¢˜ã€‚</p>
<h4 id="Q-009">Q 009</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">    a = <span class="number">3</span>;</span><br><span class="line">    b = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = f(a, a);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; b &lt;&lt; c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š428<br>
ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å˜é‡ aï¼Œå› æ­¤ b ä¸ä¼šè¢«ä¿®æ”¹</p>
<h4 id="Q-011">Q 011</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š0<br>
ç”±äº a æ˜¯åœ¨å‘½åç©ºé—´èŒƒå›´å†…å£°æ˜çš„ï¼Œå®ƒå…·æœ‰é™æ€å­˜å‚¨æœŸï¼Œå¹¶ä¸”å®ƒæœªåˆå§‹åŒ–ï¼Œå› æ­¤é»˜è®¤åˆå§‹åŒ–ä¸º 0ï¼Œæ­¤æ—¶ä¸éœ€è¦åœ¨å‰é¢æ·»åŠ  <code>static</code> å…³é”®å­—ï¼Œå¦åˆ™åªæ˜¯è¡¨ç¤ºå†…éƒ¨è¿æ¥ï¼Œå¤–éƒ¨ä¸å¯è§ã€‚</p>
<h4 id="Q-013">Q 013</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"b"</span>; &#125;</span><br><span class="line">    ~B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"c"</span>; &#125;</span><br><span class="line">    ~C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"C"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A a;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    C c;</span><br><span class="line">    B b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šacbBCA<br>
a ä¸€å®šä¼šåœ¨ c å’Œ b ä¹‹å‰åˆå§‹åŒ–ã€‚</p>
<h4 id="Q-014">Q 014</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"b"</span>; &#125;</span><br><span class="line">    ~B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"c"</span>; &#125;</span><br><span class="line">    ~C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"C"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="keyword">static</span> C c; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šabcBCA<br>
a ä¸æ˜¯ constexprï¼Œå› æ­¤ a çš„åˆå§‹åŒ–æ˜¯åŠ¨æ€çš„å¹¶ä¸”å…·æœ‰å…¨å±€ä½œç”¨åŸŸ<br>
æ¥ä¸‹æ¥åˆå§‹åŒ– bï¼Œé™æ€å±€éƒ¨å˜é‡ä¼šåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°å®ƒçš„æ—¶å€™åˆå§‹åŒ–<br>
å½“ main é€€å‡ºæ—¶ï¼Œb è¶…å‡ºä½œç”¨åŸŸå…ˆè¢«ææ„ï¼Œæ‰€æœ‰é™æ€å˜é‡æŒ‰ç…§åˆå§‹åŒ–çš„ç›¸åé¡ºåºææ„</p>
<h4 id="Q-015">Q 015</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;exception&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span> (x++ == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">std</span>::exception();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'A'</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'b'</span>; &#125;</span><br><span class="line">    ~B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'B'</span>; &#125;</span><br><span class="line">    A a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="keyword">static</span> B b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="built_in">std</span>::exception &amp;) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'c'</span>;</span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šacabBA<br>
é™æ€å±€éƒ¨å˜é‡åœ¨ç¬¬ä¸€æ¬¡è®¿é—®å®ƒçš„æ—¶å€™åˆå§‹åŒ–ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ <code>foo</code> æ—¶ï¼Œå°è¯•åˆå§‹åŒ– bï¼Œåœ¨è°ƒç”¨ B çš„æ„é€ å‡½æ•°ä¹‹å‰é¦–å…ˆæ„é€ ç±» B çš„æˆå‘˜å˜é‡ï¼Œå› æ­¤å…ˆè°ƒç”¨ <code>A::A()</code>ï¼Œæ‰“å° aï¼Œè¯¥æ„é€ å‡½æ•°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¸­æ­¢æ„é€ ï¼Œè¢« <code>catch(std::exception &amp;)</code> æ•æ‰åˆ°ï¼Œæ‰“å° cï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ <code>foo</code> å‡½æ•°ï¼Œå› ä¸º b ç¬¬ä¸€æ¬¡æ²¡æœ‰è¢«æˆåŠŸåˆå§‹åŒ–ï¼Œæ­¤æ—¶ä¼šå†æ¬¡å°è¯•æ„é€  bï¼Œè¿™æ¬¡æ„é€ æˆåŠŸï¼Œæ‰“å° abï¼Œå½“ main ç»“æŸåï¼Œé™æ€å˜é‡ b è¢«ææ„ï¼Œæœ€åææ„æˆå‘˜å˜é‡ aã€‚</p>
<h4 id="Q-016">Q 016</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'a'</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'A'</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'b'</span>; &#125;</span><br><span class="line">    ~B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'B'</span>; &#125;</span><br><span class="line">    A a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; B b; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šabBA<br>
å…ˆæ„é€ çˆ¶ç±»å†æ„é€ å­ç±»ï¼Œå…ˆææ„å­ç±»å†ææ„çˆ¶ç±»</p>
<h4 id="Q-017">Q 017</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'a'</span>; &#125;</span><br><span class="line">    ~A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'A'</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'b'</span>; &#125;</span><br><span class="line">    ~B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'B'</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; B b; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šabBA<br>
æ„é€ å…ˆ A å Bï¼Œææ„å…ˆ B å Aã€‚</p>
<h4 id="Q-018">Q 018</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(A &amp;a)</span> </span>&#123; a.f(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    g(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šB<br>
è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºå°½ç®¡ B::f() æ˜¯ç§æœ‰çš„ï¼Œå®ƒä»ç„¶èƒ½å¤Ÿè¢«å®ƒçš„åŸºç±»å¼•ç”¨æˆåŠŸè°ƒç”¨ã€‚</p>
<h4 id="Q-024">Q 024</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;::<span class="built_in">max</span>();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ++i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š0<br>
<code>numeric_limits</code> ç±»æ¨¡æ¿ç”¨äºæä¾›æŸ¥è¯¢å„ç§ç®—æœ¯ç±»å‹å±æ€§çš„æ ‡å‡†åŒ–æ–¹å¼ï¼Œ<code>std::numeric_limits&lt;unsigned int&gt;::max()</code> è¡¨ç¤ºçš„æ˜¯æ— ç¬¦å·æ•´å‹çš„æœ€å¤§å¯èƒ½å€¼ï¼ŒåŠ  1 ä¹‹åæº¢å‡ºäº†ï¼Œi é‡æ–°å›åˆ°äº† 0ã€‚</p>
<h4 id="Q-025">Q 025</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">int</span>&gt;::<span class="built_in">max</span>();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ++i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªå®šä¹‰<br>
C++ æ ‡å‡†è§„å®šï¼Œæœ‰ç¬¦å·æ•´æ•°æº¢å‡ºæ˜¯æœªå®šä¹‰çš„è¡Œä¸º - å¦‚æœåœ¨è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼æ—¶ï¼Œç»“æœåœ¨æ•°å­¦ä¸Šæ²¡æœ‰å®šä¹‰æˆ–è€…ä¸åœ¨å…¶ç±»å‹çš„å¯è¡¨ç¤ºå€¼çš„èŒƒå›´å†…ï¼Œé‚£ä¹ˆè¯¥è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p>
<h4 id="Q-026">Q 026</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i / --j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¨‹åºè¡Œä¸ºæœªå®šä¹‰<br>
å¯¹ 0 çš„ <code>/</code> æ“ä½œä¸ <code>%</code> æ“ä½œéƒ½æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</p>
<h4 id="Q-027">Q 027</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::ostream &amp;<span class="title">put</span><span class="params">(<span class="built_in">std</span>::ostream &amp;o)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o &lt;&lt; <span class="string">'A'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> :</span> A &#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="built_in">std</span>::ostream &amp;<span class="title">put</span><span class="params">(<span class="built_in">std</span>::ostream &amp;o)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o &lt;&lt; <span class="string">'B'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;o, <span class="keyword">const</span> A &amp;a) &#123;</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">put</span>(o);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šB<br>
è¿™æ˜¯ä¸€ç§è·å¾— <code>operator &lt;&lt;</code> å¤šæ€çš„æ–¹æ³•ã€‚</p>
<h4 id="Q-028">Q 028</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">    A(<span class="keyword">const</span> A &amp;a) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"C"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : a) &#123;</span><br><span class="line">        x.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šAABCBC<br>
æ•°ç»„åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼Œè¾“å‡º AAï¼Œå¾ªç¯æ•°ç»„çš„æ—¶å€™ <code>auto</code> æ¨æ–­ x çš„ç±»å‹ä¸º Aï¼Œå› æ­¤è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°åå†è°ƒç”¨ fï¼Œè¾“å‡º BCBCã€‚</p>
<h4 id="Q-029">Q 029</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A() &#123; foo(); &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~A() &#123; foo(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123; foo(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    b.bar();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š121<br>
è™½ç„¶ <code>foo()</code> æ˜¯è™šå‡½æ•°ï¼Œä½†æ˜¯åœ¨åŸºç±»çš„æ„é€ å’Œææ„å‡½æ•°è°ƒç”¨æ—¶ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºæ­¤æ—¶çš„æ´¾ç”Ÿç±»ä¸å­˜åœ¨ã€‚<br>
åŸºç±»ææ„å‡½æ•°å†™æˆè™šå‡½æ•°æ˜¯ä¸ºäº†é˜²æ­¢åŸºç±»æŒ‡é’ˆåœ¨ææ„æ´¾ç”Ÿç±»å¯¹è±¡æ—¶åªèƒ½ææ„åŸºç±»å¯¹è±¡é€ æˆå†…å­˜æ³„éœ²ã€‚</p>
<h4 id="Q-030">Q 030</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"X"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="function">X <span class="title">x</span><span class="params">()</span></span>; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šè¾“å‡ºä¸ºç©º<br>
<code>X x()</code> æ˜¯å‡½æ•°åŸå‹ï¼Œä¸æ˜¯å®ä¾‹åŒ–ç±» Xï¼Œå¦‚æœè¦è¾“å‡º Xï¼Œå¯ä»¥å°†ä»£ç ä¿®æ”¹ä¸º <code>X x{}</code></p>
<h4 id="Q-031">Q 031</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"X"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Y</span> &#123;</span></span><br><span class="line">    Y(<span class="keyword">const</span> X &amp;x) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Y"</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"f"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Y <span class="title">y</span><span class="params">(X())</span></span>;</span><br><span class="line">    y.f();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
<code>Y y(X())</code> åŸå…ˆçš„æ„å›¾æ˜¯å®šä¹‰ä¸€ä¸ª Y ç±»å‹çš„å˜é‡ï¼Œè€Œæœ¬é¢˜ä¸­çš„ y æ˜¯ä¸€ä¸ªå‚æ•°ä¸ºå‡½æ•° X()ï¼ˆæ— å‚æ•°ï¼Œè¿”å›å€¼ä¸º Xï¼‰ï¼Œè¿”å›å€¼ä¸º Y çš„å‡½æ•°ï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œåº”æ”¹ä¸º <code>Y y{X{}}</code>ã€‚</p>
<h4 id="Q-032">Q 032</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    X() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"a"</span>; &#125;</span><br><span class="line">    X(<span class="keyword">const</span> X &amp;x) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"b"</span>; &#125;</span><br><span class="line">    <span class="keyword">const</span> X &amp;<span class="keyword">operator</span>=(<span class="keyword">const</span> X &amp;x) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"c"</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    X x;</span><br><span class="line">    <span class="function">X <span class="title">y</span><span class="params">(x)</span></span>;</span><br><span class="line">    X z = y;</span><br><span class="line">    z = x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šABBC<br>
<code>X y(x)</code> è°ƒç”¨çš„æ˜¯æ‹·è´æ„é€ å‡½æ•°ã€‚</p>
<h4 id="Q-033">Q 033</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">GeneralException</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"G"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SpecialException</span> :</span> <span class="keyword">public</span> GeneralException &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"S"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="keyword">throw</span> SpecialException(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        f();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (GeneralException e) &#123;</span><br><span class="line">        e.<span class="built_in">print</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šG<br>
æˆ‘ä»¬æŠ›å‡ºäº†ä¸€ä¸ª SpecialException å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ª GeneralException çš„æ´¾ç”Ÿç±»ï¼Œä½†æ˜¯è¯¥å¼‚å¸¸æ˜¯è¢«å€¼æ•è·çš„ï¼Œå› æ­¤ e å…·æœ‰çš„æ˜¯åŠ¨æ€ç±»å‹ GeneralException è€Œä¸æ˜¯ SpecialExceptionï¼Œè¿™å°±æ˜¯å¯¹è±¡åˆ‡ç‰‡ã€‚<br>
æˆ‘ä»¬åº”è¯¥é€šè¿‡ <code>catch(GeneralException&amp; e)</code> æ¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œè¿™æ ·ç¨‹åºè¾“å‡ºæ‰ä¸º Sã€‚</p>
<h4 id="Q-037">Q 037</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">decltype</span>(a) b = a;</span><br><span class="line">    b++;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š01<br>
<code>auto</code> å¿½ç•¥é¡¶å±‚ <code>const</code>ï¼Œ<code>decltype</code> ä¿ç•™é¡¶å±‚ <code>const</code><br>
å¯¹å¼•ç”¨æ“ä½œï¼Œ<code>auto</code> æ¨æ–­å‡ºåŸæœ‰ç±»å‹ï¼Œ<code>decltype</code> æ¨æ–­å‡ºå¼•ç”¨<br>
å¯¹è§£å¼•ç”¨æ“ä½œï¼Œ<code>auto</code> æ¨æ–­å‡ºåŸæœ‰ç±»å‹ï¼Œ<code>decltype</code> æ¨æ–­å‡ºå¼•ç”¨</p>
<h4 id="Q-041">Q 041</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="number">1</span>[<span class="string">"ABC"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šB<br>
è¡¨è¾¾å¼ <code>E1[E2]</code> å«ä¹‰æ˜¯ <code>*((E1) + (E2))</code>ï¼Œæ‰€ä»¥ <code>1[&quot;ABC&quot;]</code> å¯ä»¥å†™ä¸º <code>*(&quot;ABC&quot; + 1)</code>ï¼Œè¿™ç›¸å½“äºç›´æ¥å–å‡ºå­—æ¯ Bã€‚</p>
<h4 id="Q-042">Q 042</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;initializer_list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"1"</span>; &#125;</span><br><span class="line">    A(<span class="keyword">int</span>) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"2"</span>; &#125;</span><br><span class="line">    A(<span class="built_in">std</span>::<span class="built_in">initializer_list</span>&lt;<span class="keyword">int</span>&gt;) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"3"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    A a1;</span><br><span class="line">    A a2&#123;&#125;;</span><br><span class="line">    A a3&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    A a4&#123; <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š1133<br>
åˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°æ˜¯è´ªå©ªçš„ï¼Œå¯¹äº a3 æ¥è¯´ï¼Œå³ä½¿ <code>A(int)</code> ä¹Ÿæ˜¯æ»¡è¶³æ¡ä»¶çš„æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä»ç„¶ä¼šä¼˜å…ˆè€ƒè™‘ <code>initializer_list&lt;int&gt;</code>ã€‚</p>
<h4 id="Q-044">Q 044</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">X</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"X"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Y</span> :</span> <span class="keyword">public</span> X &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Y"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> X &amp;x)</span> </span>&#123; x.f(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    X arr[<span class="number">1</span>];</span><br><span class="line">    Y y1;</span><br><span class="line">    arr[<span class="number">0</span>] = y1;</span><br><span class="line">    <span class="built_in">print</span>(y1);</span><br><span class="line">    <span class="built_in">print</span>(arr[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šYX<br>
<code>arr</code> æ˜¯ X çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯æŒ‡å‘ X çš„æŒ‡é’ˆï¼Œå½“ç±»å‹ä¸º Y çš„å¯¹è±¡å­˜å…¥è¯¥æ•°ç»„ä¸­æ—¶ä¼šè¢«è½¬åŒ–ä¸º X ç±»å‹ï¼Œå› æ­¤å­˜å…¥æ•°ç»„ <code>arr</code> ä¸­çš„å¯¹è±¡ y1 å¤±å»å¯¹è±¡çš„ Y çš„é‚£ä¸€éƒ¨åˆ†ï¼Œè¿™ç§ç°è±¡ä¹Ÿè¢«ç§°ä¸ºå¯¹è±¡åˆ‡ç‰‡ã€‚</p>
<h4 id="Q-049">Q 049</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    C(<span class="keyword">int</span> i) : i(i) &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i; &#125;</span><br><span class="line">    ~C() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i + <span class="number">5</span>; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> C &amp;c = C(<span class="number">1</span>);</span><br><span class="line">    C(<span class="number">2</span>);</span><br><span class="line">    C(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼š127386<br>
ä¸´æ—¶å˜é‡ä¸€èˆ¬åœ¨è¯¥è¡Œè¿è¡Œç»“æŸæ—¶å°±è¦è¢«é”€æ¯ï¼Œè€Œç¬¬ä¸€ä¸ªå˜é‡ C(1) å› ä¸ºä¸å˜é‡ c å¼•ç”¨ç»‘å®šï¼Œè¯¥ä¸´æ—¶å˜é‡çš„ç”Ÿå­˜æœŸè¢«å»¶é•¿åˆ°å’Œ c ä¸€æ ·ï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹æ˜¯ <code>C(1) C(2) ~C(2) C(3) ~C(3) ~C(1)</code>ã€‚</p>
<h4 id="Q-052">Q 052</h4>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"B"</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> B <span class="title">A::createB</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"A"</span>; &#125;</span><br><span class="line">    <span class="function">B <span class="title">createB</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> B(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    B b = a.createB();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>A</strong>ï¼šç¼–è¯‘é”™è¯¯<br>
å½“å£°æ˜å‡½æ•° <code>A::createB()</code> ä¸ºç±» B çš„å‹å…ƒå‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°å­˜åœ¨ï¼Œå› ä¸ºå®ƒåªçœ‹åˆ°äº†ç±» A çš„å£°æ˜è€Œä¸æ˜¯ç±» A çš„å®šä¹‰ã€‚</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Programming-Language</tag>
        <tag>C++ Quiz</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨åšå®¢ä¸­æ˜¾ç¤ºæ–‡ç« é˜…è¯»é‡æ’è¡Œ</title>
    <url>/posts/a510178f/</url>
    <content><![CDATA[<blockquote>
<p>è§£å†³ Hexo åšå®¢å‡çº§åæ–‡ç« é˜…è¯»é‡æ’è¡Œå¤±æ•ˆçš„é—®é¢˜</p>
</blockquote>
<a id="more"></a>
<p>åšå®¢ä» <code>Hexo-3.8</code> <code>Next-6.7.0</code> æ›´æ–°åˆ°äº† <code>Hexo-4.2</code> <code>Next-7.7.1</code> ä¹‹åï¼ŒåŸæ¥çš„æ–‡ç« é˜…è¯»é‡æ’è¡Œå¤±æ•ˆäº†ï¼Œ<code>F12</code> å‘ç°ä¸‹é¢çš„ URL æŠ¥é”™ <code>401 - unauthorized</code>ï¼š<br>
<code>https://us.leancloud.cn/1.1/classes/Comment?redirectByAPI=cn</code></p>
<p>é”™è¯¯åŸå› æ˜¯åŸ SDK ç‰ˆæœ¬å¤ªä½ï¼Œå°† <code>top/index.md</code> ä¸­çš„<br>
<code>&lt;script src=&quot;https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js&quot;&gt;&lt;/script&gt;</code><br>
ä¿®æ”¹ä¸ºï¼š<br>
<code>&lt;script src=&quot;https://cdn1.lncld.net/static/js/3.10.0/av-min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>é‡æ–° hexo ä¸‰è¿ï¼Œé—®é¢˜è§£å†³ã€‚</p>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">"top"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="https:/</span><span class="regexp">/cdn1.lncld.net/</span><span class="keyword">static</span>/js/<span class="number">3.10</span><span class="number">.0</span>/av-min.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">AV.initialize("</span>APP-ID<span class="string">", "</span>APP-KEY<span class="string">");</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">  var time=0</span></span><br><span class="line"><span class="string">  var title="</span><span class="string">"</span></span><br><span class="line"><span class="string">  var url="</span><span class="string">"</span></span><br><span class="line"><span class="string">  var query = new AV.Query('Counter');</span></span><br><span class="line"><span class="string">  query.notEqualTo('id',0);</span></span><br><span class="line"><span class="string">  query.descending('time');</span></span><br><span class="line"><span class="string">  query.limit(1000);</span></span><br><span class="line"><span class="string">  query.find().then(function (todo) &#123;</span></span><br><span class="line"><span class="string">    for (var i=0;i&lt;1000;i++)&#123;</span></span><br><span class="line"><span class="string">      var result=todo[i].attributes;</span></span><br><span class="line"><span class="string">      time=result.time;</span></span><br><span class="line"><span class="string">      title=result.title;</span></span><br><span class="line"><span class="string">      url=result.url;</span></span><br><span class="line"><span class="string">      var content="</span>&lt;p&gt;<span class="string">"+"</span>&lt;font color=<span class="string">'#1C1C1C'</span>&gt;<span class="string">"+"</span>&lt;<span class="regexp">/font&gt;"+"&lt;a href='"+"https:/</span><span class="regexp">/archiescott.github.io/</span><span class="string">"+url+"</span><span class="string">'&gt;"+title+"&lt;/a&gt;"+"&lt;br&gt;"+"é˜…è¯»æ¬¡æ•°ï¼š"+time+"&lt;br&gt;"+"&lt;/p&gt;";</span></span><br><span class="line"><span class="string">      document.getElementById("top").innerHTML+=content</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;, function (error) &#123;</span></span><br><span class="line"><span class="string">    console.log("error");</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
        <tag>Blog</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ ä¸­çš„ syncPrimitivesï¼šlock</title>
    <url>/posts/47473230/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>æœ€åŸºç¡€çš„é”ç®¡ç† lock_guard</li>
<li>æ”¯æŒåŒæ—¶é”å®šå¤šä¸ªäº’æ–¥é‡çš„ lock æ–¹æ³•</li>
<li>é€šè¿‡ lock æ–¹æ³•æ‰¹é‡ç®¡ç†äº’æ–¥é‡çš„ scoped_lock</li>
<li>æ”¯æŒåŒæ—¶å°è¯•é”å®šå¤šä¸ªäº’æ–¥é‡çš„ try_lock æ–¹æ³•</li>
<li>æ”¯æŒå¤šç§ locktag ç®¡ç†çš„ç‹¬å å‹ unique_lock</li>
<li>æ”¯æŒå¤šç§ locktag ç®¡ç†çš„å…±äº«å‹ shared_lock</li>
<li>ä¿è¯åªæ‰§è¡Œä¸€æ¬¡çš„ call_once æ–¹æ³•</li>
</ul>
</blockquote>
<a id="more"></a>
<h2 id="std-lock-guard">std::lock_guard</h2>
<h3 id="std-lock-guard-ç‰¹æ€§"><code>std::lock_guard</code> ç‰¹æ€§</h3>
<p><code>lock_guard</code> æ˜¯ä¸€ç§äº’æ–¥å°è£…å™¨ï¼Œåˆ©ç”¨ RAII æœºåˆ¶ä¸ºä»£ç å—æä¾› <code>mutex</code> çš„æ‰€æœ‰æƒã€‚</p>
<p><code>lock_guard</code> çš„æ‹·è´æ„é€ ä¸èµ‹å€¼å‡½æ•°å‡ä¸º <code>delete</code>ã€‚</p>
<p><code>explicit lock_guard(mutex_type&amp; m)</code> ç›¸å½“äºè°ƒç”¨ <code>m.lock()</code>ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº† mutexï¼Œåˆ™è¯¥è¡Œä¸ºæœªå®šä¹‰ã€‚</p>
<p><code>lock_guard(mutex_type&amp; m, std::adopt_lock_t t)</code> ç”¨åˆ°äº†åé¢çš„ <code>locktag</code>ï¼Œ<strong>ç”¨äºè¯¥çº¿ç¨‹å·²ç»è·å– <code>mutex</code> çš„æƒ…å†µä¸‹å°† <code>mutex</code> äº¤ç»™ <code>lock_guard</code> æ¥ç®¡</strong>ï¼Œçœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span> <span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    mtx.lock();</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(mtx, <span class="built_in">std</span>::adopt_lock)</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"thread id: "</span> &lt;&lt; id &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::thread threads[<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i)</span><br><span class="line">        threads[i] = <span class="built_in">std</span>::thread(<span class="built_in">process</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : threads)</span><br><span class="line">        t.join();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="std-lock-guard-ç¤ºä¾‹"><code>std::lock_guard</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> g_i = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">std</span>::mutex g_i_mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">safe_increment</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// g_i_mutex åœ¨é”ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(g_i_mutex)</span></span>;</span><br><span class="line">    ++g_i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="string">": "</span> &lt;&lt; g_i &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"main: "</span> &lt;&lt; g_i &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(safe_increment)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(safe_increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"main: "</span> &lt;&lt; g_i &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-lock">std::lock</h2>
<h3 id="std-lock-ç‰¹æ€§"><code>std::lock</code> ç‰¹æ€§</h3>
<p>å½“éœ€è¦åŒæ—¶æ“ä½œä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå¯¹è±¡æ—¶ï¼Œå°±éœ€è¦åŒæ—¶é”å®šè¿™äº›å¯¹è±¡ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬ä¾æ¬¡é”å®šã€‚</p>
<p><code>lock(Lockable1&amp; lock1, ..., LockableN&amp; lockn)</code> èƒ½å¤Ÿä»¥é¿å…æ­»é”çš„æ–¹å¼é”å®šç»™å®šçš„å¯¹è±¡ï¼Œå¦‚æœåœ¨è°ƒç”¨ <code>lock</code> æˆ– <code>unlock</code> æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå°†å·²ä¸Šé”çš„å¯¹è±¡å…¨éƒ¨è§£é”ã€‚</p>
<h3 id="std-lock-ç¤ºä¾‹"><code>std::lock</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// class Employeeï¼Œå°†ä»–çš„ lunch_partners æ”¾å…¥ vector ä¸­è¾“å‡º</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span> &#123;</span></span><br><span class="line">    Employee(<span class="built_in">std</span>::<span class="built_in">string</span> id) : id(id) &#123;&#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> id;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; lunch_partners;</span><br><span class="line">    <span class="built_in">std</span>::mutex m;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">output</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> ret = <span class="string">"Employee "</span> + id + <span class="string">" has lunch partners: "</span>;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; partner : lunch_partners )</span><br><span class="line">            ret += partner + <span class="string">" "</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_mail</span><span class="params">(Employee &amp;, Employee &amp;)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶çš„å‘ä¿¡æ“ä½œ</span></span><br><span class="line">    <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign_lunch_partner</span><span class="params">(Employee &amp;e1, Employee &amp;e2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é™æ€ mutex å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::mutex io_mutex;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ’é˜Ÿ wait for lock</span></span><br><span class="line">        <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk</span><span class="params">(io_mutex)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e1.id &lt;&lt; <span class="string">" and "</span> &lt;&lt; e2.id &lt;&lt; <span class="string">" are waiting for locks"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ä½¿ç”¨ lock åŒæ—¶é”å®šä¸¤ä¸ªéœ€è¦æ“ä½œçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ˆé”ä¸€ä¸ªå†é”ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ lock_guard + std::adopt_lock æ¥ç®¡ï¼Œæ–¹ä¾¿è§£é”</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ e1 ä¸ e2 å·²ç»è¢«é”å®šï¼Œä¸èƒ½å†å’Œåˆ«çš„ employee have lunch äº†</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::lock(e1.m, e2.m);</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk1</span><span class="params">(e1.m, <span class="built_in">std</span>::adopt_lock)</span></span>;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk2</span><span class="params">(e2.m, <span class="built_in">std</span>::adopt_lock)</span></span>;</span><br><span class="line"><span class="comment">// ç­‰ä»·ä»£ç ï¼ˆè‹¥éœ€è¦ unique_locks ï¼Œä¾‹å¦‚å¯¹äºæ¡ä»¶å˜é‡ï¼‰</span></span><br><span class="line"><span class="comment">//        std::unique_lock&lt;std::mutex&gt; lk1(e1.m, std::defer_lock);</span></span><br><span class="line"><span class="comment">//        std::unique_lock&lt;std::mutex&gt; lk2(e2.m, std::defer_lock);</span></span><br><span class="line"><span class="comment">//        std::lock(lk1, lk2);</span></span><br><span class="line"><span class="comment">// C++17 ä¸­å¯ç”¨çš„è¾ƒä¼˜è§£æ³•</span></span><br><span class="line"><span class="comment">//        std::scoped_lock lk(e1.m, e2.m);</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk</span><span class="params">(io_mutex)</span></span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e1.id &lt;&lt; <span class="string">" and "</span> &lt;&lt; e2.id &lt;&lt; <span class="string">" got locks"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        e1.lunch_partners.push_back(e2.id);</span><br><span class="line">        e2.lunch_partners.push_back(e1.id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘ŠçŸ¥åˆé¤æŒ‡æ´¾</span></span><br><span class="line">    send_mail(e1, e2);</span><br><span class="line">    send_mail(e2, e1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Employee alice("alice"), bob("bob"), christina("christina"), dave("dave");</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å¹³è¡Œçº¿ç¨‹æŒ‡æ´¾ï¼Œå› ä¸ºå‘é‚®ä»¶ç»™ç”¨æˆ·å‘ŠçŸ¥åˆé¤æŒ‡æ´¾ï¼Œä¼šæ¶ˆè€—é•¿æ—¶é—´</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(alice), <span class="built_in">std</span>::ref(bob));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(christina), <span class="built_in">std</span>::ref(bob));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(christina), <span class="built_in">std</span>::ref(alice));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(dave), <span class="built_in">std</span>::ref(bob));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ„æºå›æ”¶</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;thread : threads) thread.join();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; alice.output() &lt;&lt; <span class="string">'\n'</span>  &lt;&lt; bob.output() &lt;&lt; <span class="string">'\n'</span></span><br><span class="line">              &lt;&lt; christina.output() &lt;&lt; <span class="string">'\n'</span> &lt;&lt; dave.output() &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-scoped-lock">std::scoped_lock</h2>
<h3 id="std-scoped-lock-ç‰¹æ€§"><code>std::scoped_lock</code> ç‰¹æ€§</h3>
<p><code>scoped_lock</code> åœ¨ä½œç”¨åŸŸå—çš„å­˜åœ¨æœŸé—´å æœ‰ä¸€æˆ–å¤šä¸ªäº’æ–¥ï¼Œå½“ <code>scoped_lock</code> ææ„æ—¶ä»¥é€†åºé‡Šæ”¾é”ã€‚</p>
<p><code>scoped_lock(MutexTypes&amp; ... m)</code><br>
å½“ <code>sizeof(MutexTypes) == 0</code> æ—¶æ— äº‹å‘ç”Ÿ<br>
å½“ <code>sizeof(MutexTypes) == 1</code> æ—¶ç­‰æ•ˆäº <code>m.lock()</code><br>
å¦åˆ™ç­‰æ•ˆäº <code>std::lock(m...)</code></p>
<p><code>scoped_lock( std::adopt_lock_t, MutexTypes&amp;... m )</code><br>
<code>scoped_lock</code> ä¹Ÿå¯ä»¥æ‰¹é‡æ¥ç®¡ <code>mutex</code>ã€‚</p>
<p><code>scoped_lock</code> ä¸èƒ½å¤åˆ¶ï¼Œä½†æ˜¯å¯ä»¥ç§»åŠ¨ã€‚</p>
<h3 id="std-scoped-lock-ç¤ºä¾‹"><code>std::scoped_lock</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span> &#123;</span></span><br><span class="line">    Employee(<span class="built_in">std</span>::<span class="built_in">string</span> id) : id(id) &#123;&#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> id;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; lunch_partners;</span><br><span class="line">    <span class="built_in">std</span>::mutex m;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">output</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> ret = <span class="string">"Employee "</span> + id + <span class="string">" has lunch partners: "</span>;</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span>&amp; partner : lunch_partners )</span><br><span class="line">            ret += partner + <span class="string">" "</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_mail</span><span class="params">(Employee &amp;, Employee &amp;)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign_lunch_partner</span><span class="params">(Employee &amp;e1, Employee &amp;e2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::mutex io_mutex;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk</span><span class="params">(io_mutex)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e1.id &lt;&lt; <span class="string">" and "</span> &lt;&lt; e2.id &lt;&lt; <span class="string">" are waiting for locks"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç”¨ scoped_lock ç›¸å½“äºé”å®šå¹¶æ¥ç®¡äº† e1.m e2.m</span></span><br><span class="line">        <span class="function"><span class="built_in">std</span>::scoped_lock <span class="title">lock</span><span class="params">(e1.m, e2.m)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰ä»·ä»£ç  1 ï¼ˆç”¨ std::lock å’Œ std::lock_guard ï¼‰</span></span><br><span class="line">        <span class="comment">// std::lock(e1.m, e2.m);</span></span><br><span class="line">        <span class="comment">// std::lock_guard&lt;std::mutex&gt; lk1(e1.m, std::adopt_lock);</span></span><br><span class="line">        <span class="comment">// std::lock_guard&lt;std::mutex&gt; lk2(e2.m, std::adopt_lock);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰ä»·ä»£ç  2 ï¼ˆè‹¥éœ€è¦ unique_lock ï¼Œä¾‹å¦‚å¯¹äºæ¡ä»¶å˜é‡ï¼‰</span></span><br><span class="line">        <span class="comment">// std::unique_lock&lt;std::mutex&gt; lk1(e1.m, std::defer_lock);</span></span><br><span class="line">        <span class="comment">// std::unique_lock&lt;std::mutex&gt; lk2(e2.m, std::defer_lock);</span></span><br><span class="line">        <span class="comment">// std::lock(lk1, lk2);</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk</span><span class="params">(io_mutex)</span></span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; e1.id &lt;&lt; <span class="string">" and "</span> &lt;&lt; e2.id &lt;&lt; <span class="string">" got locks"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        e1.lunch_partners.push_back(e2.id);</span><br><span class="line">        e2.lunch_partners.push_back(e1.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    send_mail(e1, e2);</span><br><span class="line">    send_mail(e2, e1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Employee alice("alice"), bob("bob"), christina("christina"), dave("dave");</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­æŒ‡æ´¾ï¼Œsend_mail è€—æ—¶è¾ƒé•¿</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(alice), <span class="built_in">std</span>::ref(bob));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(christina), <span class="built_in">std</span>::ref(bob));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(christina), <span class="built_in">std</span>::ref(alice));</span><br><span class="line">    threads.emplace_back(assign_lunch_partner, <span class="built_in">std</span>::ref(dave), <span class="built_in">std</span>::ref(bob));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;thread : threads) thread.join();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; alice.output() &lt;&lt; <span class="string">'\n'</span>  &lt;&lt; bob.output() &lt;&lt; <span class="string">'\n'</span></span><br><span class="line">              &lt;&lt; christina.output() &lt;&lt; <span class="string">'\n'</span> &lt;&lt; dave.output() &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-try-lock">std::try_lock</h2>
<h3 id="std-try-lock-ç‰¹æ€§"><code>std::try_lock</code> ç‰¹æ€§</h3>
<p><code>int try_lock( Lockable1&amp; lock1, ..., LockableN&amp;... lockn)</code><br>
ä¼šå°è¯•ç»™ <code>lock1</code> åˆ° <code>lockn</code> ä¾æ¬¡ <code>try_lock</code>ï¼Œå½“ <code>try_lock</code> å¤±è´¥æ—¶å°±ä¸å†ç»§ç»­è°ƒç”¨ <code>try_lock</code>ï¼Œå¹¶ä¸”å·²é”å¯¹è±¡ä¼šä¾æ¬¡ <code>unlock</code>ã€‚é”å®šå¤±è´¥è¿”å›å¯¹è±¡ä¸‹æ ‡ï¼Œå¦‚æœé”å®šæˆåŠŸè¿”å› -1ã€‚</p>
<p>ç”¨é™ˆç¡•çš„è¯æ¥è¯´ï¼Œ<code>try_lock</code> åœ¨ç”Ÿäº§ä»£ç ä¸­å¹¶ä¸å¤šè§ï¼Œå› ä¸ºç¨‹åºå¤§å¤šæ—¶å€™éƒ½ä¸éœ€è¦è¯•ç€å»é”ä¸€é”ã€‚</p>
<h3 id="std-try-lock-ç¤ºä¾‹"><code>std::try_lock</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> foo_count = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::mutex foo_count_mutex;</span><br><span class="line">    <span class="keyword">int</span> bar_count = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::mutex bar_count_mutex;</span><br><span class="line">    <span class="keyword">int</span> overall_count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">bool</span> done = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">std</span>::mutex done_mutex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> increment = [](<span class="keyword">int</span> &amp;counter, <span class="built_in">std</span>::mutex &amp;m, <span class="keyword">const</span> <span class="keyword">char</span> *desc) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; lock(m);</span><br><span class="line">            ++counter;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; desc &lt;&lt; <span class="string">": "</span> &lt;&lt; counter &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">            lock.unlock();</span><br><span class="line">            <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è·å–è‡ªèº«çš„ mutex åä¿®æ”¹è‡ªèº«çš„ count</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">increment_foo</span><span class="params">(increment, <span class="built_in">std</span>::ref(foo_count), <span class="built_in">std</span>::ref(foo_count_mutex), <span class="string">"foo"</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">increment_bar</span><span class="params">(increment, <span class="built_in">std</span>::ref(bar_count), <span class="built_in">std</span>::ref(bar_count_mutex), <span class="string">"bar"</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼•ç”¨æ•è·åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">update_overall</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        done_mutex.lock();</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">while</span> (!done) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">            done_mutex.unlock();</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> result = <span class="built_in">std</span>::try_lock(foo_count_mutex, bar_count_mutex);</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="comment">// å¦‚æœé”å®šæˆåŠŸå°†ä¸¤ä¸ª count è®¡å…¥æ€»æ•°</span></span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">if</span> (result == <span class="number">-1</span>) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                overall_count += foo_count + bar_count;</span></span></span><br><span class="line"><span class="function"><span class="params">                foo_count = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">                bar_count = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"overall: "</span> &lt;&lt; overall_count &lt;&lt; <span class="string">'\n'</span>;</span></span></span><br><span class="line"><span class="function"><span class="params">                foo_count_mutex.unlock();</span></span></span><br><span class="line"><span class="function"><span class="params">                bar_count_mutex.unlock();</span></span></span><br><span class="line"><span class="function"><span class="params">            &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">2</span>));</span></span></span><br><span class="line"><span class="function"><span class="params">            done_mutex.lock();</span></span></span><br><span class="line"><span class="function"><span class="params">        &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">        done_mutex.unlock();</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    increment_foo.join();</span><br><span class="line">    increment_bar.join();</span><br><span class="line">    <span class="comment">// ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹éƒ½ç»“æŸäº†å†ä¿®æ”¹ done</span></span><br><span class="line">    <span class="comment">// done å¿…é¡»è¦åœ¨ while å¾ªç¯ä¸­ä¿®æ”¹æ‰è¡Œ</span></span><br><span class="line">    done_mutex.lock();</span><br><span class="line">    done = <span class="literal">true</span>;</span><br><span class="line">    done_mutex.unlock();</span><br><span class="line">    update_overall.join();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Done processing\n"</span></span><br><span class="line">              &lt;&lt; <span class="string">"foo: "</span> &lt;&lt; foo_count &lt;&lt; <span class="string">'\n'</span></span><br><span class="line">              &lt;&lt; <span class="string">"bar: "</span> &lt;&lt; bar_count &lt;&lt; <span class="string">'\n'</span></span><br><span class="line">              &lt;&lt; <span class="string">"overall: "</span> &lt;&lt; overall_count &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-unique-lock">std::unique_lock</h2>
<h3 id="std-unique-lock-ç‰¹æ€§"><code>std::unique_lock</code> ç‰¹æ€§</h3>
<p><code>unique_lock( unique_lock&amp;&amp; other ) noexcept</code><br>
<code>unique_lock</code> ä¸æ”¯æŒå¤åˆ¶æ„é€ ï¼Œä½†æ”¯æŒç§»åŠ¨æ„é€ ï¼Œç”¨å…¶ä»–çš„ <code>unique_lock</code> å¯¹è±¡åˆå§‹åŒ–æ–° <code>unique_lock</code> å¯¹è±¡</p>
<p><code>unique_lock( mutex_type&amp; m, locktag t )</code><br>
<code>locktag</code> å¯ä»¥ä¸ºä¸‹é¢ä¸‰ç§ï¼š<br>
<code>std::defer_lock</code> æ¥ç®¡ <code>mutex</code> ä½†ä¸é”å®š<br>
<code>std::try_to_lock</code> æ¥ç®¡ <code>mutex</code> åå°è¯•é”å®šï¼Œé”å®šå¤±è´¥ä¹Ÿä¸ä¼šé˜»å¡<br>
<code>std::adopt_lock</code> é”å®šåæ¥ç®¡ <code>mutex</code></p>
<p><code>unique_lock( mutex_type&amp; m, const std::chrono::duration&lt;Rep,Period&gt;&amp; timeout_duration )</code><br>
<code>unique_lock</code> é˜»å¡ç›´è‡³ç»è¿‡æŒ‡å®šçš„ <code>timeout_duration</code> æˆ–è€…è·å¾—é”ã€‚</p>
<p><code>unique_lock( mutex_type&amp; m, const std::chrono::time_point&lt;Clock,Duration&gt;&amp; timeout_time )</code><br>
<code>unique_lock</code> é˜»å¡ç›´è‡³åˆ°è¾¾æŒ‡å®šçš„ <code>timeout_time</code> æˆ–è€…è·å¾—é”ã€‚</p>
<p><code>unique_lock</code> æ¥ç®¡ <code>mutex</code> ä¹‹åå¯ä»¥è°ƒç”¨ <code>lock</code> å’Œ <code>unlock</code> æ¥ä¸´æ—¶é”å®šå’Œè§£é”çº¿ç¨‹ï¼Œ<code>unique_lock</code> è¿˜å¯ä»¥é€šè¿‡ <code>release</code> é‡Šæ”¾å¯¹ <code>mutex</code> çš„ç®¡ç†ã€‚</p>
<h3 id="std-unique-lock-ç¤ºä¾‹"><code>std::unique_lock</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Box</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Box</span><span class="params">(<span class="keyword">int</span> num)</span> : num_things</span>&#123;num&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> num_things;</span><br><span class="line">    <span class="built_in">std</span>::mutex m;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» from å– num ç»™ to</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Box &amp;from, Box &amp;to, <span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åªæ˜¯æ¥ç®¡ï¼Œå¹¶æœªé”å®š</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock1</span><span class="params">(from.m, <span class="built_in">std</span>::defer_lock)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock2</span><span class="params">(to.m, <span class="built_in">std</span>::defer_lock)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”ä¸¤ä¸ª unique_lock è€Œä¸æ­»é”</span></span><br><span class="line">    <span class="built_in">std</span>::lock(lock1, lock2);</span><br><span class="line"></span><br><span class="line">    from.num_things -= num;</span><br><span class="line">    to.num_things += num;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 'from.m' ä¸ 'to.m' äº’æ–¥è§£é”äº 'unique_lock' ææ„å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Box <span class="title">acc1</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">    <span class="function">Box <span class="title">acc2</span><span class="params">(<span class="number">50</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(<span class="built_in">transfer</span>, <span class="built_in">std</span>::ref(acc1), <span class="built_in">std</span>::ref(acc2), <span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(<span class="built_in">transfer</span>, <span class="built_in">std</span>::ref(acc2), <span class="built_in">std</span>::ref(acc1), <span class="number">5</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::mutex m_a, m_b, m_c;</span><br><span class="line"><span class="keyword">int</span> a, b, c = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    &#123;   <span class="comment">// æ³¨æ„ï¼šå¯ç”¨ std::lock_guard æˆ– atomic&lt;int&gt; ä»£æ›¿</span></span><br><span class="line">        <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk</span><span class="params">(m_a)</span></span>;</span><br><span class="line">        a++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123; <span class="comment">// æ³¨æ„ï¼šç»†èŠ‚å’Œæ›¿ä»£å“è§ std::lock åŠ std::scoped_lock</span></span><br><span class="line">        <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk_b</span><span class="params">(m_b, <span class="built_in">std</span>::defer_lock)</span></span>;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lk_c</span><span class="params">(m_c, <span class="built_in">std</span>::defer_lock)</span></span>;</span><br><span class="line">        <span class="built_in">std</span>::lock(lk_b, lk_c);</span><br><span class="line">        <span class="comment">// ç”¨ newValue(b+c) æ›¿æ¢ c çš„å€¼ï¼Œè¿”å›çš„ oldValue èµ‹å€¼ç»™ b</span></span><br><span class="line">        b = <span class="built_in">std</span>::exchange(c, b+c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> i = <span class="number">0</span>; i &lt; <span class="number">12</span>; ++i)</span><br><span class="line">        threads.emplace_back(update);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i: threads)</span><br><span class="line">        i.join();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="string">"'th and "</span> &lt;&lt; a + <span class="number">1</span> &lt;&lt; <span class="string">"'th Fibonacci numbers: "</span></span><br><span class="line">            &lt;&lt; b &lt;&lt; <span class="string">" and "</span> &lt;&lt; c &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-shared-lock">std::shared_lock</h2>
<h3 id="std-shared-lock-ç‰¹æ€§"><code>std::shared_lock</code> ç‰¹æ€§</h3>
<p><code>shared_lock</code> ä¼šä»¥å…±äº«æ¨¡å¼é”å®š <code>mutex</code>ï¼Œæ³¨æ„ä¸ <code>unique_lock</code> çš„æ’ä»–æ€§é”å®šç›¸åŒºåˆ†ï¼Œ<code>shared_lock</code> ç±»å¯ç§»åŠ¨ï¼Œä½†ä¸å¯å¤åˆ¶ã€‚</p>
<p><code>explicit shared_lock( mutex_type&amp; m )</code><br>
ç›¸å½“äºè°ƒç”¨ <code>m.lock_shared()</code>ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ<code>shared_lock</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>locktag</code>ã€<code>try_lock_shared_for</code>ã€<code>try_lock_shared_until</code>ã€‚</p>
<p>å†™åˆ°è¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹ <code>mutex</code> ä¸ <code>lock</code> çš„å…³ç³»ï¼Œ<code>mutex</code> æ˜¯åº•å±‚åŒæ­¥åŸè¯­ï¼Œè€Œ <code>lock</code> æ˜¯é€šè¿‡ RAII æ¥ç®¡ç† <code>mutex</code> çš„å¯¹è±¡ï¼Œå› æ­¤ <code>lock</code> ä¸­çš„é”å®šä¸è§£é”å…¶å®æ˜¯å¯¹ <code>mutex</code> ä¸­é”å®šä¸è§£é”çš„å°è£…ã€‚</p>
<h3 id="std-shared-lock-ç¤ºä¾‹"><code>std::shared_lock</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;shared_mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::shared_timed_mutex m;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹éƒ½è·å¾—å¯¹æ•´æ•° i çš„è®¿é—®</span></span><br><span class="line">   <span class="function"><span class="built_in">std</span>::shared_lock&lt;<span class="built_in">std</span>::shared_timed_mutex&gt; <span class="title">slk</span><span class="params">(m)</span></span>;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"read i as "</span> &lt;&lt; i &lt;&lt; <span class="string">"...\n"</span>;</span><br><span class="line">   <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::milliseconds(<span class="number">10</span>));</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"woke up...\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="function"><span class="built_in">std</span>::thread <span class="title">r1</span><span class="params">(<span class="built_in">read</span>)</span></span>;</span><br><span class="line">   <span class="function"><span class="built_in">std</span>::thread <span class="title">r2</span><span class="params">(<span class="built_in">read</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">   r1.join();</span><br><span class="line">   r2.join();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="locktag">locktag</h2>
<h3 id="locktag-å±æ€§"><code>locktag</code> å±æ€§</h3>
<p><code>std::defer_lock</code> ä¸ºç©ºæ ‡ç­¾ç±» <code>std::defer_lock_t</code> çš„å®ä¾‹ï¼Œåªæ¥ç®¡ä¸ä¸Šé”</p>
<p><code>std::try_to_lock</code> ä¸ºç©ºæ ‡ç­¾ç±» <code>std::try_to_lock_t</code> çš„å®ä¾‹ï¼Œæ¥ç®¡åå°è¯•ä¸Šé”ï¼Œå¤±è´¥ä¹Ÿä¸é˜»å¡</p>
<p><code>std::adopt_lock</code> ä¸ºç©ºæ ‡ç­¾ç±» <code>std::adopt_lock_t</code> çš„å®ä¾‹ï¼Œä¸Šé”åæ‰æ¥ç®¡</p>
<h3 id="locktag-ç¤ºä¾‹"><code>locktag</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mutex æ”¾åœ¨ struct ä¸­é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹ bank_account</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bank_account</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">bank_account</span><span class="params">(<span class="keyword">int</span> balance)</span> : <span class="title">balance</span><span class="params">(balance)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">int</span> balance;</span><br><span class="line">    <span class="built_in">std</span>::mutex m;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(bank_account &amp;from, bank_account &amp;to, <span class="keyword">int</span> amount)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é”å®šä¸¤ä¸ªäº’æ–¥è€Œä¸æ­»é”</span></span><br><span class="line">    <span class="built_in">std</span>::lock(from.m, to.m);</span><br><span class="line">    <span class="comment">// ä¿è¯äºŒä¸ªå·²é”å®šäº’æ–¥åœ¨ä½œç”¨åŸŸç»“å°¾è§£é”</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock1</span><span class="params">(from.m, <span class="built_in">std</span>::adopt_lock)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock2</span><span class="params">(to.m, <span class="built_in">std</span>::adopt_lock)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">//    std::unique_lock&lt;std::mutex&gt; lock1(from.m, std::defer_lock);</span></span><br><span class="line"><span class="comment">//    std::unique_lock&lt;std::mutex&gt; lock2(to.m, std::defer_lock);</span></span><br><span class="line"><span class="comment">//    std::lock(lock1, lock2);</span></span><br><span class="line"></span><br><span class="line">    from.balance -= amount;</span><br><span class="line">    to.balance += amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">bank_account <span class="title">my_account</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">    <span class="function">bank_account <span class="title">your_account</span><span class="params">(<span class="number">50</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(<span class="built_in">transfer</span>, <span class="built_in">std</span>::ref(my_account), <span class="built_in">std</span>::ref(your_account), <span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(<span class="built_in">transfer</span>, <span class="built_in">std</span>::ref(your_account), <span class="built_in">std</span>::ref(my_account), <span class="number">5</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-call-once">std::call_once</h2>
<h3 id="std-call-once-å±æ€§"><code>std::call_once</code> å±æ€§</h3>
<p>æ— è®ºæœ‰å¤šå°‘ä¸ªçº¿ç¨‹è°ƒç”¨ï¼Œ<code>call_once</code> åªæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p><code>void call_once( std::once_flag&amp; flag, Callable&amp;&amp; f, Args&amp;&amp;... args )</code><br>
å¦‚æœ <code>once_flag</code> æ˜¾ç¤º <code>f</code> å·²ç»è¢«è°ƒç”¨è¿‡äº†ï¼Œ<code>call_once</code> ç«‹å³è¿”å›ï¼Œå¦åˆ™ä»¥å‚æ•° <code>args</code> è°ƒç”¨ <code>f</code>ï¼›è°ƒç”¨è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œ<code>once_flag</code> ä¸ä¼šç¿»è½¬ã€‚</p>
<p>å¦‚æœå¯¹äºåŒä¸€ä¸ª <code>once_flag</code>ï¼Œ<code>call_once</code> è°ƒç”¨ä¸åŒçš„ <code>f</code>ï¼Œæ— æ³•ç¡®å®šè°ƒç”¨çš„å…·ä½“æ˜¯å“ªä¸€ä¸ª <code>f</code>ã€‚</p>
<h3 id="std-call-once-ç¤ºä¾‹"><code>std::call_once</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::once_flag flag1, flag2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">simple_do_once</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::call_once(flag1, []()&#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Simple example: called once\n"</span>; &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">may_throw_function</span><span class="params">(<span class="keyword">bool</span> do_throw)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (do_throw) &#123;</span><br><span class="line">        <span class="comment">// å¯èƒ½æœ‰å¤šæ¬¡</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"throw: call_once will retry\n"</span>;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::exception();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åªä¼šå‡ºç°ä¸€æ¬¡</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Didn't throw, call_once will not attempt again\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_once</span><span class="params">(<span class="keyword">bool</span> do_throw)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::call_once(flag2, may_throw_function, do_throw);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (...) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ­¤å¤„åªä¼šæ‰§è¡Œä¸€æ¬¡ flag1 å¯¹åº”çš„ lambda è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">st1</span><span class="params">(simple_do_once)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">st2</span><span class="params">(simple_do_once)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">st3</span><span class="params">(simple_do_once)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">st4</span><span class="params">(simple_do_once)</span></span>;</span><br><span class="line">    st1.join();</span><br><span class="line">    st2.join();</span><br><span class="line">    st3.join();</span><br><span class="line">    st4.join();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(do_once, <span class="literal">true</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(do_once, <span class="literal">true</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t3</span><span class="params">(do_once, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t4</span><span class="params">(do_once, <span class="literal">true</span>)</span></span>;</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    t3.join();</span><br><span class="line">    t4.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MultiThreading</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Inter-Threading-Communication</tag>
        <tag>Multithreading</tag>
        <tag>Lock</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ ä¸­çš„ syncPrimitivesï¼šmutex</title>
    <url>/posts/2f6c672d/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>æœ€åŸºç¡€çš„äº’æ–¥é‡ mutex</li>
<li>èƒ½å¤Ÿå®šæ—¶å°è¯•ä¸Šé”çš„äº’æ–¥é‡ timed_mutex</li>
<li>å¯é‡å…¥çš„ recursive_mutex ä¸ recursive_timed_mutex</li>
<li>åŒæ—¶æ”¯æŒç‹¬å ä¸å…±äº«ç®¡ç†çš„ shared_mutex ä¸ shared_timed_mutex</li>
</ul>
</blockquote>
<a id="more"></a>
<p>æœ€è¿‘åœ¨æ’¸æ—¥å¿—åº“çš„æ—¶å€™å‘ç°äº† C++11 ç«Ÿç„¶æœ‰è¿™ä¹ˆå¤šçš„ <code>mutex</code> ç±»å‹ä¸ <code>lock</code> ç±»å‹ï¼Œæœ¬ç¯‡å…ˆæ€»ç»“ä¸€ä¸‹ <code>mutex</code> ç±»å‹ã€‚<br>
æœ¬æ–‡ä¸­çš„ç¤ºä¾‹å‡æ¥è‡ª <em>CppReference</em>ï¼Œä»…æ·»åŠ éƒ¨åˆ†æ³¨é‡Šï¼Œä¸å†åšç‰¹æ®Šè¯´æ˜ã€‚</p>
<h2 id="std-mutex">std::mutex</h2>
<h3 id="std-mutex-ç‰¹æ€§"><code>std::mutex</code> ç‰¹æ€§</h3>
<p><code>mutex</code> ç±»èƒ½å¤Ÿä¿æŠ¤å…±äº«æ•°æ®æŸä¸ªæ—¶åˆ»åªèƒ½å…è®¸å•ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p>
<p>å½“æŸä¸ªçº¿ç¨‹å æœ‰ <code>mutex</code> æ—¶ï¼Œ<strong>å…¶ä»–</strong>è¯•å›¾è·å– <code>mutex</code> æ‰€æœ‰æƒçš„çº¿ç¨‹å°†ä¼šé˜»å¡ - é€šè¿‡ <code>lock</code> è°ƒç”¨ï¼Œæˆ–è€…æ”¶åˆ° <code>false</code> - é€šè¿‡ <code>try_lock</code> è°ƒç”¨ã€‚</p>
<p>å½“æŸä¸ªçº¿ç¨‹å æœ‰ <code>mutex</code> æ—¶ï¼Œ<strong>è¯¥çº¿ç¨‹</strong>å†æ¬¡å°è¯• <code>lock</code> ä¼šå‡ºç°æœªå®šä¹‰è¡Œä¸ºï¼Œæ¯”å¦‚æ­»é”ï¼ŒC++ æ ‡å‡†æ¨èæ­¤æ—¶èƒ½å¤ŸæŠ›å‡º <code>std::system_error(resource_deadlock_would_occur)</code> æ¥å–ä»£æ­»é”ã€‚</p>
<p><code>mutex</code> çš„å¤åˆ¶æ„é€ å‡½æ•°ä¸èµ‹å€¼è¿ç®—ç¬¦éƒ½è¢« <code>delete</code> æ‰ï¼Œå› ä¸ºæ²¡æœ‰æ„ä¹‰ã€‚</p>
<p><code>mutex</code> ç±»çš„æˆå‘˜å‡½æ•° <code>lock</code> ä¸ <code>unlock</code> ä¸åº”è¯¥æ‰‹å·¥è°ƒç”¨ï¼Œè€Œåº”è¯¥äº¤ç»™æ ˆä¸Šçš„é”ç®¡ç†å¯¹è±¡é€šè¿‡æ„é€ å’Œææ„ç®¡ç†ã€‚</p>
<h3 id="std-mutex-ç¤ºä¾‹"><code>std::mutex</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="built_in">std</span>::<span class="built_in">string</span>&gt; g_pages;</span><br><span class="line"><span class="built_in">std</span>::mutex g_pages_mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_page</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿé•¿é¡µé¢è¯»å–</span></span><br><span class="line">    <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> result = <span class="string">"fake content"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save_page ç»“æŸå mutex é‡Šæ”¾</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">guard</span><span class="params">(g_pages_mutex)</span></span>;</span><br><span class="line">    g_pages[url] = result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// t1 t2 ä¾æ¬¡å°†ç½‘é¡µå†…å®¹å¡«å…¥ map ä¸­</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t1</span><span class="params">(save_page, <span class="string">"http://foo"</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t2</span><span class="params">(save_page, <span class="string">"http://bar"</span>)</span></span>;</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç°åœ¨è®¿é—® g_pages æ˜¯å®‰å…¨çš„ï¼Œå› ä¸º t1 t2 ç”Ÿå‘½å‘¨æœŸå·²ç»“æŸ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;pair : g_pages) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; pair.first &lt;&lt; <span class="string">" =&gt; "</span> &lt;&lt; pair.second &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-timed-mutex">std::timed_mutex</h2>
<h3 id="std-timed-mutex-ç‰¹æ€§"><code>std::timed_mutex</code> ç‰¹æ€§</h3>
<p><code>timed_mutex</code> åœ¨ <code>mutex</code> çš„åŸºç¡€ä¸Šæ–°å¢äº†ä¸€äº›åŠŸèƒ½ï¼Œæ·»åŠ äº†ä¸¤ä¸ªæˆå‘˜å‡½æ•° <code>try_lock_for</code> å’Œ <code>try_lock_until</code>ã€‚</p>
<p><code>try_lock_for</code> åœ¨å°è¯•è·å–é”çš„è¿‡ç¨‹ä¸­ä¼šé˜»å¡ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´éƒ½æ²¡æœ‰è·å–åˆ°é”å°±è¿”å› <code>false</code>ï¼Œè€Œ <code>try_lock_until</code> åˆ™ä¼šé˜»å¡åˆ°æŒ‡å®šæ—¶é—´ï¼Œé™¤éåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†é”ã€‚</p>
<h3 id="std-timed-mutex-ç¤ºä¾‹"><code>std::timed_mutex</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ§åˆ¶åˆ° std::cout çš„è®¿é—®</span></span><br><span class="line"><span class="built_in">std</span>::mutex cout_mutex;</span><br><span class="line"><span class="built_in">std</span>::timed_mutex mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">job</span><span class="params">(<span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> Ms = <span class="built_in">std</span>::chrono::milliseconds;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">ostringstream</span> stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸ªçº¿ç¨‹éƒ½å°è¯• 3 æ¬¡è·å– timed_mutex</span></span><br><span class="line">    <span class="comment">// æˆåŠŸäº†æ‰“å° success å¹¶ sleep 100Ms</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mutex.try_lock_for(Ms(<span class="number">100</span>))) &#123;</span><br><span class="line">            stream &lt;&lt; <span class="string">"success "</span>;</span><br><span class="line">            <span class="built_in">std</span>::this_thread::sleep_for(Ms(<span class="number">100</span>));</span><br><span class="line">            mutex.unlock();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            stream &lt;&lt; <span class="string">"failed "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::this_thread::sleep_for(Ms(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¾“å‡ºæ—¶ä¹Ÿéœ€è¦è·å– mutex</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(cout_mutex)</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"["</span> &lt;&lt; id &lt;&lt; <span class="string">"] "</span> &lt;&lt; stream.str() &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; threads;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="comment">// explicit thread(Function&amp;&amp; f, Args&amp;&amp;... args)</span></span><br><span class="line">        <span class="comment">// å€¼ä¼ é€’æ„é€ çº¿ç¨‹å¹¶å¯åŠ¨</span></span><br><span class="line">        threads.emplace_back(job, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i: threads) &#123;</span><br><span class="line">        i.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::timed_mutex test_mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> now = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    <span class="comment">// å¡«å…¥è¦é˜»å¡åˆ°çš„æœ€å¤§æ—¶é—´ç‚¹</span></span><br><span class="line">    test_mutex.try_lock_until(now + <span class="built_in">std</span>::chrono::seconds(<span class="number">10</span>));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹å·²ç»è·å¾—äº† time_mutexï¼Œthread t åªèƒ½é˜»å¡ 10S</span></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::timed_mutex&gt; <span class="title">l</span><span class="params">(test_mutex)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">t</span><span class="params">(f)</span></span>;</span><br><span class="line">    t.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-recursive-mutex">std::recursive_mutex</h2>
<h3 id="std-recursive-mutex-ç‰¹æ€§"><code>std::recursive_mutex</code> ç‰¹æ€§</h3>
<p><code>recursive_mutex</code> åˆè¢«ç§°ä¸ºé€’å½’äº’æ–¥å™¨ï¼Œå®ƒä¸ <code>non-recursive mutex</code> çš„åŒºåˆ«åœ¨äºæ‹¥æœ‰é”çš„çº¿ç¨‹å†æ¬¡ <code>lock</code> æ—¶ä¸ä¼šå‡ºç°æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œæ˜¯è®°å…¥åŠ é”æ¬¡æ•°ä¸­ï¼Œ<code>unlock</code> æ—¶å¿…é¡»åŒ¹é…åˆ° <code>lock</code> çš„æ¬¡æ•°æ‰èƒ½æˆåŠŸè§£é”ã€‚</p>
<p>å¯¹ <code>recursive_mutex</code> åŠ é”çš„æœ€å¤§æ¬¡æ•°æ˜¯æœªçŸ¥çš„ï¼Œè¾¾åˆ°æœ€å¤§æ¬¡æ•°æ—¶ç»§ç»­ <code>lock</code> ä¼šæŠ›å‡º <code>std::system_error</code>ã€‚</p>
<p>éƒ¨åˆ†åœºåˆä¸‹ï¼Œ<code>recursive_mutex</code> ä¼šæ©ç›–ä»£ç çš„ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢çš„æƒ…å½¢ä¸­ï¼Œå½“ <code>doit</code> ä¸å°å¿ƒé—´æ¥è°ƒç”¨åˆ°äº† <code>post</code>ï¼Œ<code>mutex</code> æœ‰å¯èƒ½ä¼šæ­»é”ï¼Œè€Œ <code>recursive_mutex</code> ä¼šå¶å°” <code>crash</code>ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::mutex mutex;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Foo&gt; foos;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">post</span><span class="params">(<span class="keyword">const</span> Foo&amp; f)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    foos.push_back(f);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it = foos.<span class="built_in">begin</span>(); it != foos.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">        it-&gt;doit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="std-recursive-mutex-ç¤ºä¾‹"><code>std::recursive_mutex</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::recursive_mutex test;</span><br><span class="line">    <span class="comment">// å°è¯•é”å®šå¹¶è§£é”</span></span><br><span class="line">    <span class="keyword">if</span> (test.try_lock()) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"lock acquired"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        test.unlock();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"lock not acquired"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†æ¬¡é”å®š</span></span><br><span class="line">    test.lock();</span><br><span class="line">    <span class="comment">// å†æ¬¡é”å®šä»ç„¶èƒ½å¤ŸæˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (test.try_lock()) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"lock acquired"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"lock not acquired"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    test.unlock();</span><br><span class="line">    <span class="comment">//test.unlock();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-recursive-timed-mutex">std::recursive_timed_mutex</h2>
<h3 id="std-recursive-timed-mutex-ç‰¹æ€§"><code>std::recursive_timed_mutex</code> ç‰¹æ€§</h3>
<p><code>recursive_timed_mutex</code> æ˜¯ <code>recursive_mutex</code> å’Œ <code>timed_mutex</code> çš„åˆä½“ï¼Œç‰¹æ€§ä¸ç¤ºä¾‹å‡å‚ç…§ä»¥ä¸Šã€‚</p>
<h2 id="std-shared-mutex">std::shared_mutex</h2>
<h3 id="std-shared-mutex-ç‰¹æ€§"><code>std::shared_mutex</code> ç‰¹æ€§</h3>
<p><code>shared_mutex</code> æ˜¯ C++17 ä¸­å¼•å…¥çš„æ–°ç‰¹æ€§ã€‚å®ƒæ‹¥æœ‰ä¸¤ä¸ªè®¿é—®çº§åˆ«ï¼š<br>
å¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿå…±äº«åŒä¸€ä¸ª <code>shared_mutex</code> çš„æ‰€æœ‰æƒï¼›<br>
ä»…ä¸€ä¸ªçº¿ç¨‹èƒ½è·å¾— <code>shared_mutex</code> çš„æ‰€æœ‰æƒã€‚</p>
<p><code>shared_mutex</code> å³æœ‰æ’ä»–é”å®šçš„æˆå‘˜å‡½æ•° <code>lock</code>ã€<code>try_lock</code>ã€<code>unlock</code>ï¼Œåˆæœ‰å…±äº«é”å®šçš„æˆå‘˜å‡½æ•° <code>lock_shared</code>ã€<code>try_lock_shared</code>ã€<code>unlock_shared</code>ã€‚</p>
<p><code>shared_mutex</code> æœ¬è´¨æ˜¯ <code>rwlock</code>ï¼ŒåŸºæœ¬è§„åˆ™å¯ä»¥æ€»ç»“ä¸º<strong>å†™ä¼˜å…ˆã€è¯»å…±äº«ã€äº¤å‰äº’æ–¥</strong>ï¼Œä¹‹æ‰€ä»¥å†™ä¼˜å…ˆæ˜¯å› ä¸ºèƒ½å¤Ÿä¿è¯è¯»åˆ°æ•°æ®æ˜¯æœ€æ–°çš„ã€‚</p>
<p>å½“ <code>shared_mutex</code> å½“å‰æ˜¯å†™åŠ é”æ—¶ï¼Œæ‰€æœ‰å°è¯• <code>lock</code> çš„çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼›<br>
å½“ <code>shared_mutex</code> å½“å‰æ˜¯è¯»åŠ é”æ—¶ï¼Œæ‰€æœ‰å°è¯•ä»¥è¯»æ¨¡å¼ <code>lock</code> çš„çº¿ç¨‹èƒ½å¤Ÿè·å¾—è®¿é—®æƒï¼Œä»¥å†™æ¨¡å¼ <code>lock</code> çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›<br>
å½“ <code>shared_mutex</code> è¯»åŠ é”æ—¶æœ‰å…¶å®ƒçº¿ç¨‹å°è¯•ä»¥å†™æ¨¡å¼ <code>lock</code> æ—¶ï¼Œ<code>shared_mutex</code> ä¼šé˜»å¡åé¢çš„è¯»æ¨¡å¼ï¼Œç›´åˆ°å†™æ¨¡å¼ç»“æŸé‡Šæ”¾é”ã€‚</p>
<p>å¦‚æœæ˜¯è‡ªå·±å®ç°è¯»å†™é”çš„æ—¶å€™å¯èƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œ<strong>é€šå¸¸ <code>reader lock</code> æ˜¯å¯é‡å…¥çš„ï¼Œè€Œ <code>writer lock</code> æ˜¯ä¸å¯é‡å…¥çš„ï¼Œé‚£ä¹ˆ <code>reader lock</code> é‡å…¥çš„æ—¶å€™å¯èƒ½ä¼šé€ æˆæ­»é”</strong>ã€‚</p>
<h3 id="std-shared-mutex-ç¤ºä¾‹"><code>std::shared_mutex</code> ç¤ºä¾‹</h3>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;shared_mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadSafeCounter</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ThreadSafeCounter() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»çš„æ—¶å€™ä½¿ç”¨å…±äº«é”</span></span><br><span class="line">    <span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::shared_lock&lt;<span class="built_in">std</span>::shared_mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> value_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™çš„æ—¶å€™ä½¿ç”¨ç‹¬å é”</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::shared_mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        value_++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡ç½®çš„æ—¶å€™ä½¿ç”¨ç‹¬å é”</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::unique_lock&lt;<span class="built_in">std</span>::shared_mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        value_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// get const ä¸­éœ€è¦åŠ é”ï¼Œå› æ­¤ mutex_ éœ€è¦å®šä¹‰ä¸º mutable</span></span><br><span class="line">    <span class="keyword">mutable</span> <span class="built_in">std</span>::shared_mutex mutex_;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> value_ = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ThreadSafeCounter counter;</span><br><span class="line">    <span class="built_in">std</span>::mutex printMutex;</span><br><span class="line">    <span class="keyword">auto</span> increment_and_print = [&amp;counter, &amp;printMutex]() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            counter.increment();</span><br><span class="line">            <span class="comment">// å†™å…¥ std::cout å®é™…ä¸Šä¹Ÿè¦ç”±å¦ä¸€äº’æ–¥åŒæ­¥</span></span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(printMutex)</span></span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::this_thread::get_id() &lt;&lt; <span class="string">' '</span> &lt;&lt; counter.<span class="built_in">get</span>() &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">thread1</span><span class="params">(increment_and_print)</span></span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">thread2</span><span class="params">(increment_and_print)</span></span>;</span><br><span class="line"></span><br><span class="line">    thread1.join();</span><br><span class="line">    thread2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="std-shared-timed-mutex">std::shared_timed_mutex</h2>
<h3 id="std-shared-timed-mutex-ç‰¹æ€§"><code>std::shared_timed_mutex</code> ç‰¹æ€§</h3>
<p><code>shared_timed_mutex</code> æ˜¯ <code>shared_mutex</code> ä¸ <code>timed_mutex</code> çš„åˆä½“ï¼š<br>
æ’ä»–é”å®šæˆå‘˜å‡½æ•° <code>lock</code>ã€<code>try_lock</code>ã€<code>try_lock_for</code>ã€<code>try_lock_until</code>ã€<code>unlock</code>ï¼›<br>
å…±äº«é”å®šæˆå‘˜å‡½æ•° <code>lock_shared</code>ã€<code>try_lock_shared</code>ã€<code>try_lock_shared_for</code>ã€<code>try_lock_shared_until</code>ã€<code>unlock_shared</code>ã€‚</p>
]]></content>
      <categories>
        <category>MultiThreading</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>MultiThreading</tag>
        <tag>Inter-Threading-Communication</tag>
        <tag>Mutex</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ å’Œ Javaï¼šåŒºåˆ«åˆ°åº•åœ¨å“ªé‡Œ</title>
    <url>/posts/54e19ff4/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>ä»è¯­è¨€ç‰¹æ€§ä¸Šæ¥è¯´ï¼Œä¸»è¦æ˜¯å˜é‡è¯­ä¹‰ä¸ç¼–ç¨‹èŒƒå¼çš„åŒºåˆ«</li>
<li>ä»ç¼–ç æ–¹å¼ä¸Šæ¥è¯´ï¼Œå®ƒä»¬ç”³è¯·å¯¹è±¡çš„æ–¹å¼ã€èµ„æºç®¡ç†ã€é”™è¯¯å¤„ç†éƒ½ä¸å¤ªç›¸åŒ</li>
<li>ä»ç¼–è¯‘è¿è¡Œä¸Šæ¥è¯´ï¼Œå®ƒä»¬ç¼–è¯‘è¿è¡Œçš„æ–¹å¼ã€å¯¹å¤–æš´éœ²æ¥å£çš„æ–¹å¼ã€å¼•ç”¨å¤–éƒ¨ç±»çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·</li>
</ul>
</blockquote>
<a id="more"></a>
<p>åœ¨åš C/C++ å¼€å‘çš„æ—¶å€™ä¹Ÿä¼šç»å¸¸æ¥è§¦åˆ° Java ç›¸å…³çš„ä»£ç ä¸çŸ¥è¯†ï¼Œä¸‹é¢æ€»ç»“ä¸€ä¸‹å®ƒä»¬ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼š</p>
<h2 id="å˜é‡è¯­ä¹‰çš„åŒºåˆ«">å˜é‡è¯­ä¹‰çš„åŒºåˆ«</h2>
<p>C++ ä¸­æ‰€æœ‰çš„å˜é‡ç¼ºçœéƒ½æ˜¯å€¼è¯­ä¹‰ï¼Œå¦‚æœä¸ä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œå˜é‡ä¸ä¼šå¼•ç”¨ä¸€ä¸ªå †ä¸Šçš„å¯¹è±¡ã€‚<br>
å€¼è¯­ä¹‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ç®€å•ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ <em>stack object</em>ï¼Œä½†æ˜¯é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨æ¥æ“ä½œå †ä¸Šå¯¹è±¡çš„æ—¶å€™ï¼ŒC++ å°±éœ€è¦è€ƒè™‘æ‰€æŒ‡å¯¹è±¡æ˜¯å¦æˆåŠŸé‡Šæ”¾ã€‚<strong>æ™ºèƒ½æŒ‡é’ˆèƒ½å¤Ÿå°†å¼•ç”¨è¯­ä¹‰è½¬åŒ–ä¸ºå€¼è¯­ä¹‰æ¥è§£å†³ä¸Šè¿°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜</strong>ã€‚ç”±äº <em>memory locality</em>ï¼ŒC++ çš„å€¼è¯­ä¹‰åœ¨æ€§èƒ½ä¸Šå…·æœ‰æå¤§çš„ä¼˜åŠ¿ã€‚<br>
Java ä¸­å¤§éƒ¨åˆ†å˜é‡åˆ™æ˜¯å¼•ç”¨è¯­ä¹‰ï¼Œæ ˆç©ºé—´çš„å˜é‡éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤å¦‚æœå‘ç”Ÿæ‹·è´éƒ½æ˜¯æµ…æ‹·è´ã€‚</p>
<h2 id="ç¼–ç¨‹èŒƒå¼çš„åŒºåˆ«">ç¼–ç¨‹èŒƒå¼çš„åŒºåˆ«</h2>
<p>C++ æ˜¯ä¸€é—¨å¤šèŒƒå¼çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ã€æ³›å‹ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¼€å‘çµæ´»æ€§é«˜ã€‚<br>
Java æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæˆ–è®¸è¿˜æœ‰æ³›å‹ï¼Ÿ</p>
<h2 id="ç”³è¯·å¯¹è±¡æ–¹å¼çš„åŒºåˆ«">ç”³è¯·å¯¹è±¡æ–¹å¼çš„åŒºåˆ«</h2>
<p>å˜é‡è¯­ä¹‰çš„åŒºåˆ«å¸¦æ¥äº†ç”³è¯·å¯¹è±¡æ–¹å¼çš„åŒºåˆ«ã€‚<br>
C++ å¯ä»¥è‡ªç”±æ§åˆ¶å¯¹è±¡æ˜¯åœ¨å †ä¸Šåˆ†é…è¿˜æ˜¯åœ¨æ ˆä¸Šåˆ†é…ï¼Œå †ä¸Šåˆ†é…æ—¶é—´ä¸ç¡®å®šï¼Œè€Œæ ˆä¸Šåˆ†é…é€Ÿåº¦æå¿«ã€‚<br>
Java æå€¡æ‰€æœ‰å¯¹è±¡éƒ½åœ¨å †ä¸Šåˆ†é…ï¼ˆåŸç”Ÿç±»å‹ä¹Ÿæœ‰å¯¹åº”çš„å°è£…ç±»ï¼‰ï¼Œç”± GC ç»Ÿä¸€ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€‚</p>
<h2 id="èµ„æºç®¡ç†æ–¹å¼çš„åŒºåˆ«">èµ„æºç®¡ç†æ–¹å¼çš„åŒºåˆ«</h2>
<p>C++ æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå› æ­¤ C++ åœ¨å †ä¸Šå¼€è¾Ÿäº†ä¸€æ®µæ–°ç©ºé—´å­˜æ”¾æ•°æ®ä¹‹åè¿˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ç©ºé—´ã€‚<br>
å¯¹äºä¸€äº›ç”Ÿå‘½å‘¨æœŸæ¨¡ç³Šçš„å¯¹è±¡ï¼ŒC++11 ä¹‹åä½¿ç”¨äº†æ”¹è¿›ç‰ˆçš„æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ç† new å‡ºæ¥çš„å¯¹è±¡ï¼Œé‡Šæ”¾å¯¹è±¡çš„ä»»åŠ¡äº¤ç»™æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨å®Œæˆï¼Œæ•´ä¸ªè¿‡ç¨‹ä½¿ç”¨çš„æ˜¯ RAII æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ™ºèƒ½æŒ‡é’ˆçš„æ–‡ç« ã€‚<br>
Java ä¸­æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå †ä¸­ç”³è¯·çš„ç©ºé—´ GC ä¼šè‡ªåŠ¨å›æ”¶ï¼Œè€Œ Java æ²¡æœ‰ææ„å‡½æ•°ï¼Œä¹Ÿå‡ ä¹å¾ˆå°‘ç”¨ RAII æ¥ç®¡ç†èµ„æºã€‚</p>
<h2 id="é”™è¯¯å¤„ç†æ–¹å¼çš„åŒºåˆ«">é”™è¯¯å¤„ç†æ–¹å¼çš„åŒºåˆ«</h2>
<p>C++ å‡ºäºå†å²åŸå› ï¼ˆGoogle ç¼–ç é£æ ¼ï¼‰æˆ–æ˜¯æ€§èƒ½åŸå› ï¼ˆå¼‚å¸¸æŠ›å‡ºå¯¼è‡´ç³»ç»Ÿå®æ—¶æ€§å—æŸï¼‰å¯ä»¥ä¸ä½¿ç”¨å¼‚å¸¸ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨å¼‚å¸¸ï¼Œä»£ç ä¸­å¯èƒ½å‡ºç°å¤§é‡çš„ <code>try{...}catch{...}</code> è¯­å¥ï¼Œä»£ç å°†ä¼šå˜å¾—å†—é•¿éš¾è¯»ï¼Œè€Œä¸”<strong>åœ¨æ³›å‹ç¼–ç¨‹çš„ä»£ç ä¸­æˆ‘ä»¬ç”šè‡³ä¸çŸ¥é“å¯èƒ½ä¼šå‡ºç°å“ªäº›å¼‚å¸¸</strong>ã€‚<br>
æ‰€ä»¥ <strong>ä» C++17 å¼€å§‹ï¼Œå¯¹å¼‚å¸¸çš„å¤„ç†æ ‡å‡†å˜æˆäº†æˆ‘ä»¬åªèƒ½å£°æ˜æŸäº›å‡½æ•°ä¸èƒ½æŠ›å‡ºå¼‚å¸¸</strong>ã€‚åœ¨è¿è¡Œä¹‹å‰ï¼Œæ— è®ºæ˜¯ä»£ç å£°æ˜è¿˜æ˜¯ç¼–è¯‘å™¨éƒ½ä¸èƒ½å‘ç°å¼‚å¸¸ã€‚<br>
Java ä¸­å¦‚æœä¸€ä¸ªå‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™å¼ºåˆ¶å®ƒçš„è°ƒç”¨æ–¹å¿…é¡»è¦å¤„ç†å¼‚å¸¸ã€‚</p>
<h2 id="å¯¹å¤–æš´éœ²æ¥å£çš„åŒºåˆ«">å¯¹å¤–æš´éœ²æ¥å£çš„åŒºåˆ«</h2>
<p>C++ é™¤äº†<strong>æ¨¡æ¿ç±»éœ€è¦å°†æ¥å£å’Œå®ç°éƒ½æ”¾åœ¨å¤´æ–‡ä»¶ä¸­</strong>ï¼Œå…¶ä»–æƒ…å†µä¸‹éƒ½æ˜¯<strong>å¤´æ–‡ä»¶æä¾›å¯¹å¤–æ¥å£ï¼Œæºæ–‡ä»¶å®ç°å¯¹å¤–æ¥å£</strong>ã€‚<br>
Java ä¸»è¦æ˜¯é€šè¿‡ç»§æ‰¿å’Œå¤šæ€æ¥å®ç°è‡ªå®šä¹‰æ¥å£ã€‚</p>
<h2 id="å¼•ç”¨å¤–éƒ¨ç±»ä¸ä¾èµ–å…³ç³»çš„åŒºåˆ«">å¼•ç”¨å¤–éƒ¨ç±»ä¸ä¾èµ–å…³ç³»çš„åŒºåˆ«</h2>
<p>C++ çš„å¤´æ–‡ä»¶æœºåˆ¶ä¼šå¼•å…¥å¤§é‡ä¸ç›¸å…³çš„ä»£ç ä¾èµ–ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ç»å¸¸å‡ºç°æŸä¸ªä¾èµ–çš„å¤´æ–‡ä»¶ä¸åŒ¹é…ï¼Œä½†æ˜¯å´æ‰¾ä¸åˆ°æ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¤´æ–‡ä»¶çš„ï¼ŒåŒæ ·çš„ï¼Œé“¾æ¥æ—¶ä¹Ÿä¼šå‡ºç°åº“ç‰ˆæœ¬ä¸å¯¹æˆ–è€…åº“çš„ç¼–è¯‘å‚æ•°ä¸åŒ¹é…ç­‰é”™è¯¯ã€‚<br>
Java çš„ import æœºåˆ¶ä»¥åŠ package æœºåˆ¶èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œç”¨åˆ°å“ªä¸ªç±»å°± import å“ªä¸ªç±»ï¼Œç”¨åˆ°çš„åº“æ–‡ä»¶ä¹Ÿèƒ½å¤Ÿç¼–è¯‘æˆä¸€ä¸ª .jar åŒ…ç”¨äºå¤–éƒ¨ importï¼Œç®€å•é«˜æ•ˆã€‚</p>
<h2 id="ç¼–è¯‘è¿è¡Œæ–¹å¼çš„åŒºåˆ«">ç¼–è¯‘è¿è¡Œæ–¹å¼çš„åŒºåˆ«</h2>
<p>C++ å…ˆå°†ä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å’Œå¹³å°æœ‰å…³çš„ï¼Œæ‰€ä»¥å¸¸è¯´ <strong>C++ ä¸æ˜¯è·¨å¹³å°çš„</strong>ï¼Œæ“ä½œç³»ç»Ÿå°†è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¯»å…¥å†…å­˜æ‰§è¡Œã€‚<br>
Java æ˜¯å°†æºæ–‡ä»¶ .java ç¼–è¯‘æˆ .class å­—èŠ‚ç ï¼Œå†<strong>é€šè¿‡ Jvm å°†å­—èŠ‚ç è½½å…¥å†…å­˜ä¸­ç¿»è¯‘æ‰§è¡Œ</strong>ã€‚æ‰€ä»¥ Java çš„è·¨å¹³å°æ˜¯é€šè¿‡ä¸å¹³å°æ— å…³çš„å­—èŠ‚ç å®ç°çš„ã€‚<br>
å› ä¸º Jvm åŠ è½½å­—èŠ‚ç åæ˜¯ä¸€è¾¹ç¿»è¯‘ä¸€è¾¹æ‰§è¡Œçš„ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šç•¥ä½äº C++ï¼Œä½†æ˜¯åœ¨ç¡¬ä»¶æˆæœ¬æä½çš„ç°åœ¨æ‰§è¡Œæ•ˆç‡çš„å·®å¼‚å·²ç»è¢«æ‹‰åˆ°å¾ˆä½äº†ã€‚</p>
<p>ä»¥ä¸Šï¼ŒJava ä¸ C++ ç›¸æ¯”ï¼Œç¤¾åŒºæ›´åŠ æ´»è·ƒï¼Œå·¥å…·ä¹Ÿæ›´åŠ ä¸°å¯Œï¼Œå¼€æºåº“ä¹Ÿå¤šï¼Œéš¾æ€ªåœ¨è®²ç©¶é€Ÿåº¦ä¸æ•ˆç‡çš„äº’è”ç½‘è¡Œä¸šå¦‚æ­¤å—æ¬¢è¿ã€‚</p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Programming-Language</tag>
      </tags>
  </entry>
  <entry>
    <title>ä» RAII åˆ° smartPtrï¼šæ™ºèƒ½æŒ‡é’ˆå‰–æ</title>
    <url>/posts/3a3d14bc/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>ä»‹ç»äº† RAII çš„åŸºæœ¬æ¦‚å¿µ</li>
<li>ä»‹ç»äº†æ™ºèƒ½æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ</li>
<li>å®ç°äº† auto_ptr / unique_ptr / shared_ptr</li>
<li>ä»‹ç»äº†æ™ºèƒ½æŒ‡é’ˆçš„ Deleter ä¸å¤šçº¿ç¨‹ä¸‹çš„åº”ç”¨</li>
</ul>
</blockquote>
<a id="more"></a>
<h2 id="RAII-çš„åŸºæœ¬æ¦‚å¿µ">RAII çš„åŸºæœ¬æ¦‚å¿µ</h2>
<h3 id="ä»€ä¹ˆæ˜¯å †">ä»€ä¹ˆæ˜¯å †</h3>
<p>åœ¨å†…å­˜ç®¡ç†çš„èŒƒç•´ä¸­ï¼Œæˆ‘ä»¬å°†ç¨‹åºä¸­èƒ½å¤ŸåŠ¨æ€åˆ†é…å†…å­˜çš„åŒºåŸŸç§°ä¸ºå † - <em>heap</em>ï¼ŒC/C++ éƒ½æä¾›äº†æ“ä½œ <em>heap</em> çš„å‡½æ•°æˆ–è¿ç®—ç¬¦ï¼š</p>
<ul>
<li>
<p>C ä½¿ç”¨ <code>malloc/free</code> æ“ä½œ <em>heap</em></p>
</li>
<li>
<p>C++ ä½¿ç”¨ <code>new/delete</code> æ“ä½œ <em>heap</em></p>
</li>
</ul>
<p>ç±»ä¼¼äºä¸‹é¢çš„ä»£ç å°±ä¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> vecPtr = <span class="keyword">new</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</span><br></pre></td></tr></table></figure>
<p>åœ¨å †ä¸Šåˆ†é…äº†å†…å­˜ä¹‹åçš„å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯é‡Šæ”¾å†…å­˜ï¼Œå’Œ Java çš„åƒåœ¾æ”¶é›†æœºåˆ¶ä¸åŒï¼ŒC++ çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾éƒ½ç”±å†…å­˜ç®¡ç†å™¨æ¥æ“ä½œï¼Œé€šå¸¸éƒ½ä¸ä½¿ç”¨åƒåœ¾æ”¶é›†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„åªæ˜¯æŠŠ <code>new</code> å‡ºæ¥çš„å†…å­˜å†é€šè¿‡ <code>delete</code> é‡Šæ”¾æ‰å³å¯ï¼Œä½†æ˜¯äº‹å®ä¸ŠçœŸçš„è¿™ä¹ˆç®€å•å—ï¼Ÿ</p>
<h3 id="ä»€ä¹ˆæ˜¯æ ˆ">ä»€ä¹ˆæ˜¯æ ˆ</h3>
<p>å‡½æ•°åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨æ•°æ®ã€ç”Ÿæˆæ•°æ®æ—¶ä½¿ç”¨çš„å†…å­˜åŒºåŸŸç§°ä¸ºæ ˆ - <em>stack</em>ï¼Œå®ƒå’Œæ•°æ®ç»“æ„ä¸­çš„æ ˆç±»ä¼¼ï¼Œéƒ½æ˜¯ LIFOã€‚ä»¥ x86 ä¸ºä¾‹ï¼Œ<strong>æ ˆçš„å¢é•¿æ–¹å‘æ˜¯ç”±é«˜åœ°å€å‘ä½åœ°å€å¢é•¿</strong>ï¼Œå‡½æ•°ä¹‹é—´è°ƒç”¨æ—¶ï¼Œè°ƒç”¨å‡½æ•°ä¼šå°†è‡ªå·±çš„å‚æ•°å‹å…¥æ ˆä¸­ï¼ŒåŒæ—¶æŠŠè‡ªå·±ä¸‹ä¸€è¡Œçš„æŒ‡ä»¤ä¹Ÿå‹å…¥æ ˆä¸­ï¼Œå†è·³è½¬åˆ°æ–°çš„å‡½æ•°å¹¶è°ƒæ•´æ ˆæŒ‡é’ˆï¼Œæ–°çš„å‡½æ•°åœ¨æ‰§è¡Œå®Œä¹‹åä¼šæ ¹æ®æ ˆä¸­ä¿å­˜çš„è°ƒç”¨å‡½æ•°çš„åœ°å€<strong>é‡æ–°å›åˆ°è°ƒç”¨å‡½æ•°æœªæ‰§è¡Œçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ</strong>ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œæ ˆä¸Šç©ºé—´çš„åˆ†é…å’Œé‡Šæ”¾é€»è¾‘éƒ½ååˆ†ç®€å•ï¼Œåªè¦ç§»åŠ¨æ ˆæŒ‡é’ˆå³å¯ï¼Œå…·ä½“åˆ†é…ç©ºé—´çš„æ—¶å€™ï¼Œæ¯ä¸ªå‡½æ•°åˆ†åˆ°çš„å±äºè‡ªå·±çš„é‚£ä¸€ä»½ç§°ä¸ºæ ˆå¸§ - <em>stack frame</em>ï¼Œå³ä½¿æ˜¯æœ‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„æƒ…å†µä¸‹ï¼ŒC++ çš„ç¼–è¯‘å™¨ä¹Ÿä¼šåœ¨æ ˆå¸§çš„é€‚å½“ä½ç½®æ·»åŠ å¯¹æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„è°ƒç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>å°±ç®—å‡½æ•°æŠ›å‡ºäº†å¼‚å¸¸ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°</strong>ï¼Œæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Obj()&#123; <span class="built_in">puts</span>(<span class="string">"Obj()"</span>); &#125;</span><br><span class="line">    ~Obj()&#123; <span class="built_in">puts</span>(<span class="string">"~Obj()"</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    Obj obj;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">"func error"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        func(<span class="number">0</span>);</span><br><span class="line">        func(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="keyword">const</span> <span class="keyword">char</span>* str)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">    Obj()</span><br><span class="line">    ~Obj()</span><br><span class="line">    Obj()</span><br><span class="line">    ~Obj()</span><br><span class="line">    func error</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>func(1)</code> åœ¨å°†å¼‚å¸¸æŠ›å‡ºä¹‹å‰å°±å·²ç»è°ƒç”¨äº†è‡ªèº«çš„ææ„å‡½æ•°ï¼Œè€Œè¿™ç‚¹æ­£æ˜¯ RAII çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-RAII">ä»€ä¹ˆæ˜¯ RAII</h3>
<p>RAII - <em>Resource Acquisition Is Initialization</em>ï¼Œèµ„æºè·å–å³åˆå§‹åŒ–ï¼Œ<strong>RAII æ˜¯ä¸€ç§èµ„æºç®¡ç†æ–¹å¼ï¼Œå®ƒé€šè¿‡æ ˆå’Œææ„å‡½æ•°æ¥ç®¡ç†åŒ…æ‹¬å †åœ¨å†…çš„æ‰€æœ‰èµ„æº</strong>ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€ä¸­åªæœ‰ C++ æ˜¯ä½¿ç”¨ RAII æ¥ç®¡ç†èµ„æºçš„ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸ª C++ å·¥å‚æ–¹æ³•çš„ç®€å•ç¤ºä¾‹ï¼Œä¸ºäº†é˜²æ­¢å‘ç”Ÿå¯¹è±¡åˆ‡ç‰‡çš„é”™è¯¯ï¼ˆ<strong>C++ çš„å€¼è¯­ä¹‰ç‰¹ç‚¹æ‰€å¸¦æ¥çš„çš„ç¼–ç é™·é˜±ï¼šå‡½æ•°è¿”å›ç±»å‹ä¸ºçˆ¶ç±»å¯¹è±¡ï¼Œå®é™…è¿”å›çš„ä¸ºå­ç±»å¯¹è±¡</strong>ï¼‰ï¼Œå·¥å‚æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªçˆ¶ç±»å¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…æ˜¯å¼•ç”¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// C++11 åå»ºè®®ä½¿ç”¨å¼ºç±»å‹æšä¸¾</span></span><br><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">animalType</span> &#123;</span></span><br><span class="line">    cat,</span><br><span class="line">    dog,</span><br><span class="line">    fox,</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span> &#123;</span>...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cat</span> :</span> <span class="keyword">public</span> animal &#123;...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span> :</span> <span class="keyword">public</span> animal &#123;...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fox</span> :</span> <span class="keyword">public</span> animal &#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">animal* <span class="title">buyNewAnimal</span><span class="params">(animalType ani_type)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(ani_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> animalType::cat :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> cat();</span><br><span class="line">        <span class="keyword">case</span> animalType::dog :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> dog();</span><br><span class="line">        <span class="keyword">case</span> animalType::fox :</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> fox();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶è¿”å›çš„æ˜¯ä¸€ä¸ª <code>animal</code> ç±»å‹çš„çˆ¶ç±»æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å­ç±»å¯¹è±¡ï¼Œé—®é¢˜æ¥äº†ï¼Œ<code>buyNewAnimal</code> å‡½æ•°è¿”å› <code>animal</code> æŒ‡é’ˆåä¾¿é€€å‡ºäº†ï¼Œå †ä¸Šå·²ç»å¼€è¾Ÿå‡ºç©ºé—´ <code>animal</code> å­ç±»çš„å¯¹åº”ç©ºé—´ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯è¿™ä¸€éƒ¨åˆ†å†…å­˜ä¸æ³„æ¼ï¼Ÿ</p>
<h2 id="æ™ºèƒ½æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ">æ™ºèƒ½æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ</h2>
<p>C å’Œ C++ çš„è€ç¨‹åºå‘˜éƒ½æ›¾å¤§é‡æ¥è§¦è¿‡è£¸æŒ‡é’ˆï¼Œéƒ½æ›¾ä¸€è¾¹äº«å—ç€æŒ‡é’ˆå¸¦æ¥çš„ä¾¿åˆ©ä¸€è¾¹ä¸åœåœ°ç»™è‡ªå·±æŒ–å‘åŸ‹å‘ï¼Œåœ¨ä»‹ç»æ™ºèƒ½æŒ‡é’ˆä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ä½¿ç”¨æŒ‡é’ˆçš„æ—¶å€™å¸¸è§çš„å‘æœ‰å“ªäº›ï¼š</p>
<ul>
<li>
<p>å¿˜è®° <code>delete/free</code> å¯¼è‡´å†…å­˜æ³„éœ²</p>
</li>
<li>
<p>åŒä¸€ä¸ªæŒ‡é’ˆé‡Šæ”¾å¤šæ¬¡ï¼Œç¨‹åºå´©æºƒ</p>
</li>
<li>
<p>é€»è¾‘ bugï¼Œå†™äº† <code>delete/free</code> ç»“æœæ²¡æœ‰æ‰§è¡Œåˆ°</p>
</li>
<li>
<p><code>delete/free</code> ä¹‹å‰æŠ›å‡ºäº†å¼‚å¸¸</p>
</li>
</ul>
<p>å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼ŒC++ æ²¡æœ‰è‡ªåŠ¨å†…å­˜å›æ”¶æœºåˆ¶ï¼Œ<code>new</code> å‡ºæ¥çš„å¿…é¡»è¦è‡ªå·± <code>delete</code> æ‰ï¼Œæ™ºèƒ½æŒ‡é’ˆçš„å¼•å…¥ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥ä¸å†å…³æ³¨èµ„æºçš„é‡Šæ”¾ï¼Œå®ƒèƒ½å¤Ÿä¿è¯ç¨‹åºæ— è®ºæ­£å¸¸æˆ–å¼‚å¸¸ï¼Œåœ¨åˆ°æœŸçš„æ—¶å€™éƒ½èƒ½é€šè¿‡ RAII æœºåˆ¶æˆåŠŸå›æ”¶ã€‚</p>
<p>æ¥çœ‹ä¸Šä¸€èŠ‚ä¸­ <code>buyNewAnimal</code> å‡½æ•°è¿”å›çš„ <code>animal</code> æŒ‡é’ˆï¼Œ<strong>åªéœ€è¦å°†è¿™ä¸ªè¿”å›å€¼æ”¾å…¥ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œç¡®ä¿è¿™ä¸ªå˜é‡ææ„çš„æ—¶å€™ä¼šåˆ é™¤ä¸Šé¢çš„å¯¹è±¡</strong>å³å¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smartAnimalPtr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smartAnimalPtr</span><span class="params">(animal* animalPtr)</span> : <span class="title">animalPtr_</span><span class="params">(animalPtr)</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">// delete nullptr is legal operation</span></span><br><span class="line">    ~smartAnimalPtr()&#123;</span><br><span class="line">        <span class="keyword">delete</span> animalPtr_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">animal* <span class="title">getPtr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> animalPtr_;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    animal* animalPtr_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">smartAnimalPtr <span class="title">newAnimalPtr</span><span class="params">(buyNewAnimal(dog))</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>func</code> è°ƒç”¨çš„ <code>buyNewAnimal</code> å‡½æ•°è¿”å›å€¼è¢« <code>newAnimalPtr</code> æ¥ç®¡ï¼Œä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ <code>newAnimalPtr.getPtr()</code> ä½¿ç”¨åŸæŒ‡é’ˆï¼Œå½“ <code>func</code> å‡½æ•°ç»“æŸæ—¶ï¼Œ<code>newAnimalPtr</code> ææ„ï¼Œ<code>animalPtr_</code> æ‰€æŒ‡å‘çš„åŒºåŸŸè¢«é‡Šæ”¾ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ <code>delete</code>ï¼Œè€Œæ˜¯é€šè¿‡ RAII å·§å¦™åœ°äº¤ç»™ç¼–è¯‘å™¨å¤„ç†äº†ã€‚</p>
<p>é™¤äº† <code>delete</code> ä¹‹å¤–ï¼Œåœ¨æœ¬åœ°å˜é‡çš„ææ„å‡½æ•°ä¸­è¿˜å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>é‡Šæ”¾åŒæ­¥é”ï¼Œå¦‚ä¸‹é¢çš„å¤šçº¿ç¨‹ç´¯åŠ èŒƒä¾‹ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">std</span>::mutex sum_lock;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span>&amp; sum, <span class="keyword">int</span>&amp; num)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="comment">// ç»“æŸä¸€è½® while å sum_lock è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">        <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lock</span><span class="params">(sum_lock)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">100</span>) &#123;</span><br><span class="line">            num += <span class="number">1</span>;</span><br><span class="line">            sum += num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; tdVec;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)&#123;</span><br><span class="line">        <span class="built_in">std</span>::thread td = <span class="built_in">std</span>::thread(add, <span class="built_in">std</span>::ref(sum), <span class="built_in">std</span>::ref(num));</span><br><span class="line">        tdVec.emplace_back(<span class="built_in">std</span>::<span class="built_in">move</span>(td));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// std::mem_fn can generate an object for pointers to members as well as ref and pointers to an object</span></span><br><span class="line">    <span class="built_in">std</span>::for_each(tdVec.<span class="built_in">begin</span>(), tdVec.<span class="built_in">end</span>(), <span class="built_in">std</span>::mem_fn(&amp;<span class="built_in">std</span>::thread::join));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; sum &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å…³é—­æ–‡ä»¶ï¼Œå¦‚ <code>fstream</code> ææ„æ—¶ä¼šè°ƒç”¨ <code>close</code> ä»¥é˜²æ­¢æµå¯¹è±¡é”€æ¯åè¿˜ä¸æ‰“å¼€çš„æ–‡ä»¶ç›¸å…³è”</li>
</ul>
<p>ä¸Šé¢å®ç°çš„ <code>smartAnimalPtr</code> å·²ç»å¯ä»¥ç®—æ˜¯ä¸€ä¸ªç®€å•çš„æ™ºèƒ½æŒ‡é’ˆå•¦ã€‚</p>
<h2 id="auto-ptr">auto_ptr</h2>
<p>æˆ‘ä»¬å°† <code>smartAnimalPtr</code> æ¨¡æ¿åŒ–ï¼Œå¹¶æ·»åŠ ä¸€äº›å¸¸ç”¨çš„æŒ‡é’ˆæ“ä½œï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smartAutoPtr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smartAutoPtr</span><span class="params">(T* ptr)</span> : <span class="title">ptr_</span><span class="params">(ptr)</span> </span>&#123;&#125;</span><br><span class="line">    ~smartAutoPtr() &#123; <span class="keyword">delete</span> ptr_; &#125;</span><br><span class="line">    <span class="function">T* <span class="title">getPtr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123; <span class="keyword">return</span> *ptr_; &#125;</span><br><span class="line">    <span class="comment">// é‡è½½ bool è½¬æ¢è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* ptr_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå½“ <code>smartAutoPtr</code> æ‹·è´æ„é€ æˆ–è€…è¢«èµ‹å€¼æ—¶ï¼Œ<strong>å› ä¸ºæœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ç‰‡åŒºåŸŸï¼ŒRAII ä¼šè®©è¿™ç‰‡åŒºåŸŸé‡Šæ”¾ä¸¤æ¬¡</strong>ï¼è§£å†³è¿™ä¸ªé—®é¢˜çš„ç¬¬ä¸€ç§æ–¹æ³•ã€ä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ³•æ˜¯ç¦ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">smartAutoPtr(<span class="keyword">const</span> smartAutoPtr&lt;T&gt;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">smartAutoPtr&lt;T&gt;&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> smartAutoPtr&lt;T&gt;&amp;) = <span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‹·è´æ„é€ å’Œèµ‹å€¼æ—¶è½¬ç§»æŒ‡é’ˆçš„æ‰€æœ‰æƒï¼Œè€Œè¿™ä¹Ÿæ­£æ˜¯ <code>auto_ptr</code> çš„å¤„ç†æ–¹å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smartAutoPtr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smartAutoPtr</span><span class="params">(T* ptr)</span> : <span class="title">ptr_</span><span class="params">(ptr)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    smartAutoPtr(<span class="keyword">const</span> smartAutoPtr&amp; _Right) &#123;</span><br><span class="line">        ptr_ = _Right.<span class="built_in">release</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy and swap</span></span><br><span class="line">    <span class="comment">// _Right --&gt; smartAutoPtr(_Right) --&gt; _New</span></span><br><span class="line">    smartAutoPtr&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> smartAutoPtr&amp; _Right) &#123;</span><br><span class="line">        smartAutoPtr(_Right).reset(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~smartAutoPtr() &#123; <span class="keyword">delete</span> ptr_; &#125;</span><br><span class="line">    <span class="function">T* <span class="title">getPtr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123; <span class="keyword">return</span> *ptr_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰¥å¤ºåŸ smartAutoPtr å¯¹æŒ‡é’ˆçš„æ‰€æœ‰æƒç»™æ–° smartAutoPtr</span></span><br><span class="line">    <span class="function">T* <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T* _Tmp = ptr_;</span><br><span class="line">        ptr_ = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> _Tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(smartAutoPtr&amp; _New)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">        swap(ptr_, _New.ptr_);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* ptr_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>èµ‹å€¼è¿ç®—ç¬¦çš„é‡è½½åˆ©ç”¨äº† <em>copy and swap</em> æŠ€æœ¯ï¼Œå³å…ˆé€šè¿‡æ‹·è´æ„é€ åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå†äº¤æ¢å®ƒä»¬çš„æŒ‡é’ˆï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯å¼ºå®‰å…¨æ€§ï¼Œæ„é€ æ˜¯å¦æˆåŠŸå®Œå…¨ä¸ä¼šç ´åèµ‹å€¼è¿ç®—ç¬¦ä¸¤è¾¹çš„æ•°æ®ã€‚</p>
<p>ç”±ä¸Šé¢çš„ä»£ç ä¸éš¾çœ‹å‡ºï¼Œ<code>auto_ptr</code> åœ¨æ‹·è´æ„é€ å’Œèµ‹å€¼è¿ç®—æ—¶éƒ½ä¼šå®Œå…¨å‰¥å¤ºåŸå¯¹è±¡å¯¹æŒ‡é’ˆçš„æ‰€æœ‰æƒï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†æœ€åä¸€ä¸ª <code>auto_ptr</code>ï¼Œå…¶ä½™æ‰€æœ‰çš„ <code>auto_ptr</code> éƒ½å˜æˆäº† <code>nullptr</code>ï¼Œå…¨éƒ¨å¤±æ•ˆäº†ï¼Œè¿™æ ·ä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>STL å¯¹å®¹å™¨ç±»å‹çš„è¦æ±‚æ˜¯è¦æœ‰å€¼è¯­ä¹‰ï¼Œå³å¯ä»¥å¤åˆ¶å’Œèµ‹å€¼</strong>ã€‚<code>auto_ptr</code> çš„å¤åˆ¶å’Œèµ‹å€¼ç»è¿‡äº† <code>release</code> å’Œ <code>reset</code> çš„å¤„ç†ï¼Œ<strong>å› æ­¤ <code>auto_ptr</code> å¯¹è±¡ä¸èƒ½ä½œä¸º STL çš„å®¹å™¨å…ƒç´ </strong>ã€‚</p>
</li>
<li>
<p>å°† <code>auto_ptr</code> ä½œä¸ºå‡½æ•°å‚æ•°æŒ‰å€¼ä¼ é€’æ—¶ï¼Œå‡½æ•°ä¼šåœ¨å…¶ä½œç”¨åŸŸä¸­ç”Ÿæˆè¯¥ <code>auto_ptr</code> çš„æ‹·è´ï¼Œæ­¤æ—¶çš„æŒ‡é’ˆæ‰€æœ‰æƒå·²ç»è½¬ç§»ç»™äº†è¿™ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå½“å‡½æ•°é€€å‡ºæ—¶ï¼Œè¯¥ä¸´æ—¶å¯¹è±¡ææ„ï¼ŒåŸ <code>auto_ptr</code> æ‰€æŒ‡å‘çš„å¯¹è±¡ä¹Ÿè¢«åˆ é™¤äº†ï¼Œ<strong>å¦‚æœä¸å¾—ä¸ä½¿ç”¨ <code>auto_ptr</code> ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ <code>const auto_ptr&amp;</code> çš„æ–¹å¼</strong>ã€‚</p>
</li>
</ul>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>auto_ptr</code> å·²ç»ä» C++17 æ ‡å‡†ä¸­åˆ é™¤äº†ã€‚</p>
<h2 id="unique-ptr">unique_ptr</h2>
<p><code>unique_ptr</code> ä¸ <code>auto_ptr</code> åœ¨ç‰¹æ€§ä¸Šç›¸å·®ä¸å¤§ï¼Œ<strong>åŒä¸€æ—¶åˆ»åªèƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª <code>unique_ptr</code> æŒ‡å‘ç»™å®šçš„å¯¹è±¡</strong>ï¼Œ<code>unique_ptr</code> åœ¨å¤„ç†æ™ºèƒ½æŒ‡é’ˆæ‹·è´æ„é€ å’Œèµ‹å€¼æ—¶å‘ç”Ÿçš„æµ…æ‹·è´é—®é¢˜ä¸Šé‡‡ç”¨äº† <code>smartAutoPtr</code> æ‰€ä½¿ç”¨çš„æ–¹æ³•ä¸€ï¼Œå³ç›´æ¥å°†æ‹·è´æ„é€ å’Œèµ‹å€¼è¿ç®—ç¦ç”¨ï¼Œæ­¤å¤–ï¼Œ<code>unique_ptr</code> è¿˜å¼•å…¥äº†ç§»åŠ¨æ„é€ ï¼Œåœ¨ C<ins>11 ä¹‹å‰ï¼Œå¦‚æœæƒ³è¦å°†æºå¯¹è±¡çš„çŠ¶æ€è½¬ç§»åˆ°ç›®æ ‡å¯¹è±¡åªèƒ½é€šè¿‡æ‹·è´æ„é€ ï¼ŒC</ins>11 å¼€å§‹ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å¤åˆ¶å¯¹è±¡ï¼Œåªéœ€è¦ç§»åŠ¨å¯¹è±¡å³å¯ï¼Œä¹Ÿå°±æ˜¯æŠŠæºå¯¹è±¡çš„èµ„æºæ§åˆ¶æƒè½¬äº¤ç»™ç›®æ ‡å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸å†éœ€è¦å¤šä½™çš„å¤åˆ¶æ“ä½œã€‚æˆ‘ä»¬å°†ä¸Šé¢çš„ <code>auto_ptr</code> ç¨å¾®ä¿®æ”¹å¯ä»¥å¾—åˆ°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ <code>unique_ptr</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smartUniquePtr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smartUniquePtr</span><span class="params">(T* ptr)</span> : <span class="title">ptr_</span><span class="params">(ptr)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šåœ¨ç±»ä¸­é»˜è®¤ç”Ÿæˆ</span></span><br><span class="line">    smartUniquePtr(smartUniquePtr&amp;&amp; _Right) &#123;</span><br><span class="line">        ptr_ = _Right.<span class="built_in">release</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç±»å‹è½¬æ¢ç§»åŠ¨æ„é€ </span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smartUniquePtr(smartUniquePtr&lt;U&gt;&amp;&amp; _Right) &#123;</span><br><span class="line">        ptr_ = _Right.<span class="built_in">release</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// necessary</span></span><br><span class="line">    smartUniquePtr(<span class="keyword">const</span> smartUniquePtr&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smartUniquePtr(<span class="keyword">const</span> smartUniquePtr&lt;U&gt;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// new _Right --&gt; *this</span></span><br><span class="line">    smartUniquePtr&amp; <span class="keyword">operator</span>=(smartUniquePtr _Right) &#123;</span><br><span class="line">        _Right.reset(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~smartUniquePtr() &#123; <span class="keyword">delete</span> ptr_; &#125;</span><br><span class="line">    <span class="function">T* <span class="title">getPtr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123; <span class="keyword">return</span> *ptr_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T* <span class="title">release</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T* _Tmp = ptr_;</span><br><span class="line">        ptr_ = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> _Tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(smartUniquePtr&amp; _New)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">        swap(ptr_, _New.ptr_);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* ptr_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç éœ€è¦æ³¨æ„ï¼Œ<strong>åœ¨å®šä¹‰äº†ç§»åŠ¨æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æä¾›æ‹·è´æ„é€ å‡½æ•°ï¼Œä¼šè‡ªåŠ¨ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°</strong>ã€‚<br>
ä½†æ˜¯ï¼Œ<strong>ç¼–è¯‘å™¨å¹¶ä¸ä¼šæŠŠ <code>smartUniquePtr(smartUniquePtr&lt;U&gt;&amp;&amp; _Right) {}</code> çœ‹ä½œæ˜¯ç§»åŠ¨æ„é€ ï¼Œæ¢å¥è¯è¯´ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠŠæ‰€æœ‰çš„æ¨¡æ¿å‡½æ•°çœ‹ä½œæ„é€ å‡½æ•°</strong>ï¼Œå¦‚æœæƒ³æ¶ˆé™¤ä»£ç é‡å¤ï¼Œä»ç„¶éœ€è¦å°†æ‹·è´æ„é€ å‡½æ•°æ‰‹åŠ¨ç¦ç”¨ã€‚<br>
å†çœ‹ <code>smartUniquePtr</code> çš„ä½¿ç”¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// buyNewAnimal è¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">smartUniquePtr&lt;animal&gt; ptr1&#123; buyNewAnimal(animalType::dog) &#125;;</span><br><span class="line">smartUniquePtr&lt;animal&gt; ptr2&#123; <span class="literal">nullptr</span> &#125;;</span><br><span class="line"><span class="comment">// ptr1 æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œéœ€è¦è½¬æ¢æˆå³å€¼</span></span><br><span class="line"><span class="comment">// ptr1 --&gt; temp rv obj --&gt; ptr3</span></span><br><span class="line">smartUniquePtr&lt;animal&gt; ptr3 = <span class="built_in">std</span>::<span class="built_in">move</span>(ptr1);</span><br><span class="line">smartUniquePtr&lt;animal&gt; ptr4&#123; <span class="built_in">std</span>::<span class="built_in">move</span>(ptr3) &#125;;</span><br></pre></td></tr></table></figure>
<p><code>unique_ptr</code> é™¤äº†èƒ½å¤Ÿæ”¯æŒç®¡ç†å †ä¸Šåˆ†é…çš„å†…å­˜ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡ç§»åŠ¨è¯­ä¹‰ä½¿ <code>unique_ptr</code> å¯¹è±¡ä¸å®¹å™¨å…¼å®¹ã€‚<br>
ä½† <code>unique_ptr</code> ä»ç„¶æœ‰ä¸€äº›ä¸è¶³ï¼Œå®ƒä»ç„¶æ— æ³•é¿å…é‡å¤é‡Šæ”¾çš„é—®é¢˜ï¼Œä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ä¹‹åçš„æºå¯¹è±¡ä¹Ÿä»ç„¶å¤±å»äº†å¯¹åŸæŒ‡é’ˆçš„æ‰€æœ‰æƒï¼Œæ— æ³•å†æ¬¡ä½¿ç”¨ã€‚<br>
è¦é¿å…ä¸Šè¿°è¿™äº›æƒ…å†µï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨å¸¦æœ‰å¼•ç”¨è®¡æ•°åŠŸèƒ½çš„æ™ºèƒ½æŒ‡é’ˆã€‚</p>
<h2 id="shared-ptr">shared_ptr</h2>
<p>åœ¨ <code>unique_ptr</code> ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½è¢«ä¸€ä¸ª <code>unique_ptr</code> æ‹¥æœ‰ï¼Œè¿™åœ¨å¤§éƒ¨åˆ†åœºåˆæ˜¯æ— æ³•æ»¡è¶³è¦æ±‚çš„ï¼Œæ›´å¸¸è§çš„æ˜¯å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆåŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æŒ‡é’ˆéƒ½å¤±æ•ˆäº†ï¼Œæ‰ä¼šåˆ é™¤è¯¥å¯¹è±¡ï¼Œè¿™æ ·çš„æ™ºèƒ½æŒ‡é’ˆå°±æ˜¯ <code>shared_ptr</code>ã€‚<br>
<code>shared_ptr</code> çš„åº•å±‚é€šè¿‡å¼•ç”¨è®¡æ•°æ¥è¿›è¡Œç©ºé—´ç®¡ç†ï¼Œæ¯å½“æœ‰ä¸€ä¸ªæ–°çš„æŒ‡é’ˆæŒ‡å‘è¿™å—ç©ºé—´æ—¶ï¼Œå¼•ç”¨è®¡æ•°åŠ ä¸€ï¼Œåä¹‹å‡ä¸€ï¼Œç›´åˆ°å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶æ‰é‡Šæ”¾ç©ºé—´ã€‚<br>
æ¥çœ‹ä¸€ä¸‹ <code>shared_ptr</code> çš„ç®€å•å®ç°ï¼Œå’Œ <code>unique_ptr</code> çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒéœ€è¦å®ç°å…±äº«çš„å¼•ç”¨è®¡æ•°ï¼Œå› æ­¤æˆ‘ä»¬<strong>åœ¨å †ä¸Š <code>new</code> ä¸€ä¸ª <code>ref_count</code> å‡ºæ¥ï¼Œå¹¶åœ¨ <code>shared_ptr</code> ä¸­ä¿å­˜æŒ‡å‘å®ƒçš„æŒ‡é’ˆ</strong>ï¼Œå®Œæ•´çš„æ“ä½œéœ€è¦åŒ…å« <code>add</code>ã€<code>reduce</code> å’Œ <code>get</code> ä¸‰ç§è¡Œä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ref_count</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ref_count() <span class="keyword">noexcept</span> : cnt_(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; ++cnt_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">reduce</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> --cnt_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">get</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> cnt_; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">long</span> cnt_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smartSharedPtr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">smartSharedPtr</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smartSharedPtr</span><span class="params">(T* ptr = <span class="literal">nullptr</span>)</span> : <span class="title">ptr_</span><span class="params">(ptr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">            refptr_ = <span class="keyword">new</span> ref_count();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy constructor ref_count add</span></span><br><span class="line">    smartSharedPtr(<span class="keyword">const</span> smartShared&amp; _Right) &#123;</span><br><span class="line">        ptr_ = _Right.ptr_;</span><br><span class="line">        <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">            _Right.refptr_-&gt;add();</span><br><span class="line">            refptr_ = _Right.refptr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// template copy constructor</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smartSharedPtr(<span class="keyword">const</span> smartSharedPtr&lt;U&gt;&amp; _Right) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        ptr_ = _Right.ptr_;</span><br><span class="line">        <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">            _Right.refptr_-&gt;add();</span><br><span class="line">            refptr_ = _Right.refptr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// template move constructor</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smartSharedPtr(smartSharedPtr&lt;U&gt;&amp;&amp; _Right) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        ptr_ = _Right.ptr_;</span><br><span class="line">        <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">            refptr_ = _Right.refptr_;</span><br><span class="line">            _Right.ptr_ = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overload assignment operator</span></span><br><span class="line">    smartSharedPtr&amp; <span class="keyword">operator</span>=(smartSharedPtr _Right) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        _Right.swap(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~smartSharedPtr() &#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡ææ„æ—¶éƒ½éœ€è¦å°† ref_count å‡ä¸€</span></span><br><span class="line">        <span class="keyword">if</span> (ptr_ &amp;&amp; !refptr_-&gt;reduce()) &#123;</span><br><span class="line">            <span class="keyword">delete</span> ptr_;</span><br><span class="line">            <span class="keyword">delete</span> ref_count_;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get ref_count</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getRefCnt</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">            <span class="keyword">return</span> refptr_-&gt;<span class="built_in">get</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T* <span class="title">getptr</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> <span class="keyword">noexcept</span> &#123; <span class="keyword">return</span> *ptr_; &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> <span class="keyword">noexcept</span> &#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smartSharedPtr&amp; _New)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">        swap(ptr_, _New.ptr_);</span><br><span class="line">        swap(refptr_, _New.refptr_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* ptr_;</span><br><span class="line">    ref_count* refptr_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smartSharedPtr&lt;T&gt;&amp; _Left, smartSharedPtr&lt;T&gt;&amp; _Right)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    _Left.swap(_Right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>
<p>ä¸ºäº†è®©ç¼–è¯‘å™¨ä¼˜åŒ–ä»£ç ï¼Œéœ€è¦ä¸ºç§»åŠ¨æ„é€ å‡½æ•°æ·»åŠ  <code>noexcept</code> å£°æ˜</p>
</li>
<li>
<p><code>refptr_</code> ä¸ºæ¯ä¸ªç±»çš„ç§æœ‰æˆå‘˜ï¼Œæ˜¯ä¸èƒ½åœ¨ <code>smartSharedPtr</code> å¯¹è±¡ä¹‹é—´å…±äº«çš„ï¼Œéœ€è¦æ·»åŠ å‹å…ƒç±»çš„å£°æ˜</p>
</li>
<li>
<p>æŒ‰ç…§ç°ä»£ C++ æ ‡å‡†éœ€è¦è®¾è®¡æ”¯æŒç§»åŠ¨çš„å¯¹è±¡ï¼Œå³å¯¹è±¡ä¸ä»…è¦æœ‰ <code>swap</code> æˆå‘˜å‡½æ•°ä¸å¦ä¸€ä¸ªå¯¹è±¡äº¤æ¢ï¼Œåœ¨å…¶æ‰€å±åç©ºé—´ä¸‹è¿˜éœ€è¦éœ€è¦æœ‰ä¸€ä¸ªå…¨å±€ <code>swap</code> å‡½æ•°æä¾›ç»™å…¶ä»–å¯¹è±¡ä½¿ç”¨</p>
</li>
<li>
<p>æ™ºèƒ½æŒ‡é’ˆè¿˜éœ€è¦å®ç°ç±»å‹è½¬æ¢çš„å‡½æ•°æ¨¡æ¿ï¼Œè¿™é‡Œç»™å‡º <code>dynamic_cast</code>ï¼Œå…¶ä»–å®ç°ä¸æ­¤ç±»ä¼¼ï¼š</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for pointer type conversion</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">smartSharedPtr(<span class="keyword">const</span> smartSharedPtr&lt;U&gt;&amp; _Right, T* ptr) &#123;</span><br><span class="line">    ptr_ = ptr;</span><br><span class="line">    <span class="keyword">if</span> (ptr_) &#123;</span><br><span class="line">        _Right.refptr_-&gt;add();</span><br><span class="line">        refptr_ = _Right.refptr_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–å‡º _Right çš„ ptr_ è½¬æ¢æˆ T ç±»å‹åå°† ref_count++ å¹¶åŒ…è£…è¿”å›</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function">smartSharedPtr&lt;T&gt; <span class="title">dynamic_pointer_cast</span><span class="params">(<span class="keyword">const</span> smartSharedPtr&lt;U&gt;&amp; _Right)</span> </span>&#123;</span><br><span class="line">    T* _Tmp = <span class="keyword">dynamic_cast</span>&lt;T*&gt;(_Right.getptr());</span><br><span class="line">    <span class="keyword">return</span> smartSharedPtr&lt;T&gt;(_Right, _Tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="weak-ptr">weak_ptr</h2>
<p><code>shared_ptr</code> é€šå¸¸è¢«ç§°ä¸ºå¼ºæ™ºèƒ½æŒ‡é’ˆï¼Œè€Œ <code>weak_ptr</code> è¢«ç§°ä¸ºå¼±æ™ºèƒ½æŒ‡é’ˆï¼Œä»‹ç» <code>weak_ptr</code> ä¹‹å‰å…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A () &#123;&#125;</span><br><span class="line">    ~A () &#123;&#125;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;B&gt; ptrb;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B () &#123;&#125;</span><br><span class="line">    ~B () &#123;&#125;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;A&gt; ptra;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ref_count of A is 1</span></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;A&gt; <span class="title">ptra</span><span class="params">(<span class="keyword">new</span> A())</span></span>;</span><br><span class="line">    <span class="comment">// ref_count of B is 1</span></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;B&gt; <span class="title">ptrb</span><span class="params">(<span class="keyword">new</span> B())</span></span>;</span><br><span class="line">    <span class="comment">// ref_count of B is 2</span></span><br><span class="line">    ptra-&gt;ptrb = ptrb;</span><br><span class="line">    <span class="comment">// ref_count of A is 2</span></span><br><span class="line">    ptrb-&gt;ptra = ptra;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ptra.use_count() &lt;&lt; ptrb.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>main</code> ç»“æŸæ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°åˆ†åˆ«å‡åˆ° 1ï¼Œå› ä¸ºä¸ç­‰äº 0ï¼Œä¸æ»¡è¶³å¯¹è±¡çš„ç©ºé—´é‡Šæ”¾æ¡ä»¶ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜æ³„éœ²ï¼Œè¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º <code>shared_ptr</code> çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå½“ç„¶æ˜¯é€šè¿‡ <code>weak_ptr</code>ï¼Œ<code>weak_ptr</code> å¯¹ <code>shared_ptr</code> ç®¡ç†çš„å¯¹è±¡å­˜åœ¨éæ‹¥æœ‰æ€§å¼•ç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œ<strong>å®ƒè¡¨è¾¾çš„æ˜¯ä¸€ç§ä¸´æ—¶æ‰€æœ‰æƒ - å¦‚æœæŸä¸ªå¯¹è±¡åªæœ‰å­˜åœ¨çš„æ—¶å€™æ‰éœ€è¦è¢«è®¿é—®ï¼Œè€Œä¸”éšæ—¶å¯èƒ½ä¼šè¢«åˆ é™¤å¯¼è‡´æŒ‡é’ˆå¤±æ•ˆæ—¶ï¼Œå°±ä½¿ç”¨ <code>weak_ptr</code> è·Ÿè¸ªè¯¥å¯¹è±¡</strong>ï¼Œå½“ <code>weak_ptr</code> éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œéœ€è¦å°†å…¶å‡çº§ä¸º <code>shared_ptr</code>ï¼Œå¦‚æœåŸ <code>shared_ptr</code> é”€æ¯ï¼Œè¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ™ä¼šå»¶é•¿åˆ°è¿™ä¸ªå‡çº§çš„ <code>shared_ptr</code> è¢«é”€æ¯ä¸ºæ­¢ã€‚</p>
<p><code>weak_ptr</code> çš„ç‰¹ç‚¹å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢å‡ ç‚¹ï¼š</p>
<ul>
<li>
<p><code>weak_ptr</code> ä¸­æ²¡æœ‰æä¾›ä¸€èˆ¬çš„æŒ‡é’ˆæ“ä½œï¼Œå¦‚æœè¦è®¿é—®èµ„æºå¿…é¡»é€šè¿‡ <code>lock</code> å°†å…¶å‡çº§ä¸º <code>shared_ptr</code></p>
</li>
<li>
<p><strong>å®šä¹‰å¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ <code>shared_ptr</code> ï¼Œå¼•ç”¨å¯¹è±¡çš„æ—¶å€™ä½¿ç”¨ <code>weak_ptr</code></strong></p>
</li>
<li>
<p><code>weak_ptr</code> ä¸ä¼šæ”¹å˜å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…çš„è§’è‰²</p>
</li>
</ul>
<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨ <code>weak_ptr</code> å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A () &#123;&#125;</span><br><span class="line">    ~A () &#123;&#125;</span><br><span class="line">    weak_ptr&lt;B&gt; ptrb;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    B () &#123;&#125;</span><br><span class="line">    ~B () &#123;&#125;</span><br><span class="line">    weak_ptr&lt;A&gt; ptra;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ref_count of A is 1</span></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;A&gt; <span class="title">ptra</span><span class="params">(<span class="keyword">new</span> A())</span></span>;</span><br><span class="line">    <span class="comment">// ref_count of B is 1</span></span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;B&gt; <span class="title">ptrb</span><span class="params">(<span class="keyword">new</span> B())</span></span>;</span><br><span class="line">    <span class="comment">// ref_count of B is 1</span></span><br><span class="line">    ptra-&gt;ptrb = ptrb;</span><br><span class="line">    <span class="comment">// ref_count of A is 1</span></span><br><span class="line">    ptrb-&gt;ptra = ptra;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ptra.use_count() &lt;&lt; ptrb.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨">æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨</h2>
<h3 id="Deleter">Deleter</h3>
<p><code>unique_ptr</code> çš„å£°æ˜ä¸ºï¼š<code>std::unique_ptr&lt;T, Deleter&gt;::unique_ptr</code><br>
å‰é¢å·²ç»è¯´è¿‡ï¼Œæ™ºèƒ½æŒ‡é’ˆåœ¨ææ„çš„æ—¶å€™é™¤äº† <code>delete</code> å †ä¸Šç©ºé—´ï¼Œè¿˜å¯ä»¥å…³é—­æ–‡ä»¶ã€é‡Šæ”¾åŒæ­¥é”ç­‰ï¼Œ<code>unique_ptr</code> å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰æŒ‡é’ˆé‡Šæ”¾èµ„æºçš„æ–¹å¼ï¼Œæ–¹æ³•æ˜¯<strong>ä¼ å…¥ä¸€ä¸ªå‡½æ•°å¯¹è±¡</strong>ï¼Œæˆ‘ä»¬ç”¨ <em>lambda</em> è¡¨è¾¾å¼æ¥ç®€å•å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::unique_ptr&lt;FILE, std::function&lt;void(FILE*)&gt;&gt; openFile(fopen("config.yml", "w"), [](FILE* fp)-&gt;void&#123; fclose(fp); &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>shared_ptr</code> çš„ <code>Deleter</code> çš„ä½¿ç”¨æ–¹æ³•ä¸ <code>unique_ptr</code> ç¨æœ‰ä¸åŒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span> &#123;</span></span><br><span class="line">    foo() &#123;&#125;</span><br><span class="line">    ~foo() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">deleter</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(func* fp)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> fp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;foo&gt; <span class="title">sp</span><span class="params">(<span class="keyword">new</span> foo, deleter())</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„æ™ºèƒ½æŒ‡é’ˆ">å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„æ™ºèƒ½æŒ‡é’ˆ</h3>
<p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p><code>shared_ptr/weak_ptr</code> çš„çº¿ç¨‹å®‰å…¨å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†è®¨è®ºï¼š</p>
<ul>
<li>
<p><code>shared_ptr/weak_ptr</code> ç®¡ç†çš„å¯¹è±¡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
</li>
<li>
<p><code>shared_ptr/weak_ptr</code> å¯¹è±¡æœ¬èº«æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
</li>
</ul>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ<code>shared_ptr/weak_ptr</code> èƒ½å¤Ÿå®ç°å¤šçº¿ç¨‹ä¸‹å…¶ç®¡ç†çš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹å·²ç»å°†å †ä¸Šçš„å¯¹è±¡ææ„äº†ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹å»è®¿é—®å·²ç»ææ„äº†çš„å¯¹è±¡ï¼Œäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚</p>
<p><em>muduo</em> ç½‘ç»œåº“ä¸­çš„ <em>Observable</em> ç±»ç»™å‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼šé€šè¿‡ <code>weak_ptr</code> æ¢æŸ¥å¯¹è±¡çš„ç”Ÿæ­»ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observable</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">register_</span><span class="params">(<span class="keyword">const</span> weak_ptr&lt;Observer&gt; x)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">mutable</span> MutexLock mutex_;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;weak_ptr&lt;Observer&gt;&gt; observers_;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;weak_ptr&lt;Observer&gt;&gt;::iterator Iterator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Observable::notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MutexLockGuard <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">    Iterator it = observers_.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="keyword">while</span> (it != observers_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        <span class="comment">// éå† vector ä¾æ¬¡å°è¯• promote weak_ptr</span></span><br><span class="line">        <span class="comment">// lock æ˜¯çº¿ç¨‹å®‰å…¨çš„</span></span><br><span class="line">        <span class="function"><span class="built_in">shared_ptr</span>&lt;Observer&gt; <span class="title">obj</span><span class="params">(it-&gt;lock())</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">            obj-&gt;update();</span><br><span class="line">            ++it;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// promote å¤±è´¥è¯´æ˜å¯¹è±¡å·²ç»é”€æ¯ï¼Œä» vector ä¸­åˆ é™¤ weak_ptr</span></span><br><span class="line">            it = observers_.erase(it);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œ<code>shared_ptr</code> æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°æ˜¯å®‰å…¨æ— é”çš„ï¼Œä½†æ˜¯å¯¹è±¡çš„è¯»å†™ä¸æ˜¯ï¼Œå› ä¸º <code>shared_ptr</code> æœ‰ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼Œè¯»å†™æ“ä½œä¸èƒ½åŸå­åŒ–ã€‚</p>
<p>å¦‚æœè¦é€šè¿‡å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ª <code>shared_ptr</code> å¯¹è±¡ï¼Œéœ€è¦åŠ é”ã€‚<br>
ç»§ç»­çœ‹ä¸€ä¸ª <em>muduo</em> ç½‘ç»œåº“ä¸­çš„ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">shared_ptr</span>&lt;foo&gt; localPtr;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">MutexLockGuard <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">        localPtr = globalPtr;</span><br><span class="line">    &#125;</span><br><span class="line">    doit(localPtr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">shared_ptr</span>&lt;foo&gt; <span class="title">newPtr</span><span class="params">(<span class="keyword">new</span> foo)</span></span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">MutexLockGuard <span class="title">lock</span><span class="params">(mutex)</span></span>;</span><br><span class="line">        globalPtr = newPtr;</span><br><span class="line">    &#125;</span><br><span class="line">    doit(newPtr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒæ–‡çŒ®ï¼š</p>
<p><a href="https://book.douban.com/subject/20471211/" target="_blank" rel="noopener">Linux å¤šçº¿ç¨‹æœåŠ¡ç«¯ç¼–ç¨‹</a><br>
<a href="https://book.douban.com/subject/25923597/" target="_blank" rel="noopener">Effective Modern C++</a><br>
<a href="https://en.cppreference.com/w/Main_Page" target="_blank" rel="noopener">cppreference</a></p>
]]></content>
      <categories>
        <category>C/C++</category>
      </categories>
      <tags>
        <tag>C/C++</tag>
        <tag>Smart-Pointer</tag>
        <tag>RAII</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ç®€å•çš„é€»è¾‘æ–¹æ³•è¿›è¡Œç‹¬ç«‹æ€è€ƒã€è½¬ã€‘</title>
    <url>/posts/8cfab1d1/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>å¯è€ƒè¯çš„æ•°æ®å¾ˆé‡è¦å¾ˆé‡è¦å¾ˆé‡è¦</li>
<li>ç†è§£é›†åˆçš„åŒ…å«ä¸è¢«åŒ…å«ï¼Œä»¥å°è§å¤§å¾€å¾€ä¸å…·æœ‰ç§‘å­¦æ€§ä¸¥è°¨æ€§</li>
<li>è°¨æ…é¢ å€’å› æœå…³ç³»çš„äº‹æƒ…ä¸æ··æ·†æ— å…³äº‹æƒ…ä¹‹é—´çš„å› æœå…³ç³»</li>
<li>åšäº‹è¦æ‰¾åˆ°é è°±çš„åŸºå‡†çº¿</li>
<li>æ€è€ƒè¦æ·±å…¥ï¼Œè¦é«˜ç»´</li>
</ul>
</blockquote>
<a id="more"></a>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ä¸–ç•Œï¼Œè¿™ä¸ªä¸–ç•Œä¸Šæœ‰å¾ˆå¤šå„å¼å„æ ·çš„è§‚ç‚¹å’Œæ€ç»´æ–¹å¼ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜çš„æˆ‘ï¼Œä¹Ÿä¼šæœ‰ç¨‹åºå‘˜çš„æ€ç»´æ–¹å¼ï¼Œç¨‹åºå‘˜çš„æ€ç»´æ–¹å¼æ›´æ¥è¿‘æ•°å­¦çš„æ€ç»´æ–¹å¼ï¼Œæ•°å­¦çš„æ€ç»´æ–¹å¼è®©å¯ä»¥å¾ˆå®¹æ˜“åœ°ç†æ¸…æ¥šè¿™ä¸ªæ··ä¹±çš„ä¸–ç•Œï¼Œå…¶å®ï¼Œå¹¶ä¸éœ€è¦å¤ªå¤æ‚çš„æ•°å­¦é€»è¾‘ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€äº›ç®€å•çš„æ•°å­¦æ–¹æ³•ï¼Œå°±å¯ä»¥å¤§å¹…æå‡è‡ªå·±çš„è®¤è¯†èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™é‡Œï¼Œè®°å½•ä¸€ç¯‡æˆ‘è‡ªå·±çš„æ€ç»´æ–¹å¼ï¼Œä¸€æ–¹é¢ç»™å¤§å®¶åšä¸ªå‚è€ƒï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¾›æ›´é«˜é˜¶çš„äººç»™æˆ‘è¿›è¡ŒæŒ‡æ­£ã€‚ç®—æ˜¯â€œå¼€æºæˆ‘çš„æ€ç»´æ–¹å¼â€ï¼Œå¼€æ”¾ä¸ä»…ä»…æ˜¯ä¸ºäº†è¾“å‡ºï¼Œæ›´æ˜¯ä¸ºäº†çœ‹çœ‹æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ã€‚</p>
<p>æˆ‘çš„æ€ç»´æ–¹å¼ä¸­ï¼Œä½¿ç”¨æ•°å­¦é€»è¾‘çš„æ–¹å¼è¿›è¡Œæ€è€ƒï¼Œé€šå¸¸æ¥è¯´ï¼Œæˆ‘ä¼šä½¿ç”¨äº”æ­¥æ€è€ƒçš„æ–¹å¼ï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šä¿¡æ¯æ•°æ®å¯è€ƒè¯</strong>ã€‚å¦‚æœä¸€ä¸ªè§‚ç‚¹æˆ–æ˜¯ä¸€ä¸ªè§è§£çš„æ•°æ®æ˜¯é”™è¯¯çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆåé¢çš„è§‚ç‚¹å…¨æ˜¯é”™çš„ï¼Œæ‰€ä»¥ï¼Œ<em><strong>é¦–è¦çš„æ˜¯è¦è¿›è¡Œæ•°æ®çš„æŸ¥è¯æˆ–è€ƒè¯</strong></em>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ç¯‡æ–‡ç« çš„ä½œè€…è¶³å¤Ÿä¸¥è°¨çš„è¯ï¼Œä»–çš„éœ€è¦ç»™ä»–çš„æ•°æ®å»ºç«‹ç›¸å…³çš„å¼•ç”¨æˆ–æ˜¯å¯ä»¥è€ƒè¯çš„æ–¹æ³•æ–¹å¼ã€‚å¦‚æœä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„æ˜¯ï¼Œâ€œæœ‰å…³ä¸“å®¶è¡¨æ˜â€ã€â€œç¾å›½ç§‘å­¦å®¶è¯æ˜â€ã€â€œç»æµå­¦å®¶æŒ‡å‡ºâ€ï¼Œä½†æ˜¯æ²¡æœ‰ä»»å‡ºå¤„ï¼Œä¹Ÿæ²¡æœ‰ç‚¹æ˜è¿™ä¸ªä¸“å®¶æˆ–æ˜¯ç§‘å­¦å®¶çš„åå­—ï¼Œæˆ–æ˜¯ï¼Œä¹Ÿæ²¡æœ‰è¯´æ˜æˆ–å¼•ç”¨è®©è¯»è€…å¯ä»¥è‡ªå·±å»éªŒè¯çš„æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œå…¶å¼•ç”¨çš„è¯æˆ–æ˜¯æ•°æ®æ˜¯æ— æ³•è€ƒè¯çš„ï¼Œå¦‚æœæ˜¯æ— æ³•è€ƒè¯çš„ï¼Œé‚£ä¹ˆï¼Œè¿™ç¯‡æ–‡ç« çš„æ°´ä»½å°±éå¸¸å¤§äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“æˆ‘è¯»åˆ°ä¸€ç¯‡æ–‡ç« ä¸­çš„ä¸œè¥¿æ²¡æœ‰å¯è€ƒè¯çš„æ¥æºæˆ–æ˜¯æ–¹æ³•æ—¶ï¼Œé€šå¸¸æ¥è¯´ï¼Œæˆ‘å°±ä¸ä¼šå†è¯»äº†ï¼Œå› ä¸ºè¿™ç¯‡æ–‡ç« çš„ä»·å€¼å·²ç»ä¸å¤§äº†ï¼Œå¦‚æœæˆ‘å…³å¿ƒè¿™ç¯‡æ–‡ç« ä¸­çš„ä¸œè¥¿ï¼Œæˆ‘ä¼šæ”¹ä¸ºè‡ªå·±å»æŸ¥æ‰¾çš„æ–¹å¼ï¼Œè™½ç„¶å˜â€œé‡â€äº†ï¼Œä½†æ˜¯å¾ˆå®‰å…¨ã€‚ï¼ˆæ‰€ä»¥ï¼Œåƒ Wikipedia è¿™æ ·çš„ç½‘ç«™æ˜¯æˆ‘ç»å¸¸å»è·å¾—ä¿¡æ¯çš„åœ°æ–¹ï¼Œå› ä¸ºä¿¡æ¯å¯ä»¥è¢«è€ƒè¯æ˜¯å…¶åŸºæœ¬ä»·å€¼è§‚ï¼‰</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šå¤„ç†é›†åˆå’Œå…¶åŒ…å«å…³ç³»</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„äººäººéƒ½ä¼šçš„æ•°å­¦é€»è¾‘ã€‚æ¯”å¦‚ï¼šå“²å­¦å®¶æ˜¯äººï¼ŒæŸæ‹‰å›¾æ˜¯å“²å­¦å®¶ï¼Œæ‰€ä»¥ï¼ŒæŸæ‹‰å›¾æ˜¯äººã€‚å°±æ˜¯ä¸€ä¸ªåœ¨åŒ…å«å…³ç³»ä¸‹çš„æ¨ç†ã€‚ä½ ä¸è¦å°çœ‹è¿™ä¸ªç®€å•çš„é€»è¾‘ï¼Œå…¶å®å¾ˆå¤šäººå¹¶ä¸ä¼šå¾ˆå¥½çš„åº”ç”¨ï¼Œç›¸åï¼Œ<em><strong>å½“æ„Ÿæƒ…æ”¯é…äº†ä»–ä»¬ä»¥åï¼Œä»–ä»¬ä¼šä»¥ç‚¹ä»£é¢ï¼Œä»¥ç‰¹ä¾‹ä»£æ›¿æ™®éæ€§</strong></em>ã€‚æ¯”å¦‚ï¼Œåœ°å›¾ç‚®å°±æ˜¯ä¸€ç§ï¼Œä»–ä»¬çœ‹åˆ°äº†å¤šä¸ªæ¡ˆä¾‹ï¼Œä»–ä»¬å°±å¼€å§‹æŠŠè¿™ä¸ªæ¡ˆä¾‹ä¸Šå‡ä¸Šæ›´å¤§çš„èŒƒå›´ï¼Œæ¯”å¦‚ï¼šæ²³å—äººæ–°ç–†äººéƒ½æ˜¯å°å·ï¼Œä¸Šæµ·äººéƒ½æ˜¯å°å¸‚æ°‘ã€‚æ—¥æœ¬äººéƒ½æ˜¯å˜æ€å’Œåäººç±»â€¦â€¦ç­‰ç­‰ã€‚é™¤äº†è¿™äº›åœ°å›¾ç‚®å¤–ï¼Œè¿˜æœ‰å¦å®šæ•´ä¸ªäººçš„ï¼Œæ¯”å¦‚ä¸€ä¸ªäººçŠ¯äº†ä¸ªé”™æˆ–æ˜¯æ€§æ ¼ä¸Šæœ‰ç¼ºé™·ï¼Œå°±ä¼šæŠŠæ•´ä¸ªäººå…¨ç›˜å¦å®šæ‰ï¼Œå‘˜å·¥æŠ¢ä¸ªæœˆé¥¼å°±ä¸Šå‡åˆ°å…¶ä»·å€¼è§‚æœ‰é—®é¢˜â€¦â€¦ã€‚åœ¨æ•°å­¦çš„é€»è¾‘åŒ…å«ä¸­ï¼Œ<em><strong>è¶…é›†çš„å®šä¹‰å¯ä»¥é€‚ç”¨äºå­é›†ï¼Œé€šè¿‡å­é›†çš„ç‰¹å¾å¯ä»¥å¯¹è¶…é›†è¿›è¡Œæ¢ç´¢ï¼Œä½†æ˜¯æ²¡æ³•å®šä¹‰è¶…é›†</strong></em>ã€‚å¦å¤–ï¼Œé›†åˆçš„å¤§å°ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹ï¼Œå¹¸å­˜è€…åå·®ä¼šæ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è®©äººæ‰ä¸‹å»çš„é™·é˜±ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„æ ·æœ¬é›†å¯èƒ½åœ¨ä½ çš„è§†çº¿ç›²åŒºã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šå¤„ç†é€»è¾‘å› æœå…³ç³»</strong>ã€‚æ‰€è°“å› æœå…³ç³»ï¼Œå…¶å®å°±æ˜¯åˆ†è¾¨å……åˆ†æ¡ä»¶ã€å¿…è¦æ¡ä»¶å’Œå……åˆ†å¿…è¦æ¡ä»¶ï¼Œç„¶åå¤„ç†å…¶ä¸­çš„é€»è¾‘æ˜¯å¦æœ‰å…³è”æ€§ï¼Œè€Œä¸”æœ‰éå¸¸å¼ºçš„å› æœå…³ç³»ã€‚æ²¡æœ‰èƒ½åŠ›åˆ†è¾¨å……åˆ†å¿…è¦æ¡ä»¶å¤„ç†å› æœå…³ç³»æ˜¯å¾ˆå¤šäººçš„ç¡¬ä¼¤ã€‚å°±åƒæˆ‘åœ¨ã€Š<a href="https://coolshell.cn/articles/19271.html" target="_blank" rel="noopener">åŠªåŠ›å°±ä¼šæˆåŠŸ</a>ã€‹ä¸­è¯´çš„ä¸€æ ·ï¼Œâ€œåŠªåŠ›â€ å’Œ â€œæˆåŠŸâ€æ˜¯å¦æœ‰å› æœå…³ç³»ï¼Ÿå„ç§é€»è¾‘æ··æ·†ã€æ¦‚å¿µå·æ¢ã€æ¨¡ç³Šå› æœã€ä¼¼æ˜¯è€Œéå…¨æ˜¯åœ¨è¿™é‡Œã€‚æ¯”å¦‚ï¼šæ©è€³ç›—é“ƒã€åˆ»èˆŸæ±‚å‰‘å°±æ˜¯å› æœå…³ç³»æ··ä¹±çš„è¡¨ç°ã€‚<em><strong>äººä»¬ä¼šç»å¸¸åœ°æ··æ·†ä¸¤ä¸ªçœ‹æ¥ä¸€èµ·å‘ç”Ÿï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å…³è”åœ¨ä¸€èµ·çš„äº‹</strong></em>ã€‚å› æœå…³ç³»æ˜¯æœ€å®¹æ˜“è¢«æ¨¡ç³Šå’Œå·æ¢çš„ï¼Œæ¯”å¦‚ï¼šå¾ˆå¤šäººéƒ½å®¹æ˜“æ··æ·†â€œåŠ ç­â€å°±ä¼šæœ‰â€œäº§å‡ºâ€ï¼Œæ··æ·†äº†â€œè¡ŒåŠ¨â€å°±ä¼šæœ‰â€œç»“æœâ€ï¼Œæ··æ·†äº†â€œæŠµåˆ¶â€å°±ä¼šèµ¢å¾—â€œå°Šé‡â€ï¼Œæ··æ·†äº†â€œæ‰¹è¯„â€ç­‰äºâ€œåå¯¹â€â€¦â€¦ç­‰ç­‰ã€‚é™¤äº†è¿™äº›ä»¥å¤–ï¼Œå¾®ä¿¡å…¬ä¼—å·é‡Œçš„å¾ˆå¤šæ—¶è¯„æ–‡ç« ï¼Œä»–ä»¬çš„æ–‡ç« ä¸­çš„ç»“è®ºå’Œå…¶è®ºæ®æ˜¯æ²¡æœ‰å› æœå…³ç³»çš„ï¼Œå¥½å¤šæ–‡ç« å°±æ˜¯æ··æ·†ã€æ¨¡ç³Šã€å·æ¢â€¦â€¦<em><strong>å› æœå…³ç³»å‡ºé—®é¢˜çš„æ–‡ç« è¯»å¤šäº†æ˜¯å¯¹å¤§è„‘æœ‰æŸä¼¤çš„ï¼Œè¦å°½é‡è¿œç¦»</strong></em>ã€‚</p>
<p><strong>ç¬¬å››æ­¥ï¼šæ‰¾åˆ°é è°±çš„åŸºå‡†çº¿</strong>ã€‚å°±åƒæˆ‘ä»¬å†™ä»£ç ä¸€æ ·ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¼šå»æ‰¾ä¸€äº›æœ€ä½³å®è·µæˆ–æ˜¯ä¸šå†…æ ‡å‡†ï¼ŒåŸå› æ˜¯å› ä¸ºï¼Œè¿™æ ·çš„ä¸œè¥¿éƒ½æ˜¯ç»è¿‡é•¿æ—¶é—´è¢«è¿™ä¸ªä¸–ç•Œä¸Šå¾ˆå¤šäººReviewè¿‡çš„ï¼Œæ˜¯å€¼å¾—ä¾èµ–å’Œé è°±çš„ï¼Œä»–ä»¬ä¼šè€ƒè™‘åˆ°å¾ˆå¤šä½ æ²¡æœ‰è€ƒè™‘è¿‡çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°å¾ˆå¤šæ—¶è¯„éƒ½ä¼šæ‰¾æ¬§ç¾å‘è¾¾å›½å®¶çš„ä½œå‚è€ƒçš„åšæ³•ï¼Œå› ä¸ºæ¯•ç«Ÿäººå®¶çš„æ–‡åŒ–æ˜¯ç›¸å¯¹æ¯”è¾ƒæ–‡æ˜ã€ç§‘å­¦ã€å¼€æ”¾å’Œå…ˆè¿›çš„ã€‚æ‰¾åˆ°ä¸–ç•Œæˆ–æ˜¯å›½é™…çš„é€šè¡Œæ ‡å‡†ï¼Œä¼šæ›´å®¹æ˜“è®©äººè¿›æ­¥ã€‚æ¯”å¦‚ï¼š<em><strong>ä»¥å¼€æ”¾åŒ…å®¹åŠ å¼ºæ²Ÿé€šçš„å¿ƒæ€ï¼Œå°±ä¼šæ¯”å°é—­æŠµåˆ¶æ•Œå¯¹çš„å¿ƒæ€è¦å¥½å¾—å¤šå¾—å¤šï¼Œæ™ºè€…å»ºæ¡¥ï¼Œæ„šè€…å»ºå¢™</strong></em>ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¼€å§‹å‘ç°ï¼Œæœ‰ä¸€äº›äº‹ä¸Šï¼Œæœ‰åˆ©äºè‡ªå·±çš„å°±å¯¹æ ‡ï¼Œä¸åˆ©äºè‡ªå·±çš„å°±ä¸å¯¹æ ‡ï¼Œè€Œä¸”ï¼Œé™¤äº†å¥½çš„äº‹ï¼Œä¸å¥½çš„äº‹ä¹Ÿåœ¨æ‰¾æ¬§ç¾ä½œå¯¹æ ‡ï¼Œäºæ˜¯å¼€å§‹â€œå¤šåŸºå‡†çº¿â€å’Œâ€œä¹±åŸºå‡†çº¿â€ï¼Œè¿™ç§æ–¹å¼éœ€è¦æˆ‘ä»¬å°å¿ƒåˆ†è¾¨ã€‚</p>
<p><strong>ç¬¬äº”æ­¥ï¼šæ›´ä¸ºæ·±å…¥å’Œé«˜ç»´çš„æ€è€ƒ</strong>ã€‚å¦‚æœä¸€ä»¶äº‹æƒ…åªåœ¨è¡¨é¢ä¸Šè¿›è¡Œæ€è€ƒå…¶å®åªæ˜¯ä¸€ç§æµ…åº¦æ€è€ƒï¼Œåœ¨ Amazonï¼Œçº¿ä¸Šç³»ç»Ÿå‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œéœ€è¦å†™ä¸€ä¸ª Correction of Errors çš„æŠ¥å‘Šï¼Œå…¶ä¸­éœ€è¦ Ask 5 Whysï¼ˆå‚çœ‹ Wikipedia çš„ Five Whys è¯æ¡ï¼‰ï¼Œè¿™ç§æ€è€ƒæ–¹å¼å¯ä»¥è®©ä½ ä¸æ–­è¿½é—®åˆ°æ·±å±‚æ¬¡çš„æœ¬è´¨é—®é¢˜ï¼Œä¼šè®©ä½ è‡ªå·±åšå¤§é‡çš„è°ƒæŸ¥å’Œç ”ç©¶ï¼Œè®©ä½ ä¸ä¼šæˆä¸ºä¸€ä¸ªåªä¼šåœ¨è¡¨é¢ä¸Šè¿›è¡Œæ€è€ƒçš„ç®€å•åŠ¨ç‰©ã€‚æ¯”å¦‚ï¼šå½“ä½ çœ‹åˆ°æœ‰å‡ºä¹ä½ æ„æ–™çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è´Ÿé¢çš„æš´åŠ›äº‹ä»¶ï¼‰ï¼Œä½ éœ€è¦é—®ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿç„¶åç½—åˆ—å°½å¯èƒ½å…¨çš„åŸå› ï¼Œå†ä¸æ–­åœ°è¿½é—®å¹¶æ‹·è¯ä¸‹å»ï¼ˆè¿™è·Ÿå†™ç¨‹åºä¸€æ ·ï¼Œéœ€è¦ä»æ­£å‘æ¡ˆä¾‹å’Œè´Ÿå‘æ¡ˆä¾‹è¿›è¡Œè€ƒè™‘åˆ†æï¼Œæ‰å¯èƒ½å†™å‡ºå¥å£®æ€§å¾ˆå¼ºçš„ä»£ç ï¼‰ï¼Œæˆ‘ä»¬æ‰ä¼šå¾—å‡ºä¸€ä¸ªæ¯”è¾ƒå¥å£®çš„ç­”æ¡ˆæˆ–ç»“æ„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¿°çš„è¿™äº”ç§æ€ç»´æ–¹å¼ä¸‹ï¼Œä½ çš„æ€è€ƒæ˜¯ä¸å¯èƒ½å¿«å¾—èµ·æ¥çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œæ…¢æ€è€ƒâ€ï¼ˆæ³¨ï¼šå¦‚æœè¯»è¿‡ã€Š<a href="https://book.douban.com/subject/10785583//" target="_blank" rel="noopener">æ€è€ƒï¼Œå¿«ä¸æ…¢</a>ã€‹è¿™æœ¬ä¹¦çš„äººå°±çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆï¼‰ï¼Œ<em><strong>ç‹¬ç«‹æ€è€ƒæ˜¯éœ€è¦ä½¿ç”¨å¤§è„‘ä¸­çš„â€œæ…¢ç³»ç»Ÿâ€ï¼Œæ…¢ç³»ç»Ÿæ˜¯åäººæ€§çš„ï¼Œæ‰€ä»¥ï¼Œèƒ½çœŸæ­£åšåˆ°ç‹¬ç«‹æ€è€ƒçš„äººå¾ˆå°‘</strong></em>ã€‚æ›´å¤šçš„äººçš„â€œç‹¬ç«‹æ€è€ƒâ€å…¶å®åªä¸è¿‡æ˜¯æ¯«æ— ç« æ³•çš„ä¹±æ€è€ƒç½¢äº†ã€‚</p>
<p>é€šè¿‡ä¸Šè¿°çš„è¿™äº”ç‚¹ï¼Œæˆ‘ç›¸ä¿¡ä½ æ˜¯å¾ˆå®¹æ˜“è¯†åˆ«æˆ–æ˜¯åˆ†è¾¨å‡ºå“ªäº›ä¿¡æ¯æ˜¯é è°±çš„ï¼Œå“ªäº›ä¿¡æ¯æ˜¯å¾ˆæ‰¯çš„ï¼Œç”šè‡³ä¼šæ”¹å–„ä½ è‡ªå·±çš„è¨€è®ºå’Œæ€è€ƒã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•å¹¶ä¸èƒ½è®©ä½ è·å¾—çœŸç†æˆ–æ˜¯çœŸç›¸ã€‚ä½†æ˜¯è¿™ä¹Ÿå¤Ÿäº†ï¼Œä¸€ä¸ªäººå¦‚æœæ‹¥æœ‰äº†èƒ½å¤Ÿåˆ†è¾¨æ˜¯éçš„èƒ½åŠ›ï¼Œä¹Ÿæ˜¯å¾ˆä¸é”™çš„äº†ã€‚è™½ç„¶ä¸çŸ¥é“äº‹å®æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯ä½ ä¹Ÿä¸ä¼šç›²ä»å’Œåä¿¡ï¼Œä»è€Œä¸ä¼šè¢«äººç…½åŠ¨ï¼Œè€Œæˆä¸ºå¹•åé»‘æ‰‹çš„çš„ä¸€åªâ€œè‚‰é¸¡â€ã€‚</p>
<p>å¤šè¯´ä¸¤å¥ï¼Œä¸‹é¢æ˜¯ä¸€äº›æˆ‘ä¸ªäººçš„ä¸€äº›å®è·µï¼š</p>
<p>å½“æ–°é—»æŠ¥é“æŠ¥é“çš„ä¸æ˜¯å®¢è§‚äº‹å®ï¼Œè€Œæ˜¯åŠ å…¥äº†å¾ˆå¤šè§‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–°é—»æŠ¥é“æ˜¯ä¸å¯ä¿¡çš„ã€‚<br>
å¯¹äºè¯„è®ºæ€§çš„æ–‡ç« ï¼Œæ²¡æœ‰å……è¶³æƒå¨å¯ä¿¡çš„è®ºæ®æ—¶ï¼Œä¸èƒ½å®Œå…¨ç›¸ä¿¡ã€‚<br>
ä¸æ˜¯å½“äº‹äººï¼Œä¸æ˜¯è§è¯äººï¼Œè¿˜è¦è£…ä½œè‡ªå·±æ˜¯çŸ¥æƒ…çš„â€¦â€¦ä¸çŸ¥é“è¿™ç§äººçš„è‡ªä¿¡æ€ä¹ˆæ¥çš„ï¼Ÿ<br>
ä¿¡æ¯ä¸å…¬å¼€çš„ï¼Œå¹¶æœ‰æ„å±è”½ä¿¡æ¯çš„ï¼Œä¸èƒ½ä½œä¸ºå¯ä¿¡çš„ä¿¡æ¯æºã€‚<br>
å½“å‡ºç°å¤§æ˜¯æˆ–æ˜¯å¤§éçš„äº‹æ—¶ï¼Œä¸€å®šè¦éå¸¸å°å¿ƒï¼Œè¿™ä¸ªä¸–ç•Œä¸å­˜åœ¨å®Œå…¨çš„ç¾å’Œå®Œå…¨çš„ä¸‘ï¼Œè¿™æ ·çš„è§‚ç‚¹é€šå¸¸æ¥è¯´éƒ½æ˜¯å±é™©çš„ï¼Œæ­¤æ—¶è¦å¤šçœ‹çœ‹ä¸åŒè§’åº¦çš„æŠ¥é“å’Œè¯„è®ºï¼Œè¦å¤šæ”¶é›†ä¸€äº›ä¿¡æ¯ï¼Œè¿˜è¦å¤šé—®é—®ä¸ºä»€ä¹ˆã€‚<br>
æ¬¢è¿ä½ å‘Šè¯‰æˆ‘ä¸€äº›ä½ çš„å®è·µå’Œæ€ç»´æ–¹å¼ã€‚</p>
<p>è½¬è½½è‡ªé™ˆçš“ CoolShell åšå®¢<br>
åŸæ–‡é“¾æ¥ï¼š<a href="https://coolshell.cn/articles/20533.html" target="_blank" rel="noopener">ä½¿ç”¨ç®€å•çš„é€»è¾‘æ–¹æ³•è¿›è¡Œç‹¬ç«‹æ€è€ƒ</a></p>
]]></content>
      <categories>
        <category>Perception</category>
      </categories>
      <tags>
        <tag>Perception</tag>
      </tags>
  </entry>
</search>
